{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\defaultrole\\components\\EditRole.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\defaultrole\\components\\EditRole.vue","mtime":1616384580042},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { message } from '@/utils/message';\nimport { generateTitle } from '@/utils/i18n';\nexport default {\n  name: 'Editrole',\n  props: {\n    // 0为线路商模板配置 1为普通商户模板配置 2为默认角色配置\n    type: {\n      type: Number,\n      default: 0\n    },\n    drawer: Boolean,\n    permissions: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    assignedPermissions: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    roledata: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    }\n  },\n  data: function data() {\n    return {\n      transferKey: 0,\n      elDrawer: false,\n      checkedAll: false,\n      checkedKeys: [],\n      ps: [],\n      form: {\n        roleName: '',\n        remark: ''\n      },\n      direction: 'ttb'\n    };\n  },\n  computed: {\n    defaultProps: function defaultProps() {\n      return {\n        label: function label(data) {\n          return generateTitle(data.permissionName);\n        },\n        children: 'children'\n      };\n    }\n  },\n  watch: {\n    drawer: function drawer(val) {\n      this.elDrawer = val;\n    },\n    roledata: {\n      handler: function handler(newVal, old) {\n        if (newVal.id) {\n          this.form = _objectSpread({}, newVal);\n        } else {\n          this.resetForm();\n        }\n      },\n      deep: true\n    },\n    permissions: {\n      handler: function handler(newVal, oldVal) {\n        var _this = this;\n\n        if (newVal) {\n          this.ps = newVal;\n          this.$nextTick(function () {\n            // 叶子节点平铺\n            var doms = document.querySelectorAll('.el-tree-node__content > .is-leaf') || [];\n            doms.length !== 0 && doms.forEach(function (node) {\n              node.parentNode.classList.add('tile');\n            });\n\n            _this.checkIfAllChecked();\n          });\n        }\n      },\n      deep: true\n    },\n    assignedPermissions: {\n      handler: function handler(newVal, oldVal) {\n        var _this2 = this;\n\n        if (newVal.length && newVal.length > 0) {\n          this.$refs.editRoleTree && this.$refs.editRoleTree.setCheckedKeys(newVal);\n          this.$nextTick(function () {\n            _this2.checkIfAllChecked();\n          });\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    checkIfAllChecked: function checkIfAllChecked() {\n      var arr = this.filterPS(this.ps);\n      arr = arr.filter(function (val) {\n        return !String(val.id).includes('list');\n      });\n\n      if (arr.length <= this.assignedPermissions.length) {\n        this.checkedAll = true;\n      } else {\n        this.checkedAll = false;\n      }\n    },\n    // 点击复选框判断是否全选\n    clickIfAllChecked: function clickIfAllChecked(checkedKeys) {\n      var arr = this.filterPS(this.ps);\n\n      if (arr.length === checkedKeys.length) {\n        this.checkedAll = true;\n      } else {\n        this.checkedAll = false;\n      }\n    },\n    checkAllChange: function checkAllChange(val) {\n      if (val) {\n        this.selectAll();\n      } else {\n        this.resetTree();\n      }\n    },\n    check: function check(data, obj) {\n      if (!obj.checkedKeys.includes(data.id) && String(data.id).includes('list')) {\n        this.$refs.editRoleTree.setChecked(data.parentId, false, true);\n      }\n\n      if (obj.checkedKeys.includes(data.id)) {\n        this.$refs.editRoleTree.setChecked(\"list\".concat(data.parentId), true);\n      }\n\n      this.clickIfAllChecked(obj.checkedKeys);\n    },\n    selectAll: function selectAll() {\n      if (this.$refs.editRoleTree) this.$refs.editRoleTree.setCheckedNodes(this.ps);\n    },\n    resetTree: function resetTree() {\n      if (this.$refs.editRoleTree) this.$refs.editRoleTree.setCheckedNodes([]);\n    },\n    filterPS: function filterPS(ps) {\n      var list = [];\n\n      var getList = function getList(ps) {\n        ps.forEach(function (item) {\n          if (item.children) {\n            list.push(item);\n            getList(item.children);\n          } else {\n            list.push(item);\n          }\n        });\n      };\n\n      getList(ps);\n      return list;\n    },\n    resetForm: function resetForm() {\n      this.form = {};\n      this.checkedAll = false;\n      this.resetTree();\n    },\n    handleSure: function handleSure() {\n      var _this3 = this;\n\n      var permissionKeys = [];\n      var keys = this.$refs.editRoleTree.getCheckedKeys() || [];\n      var halfKeys = this.$refs.editRoleTree.getHalfCheckedKeys() || [];\n      permissionKeys = keys.concat(halfKeys); // 过滤掉id为'list'的值\n\n      permissionKeys = permissionKeys.filter(function (element) {\n        return !String(element).includes('list');\n      });\n      this.$refs.form.validate(function (valid) {\n        if (valid) {\n          if (keys.length === 0) {\n            _this3.$message.error(_this3.$t('systemmanagement.systemmanagement_102'));\n\n            return;\n          } // 获取参数\n\n\n          console.log(_this3.form);\n          var form = {\n            permissionIds: permissionKeys,\n            id: _this3.form.id,\n            systemType: _this3.form.systemType\n          };\n          var api = _this3.type === 0 ? 'updateLineAgentTemplateConfig' : _this3.type === 1 ? 'updateAgentTemplateConfig' : 'updateAgentAdminUserConfig';\n\n          if (_this3.type === 2) {\n            form = {\n              userId: _this3.form.userId,\n              agentCode: _this3.form.agentCode,\n              permissionIds: permissionKeys,\n              systemType: _this3.form.systemType\n            };\n          }\n\n          var loading = _this3.$loading({\n            lock: true,\n            text: 'Loading',\n            spinner: 'el-icon-loading',\n            background: 'rgba(0, 0, 0, 0.7)'\n          });\n\n          _this3.$api[api](form).then(function (res) {\n            if (res.code === 200) {\n              loading.close();\n              var messageText = _this3.type === 0 ? _this3.$t('authoritymanagement_defaultrole_components_editrole_214') : _this3.type === 1 ? _this3.$t('authoritymanagement_defaultrole_components_editrole_215') : _this3.$t('authoritymanagement_defaultrole_components_editrole_216', [_this3.roledata.agentName]);\n\n              _this3.resetDialog();\n\n              _this3.$emit('update:drawer', false);\n\n              return message({\n                type: 'success',\n                message: _this3.$t('authoritymanagement_defaultrole_components_editrole_217', [messageText])\n              });\n            }\n\n            loading.close();\n          }).catch(function () {\n            loading.close();\n          });\n        }\n      });\n    },\n    handleClose: function handleClose() {\n      this.resetDialog();\n      this.$emit('update:drawer', false);\n    },\n    resetDialog: function resetDialog() {\n      this.transferKey = +new Date();\n    },\n    filterRoleName: function filterRoleName() {\n      return this.$t('other_010');\n    },\n    filterRemark: function filterRemark() {\n      return this.$t('other_011');\n    }\n  }\n};",null]}