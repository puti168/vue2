{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\notice\\notice\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\notice\\notice\\index.vue","mtime":1617695097430},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.array.find\";\nimport _objectSpread from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapGetters } from 'vuex';\nimport list from '@/mixins/list';\nimport { message } from '@/utils/message';\nimport { routerNames } from '@/utils/consts';\nimport SelectAgentTree from '@/components/SelectAgentTree';\nimport Modal from '@/components/Modal';\nimport dayjs from 'dayjs';\nimport Cookies from 'js-cookie';\nvar noticeDialogForm = {\n  releaseTime: [],\n  title: '',\n  type: 1,\n  content: ''\n};\nexport default {\n  name: routerNames.noticeList,\n  components: {\n    SelectAgentTree: SelectAgentTree,\n    Modal: Modal\n  },\n  mixins: [list],\n  data: function data() {\n    var end = dayjs().endOf('day').valueOf();\n    var start = dayjs().startOf('day').subtract(29, 'd').valueOf();\n    return {\n      modalType: 1,\n      // 1为启用 2为停用\n      dialogVisible: false,\n      hadSearch: false,\n      loading: false,\n      releaseTime: [],\n      noticeDialogVisible: false,\n      noticeDialogForm: {\n        type: 1\n      },\n      editNoticeType: -1,\n      form: {\n        time: [start, end],\n        sendTime: '',\n        agentId: '',\n        status: -1,\n        type: -1\n      },\n      noticeData: {},\n      list: [],\n      time: ''\n    };\n  },\n  computed: _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, mapGetters(['globalDics'])), mapGetters(['buttonPermissions'])), mapGetters(['userInfo'])), {}, {\n    pickerOptions: function pickerOptions() {\n      var _this = this;\n\n      return {\n        disabledDate: function disabledDate(time) {\n          var now = dayjs().endOf('day').valueOf();\n          return time.getTime() > now;\n        },\n        onPick: function onPick(_ref) {\n          var maxDate = _ref.maxDate,\n              minDate = _ref.minDate;\n\n          if (!maxDate) {\n            _this.minDate = minDate;\n          }\n        },\n        shortcuts: [{\n          text: this.$t(\"members_betrecord_index_584\"),\n          onClick: function onClick(picker) {\n            var end = dayjs().endOf('day');\n            var start = dayjs().startOf('day');\n            picker.$emit('pick', [+start, +end]);\n          }\n        }, {\n          text: this.$t(\"members_betrecord_index_585\"),\n          onClick: function onClick(picker) {\n            var end = dayjs().endOf('day').subtract(1, 'd');\n            var start = dayjs().startOf('day').subtract(1, 'd');\n            picker.$emit('pick', [+start, +end]);\n          }\n        }, {\n          text: this.$t(\"members_betrecord_index_586\"),\n          onClick: function onClick(picker) {\n            var start, end;\n            var weekNum = dayjs().day();\n\n            if (weekNum === 0) {\n              end = dayjs().endOf('day');\n              start = dayjs().subtract(1, 'd').startOf('week').startOf('day').add(1, 'd');\n            } else {\n              end = dayjs().endOf('day');\n              start = dayjs().startOf('day').startOf('week').add(1, 'd');\n            }\n\n            picker.$emit('pick', [+start, +end]);\n          }\n        }, {\n          text: this.$t(\"members_betrecord_index_587\"),\n          onClick: function onClick(picker) {\n            var end = dayjs().endOf('day');\n            var start = dayjs().startOf('month');\n            picker.$emit('pick', [+start, +end]);\n          }\n        }, {\n          text: this.$t(\"merchant_dailyrateaccount_index_799\"),\n          onClick: function onClick(picker) {\n            var end = dayjs().endOf('day');\n            var start = dayjs().startOf('day').subtract(89, 'd');\n            picker.$emit('pick', [+start, +end]);\n          }\n        }]\n      };\n    },\n    startTimeOptions: function startTimeOptions() {\n      return {\n        disabledDate: function disabledDate(time) {\n          // 今天之前的时间不能作为起始时间\n          var yestoday = new Date();\n          yestoday.setDate(yestoday.getDate() - 1);\n          return time.getTime() < yestoday.getTime();\n        }\n      };\n    },\n    noticeRules: function noticeRules() {\n      var _this2 = this;\n\n      var validNoticeTitle = function validNoticeTitle(rule, value, callback) {\n        if (value && value.length > 30) {\n          callback(new Error(_this2.$t('notice_notice_index_1268')));\n        } else {\n          callback();\n        }\n      };\n\n      var validNoticeContent = function validNoticeContent(rule, value, callback) {\n        if (value && value.length > 100) {\n          callback(new Error(_this2.$t('notice_notice_index_1269')));\n        } else {\n          callback();\n        }\n      };\n\n      return {\n        releaseTime: [{\n          required: true,\n          message: this.$t('notice.notice_29'),\n          trigger: 'blur'\n        }],\n        title: [{\n          required: true,\n          message: this.$t('notice_notice_index_1270'),\n          trigger: 'blur'\n        }, {\n          validator: validNoticeTitle,\n          trigger: 'blur'\n        }],\n        type: [{\n          required: true,\n          message: this.$t('notice.notice_31'),\n          trigger: 'blur'\n        }],\n        content: [{\n          required: true,\n          message: this.$t('notice_notice_index_1271'),\n          trigger: 'blur'\n        }, {\n          validator: validNoticeContent,\n          trigger: 'blur'\n        }]\n      };\n    },\n    noticetype: function noticetype() {\n      var types = this.globalDics.noticetype || [];\n      return types.map(function (item) {\n        return {\n          value: item.value,\n          label: item.text,\n          zh: item.text,\n          en: item.englishText\n        };\n      });\n    }\n  }),\n  methods: {\n    filterNoticetype: function filterNoticetype(c) {\n      var arr = this.noticetype || [];\n      var find = arr.find(function (item) {\n        return Number(item.value) === Number(c);\n      });\n\n      if (Cookies.get('language') === 'zh') {\n        return find && find.zh || '-';\n      }\n\n      if (Cookies.get('language') === 'en') {\n        return find && find.en || '-';\n      }\n\n      return '-';\n    },\n    loadData: function loadData() {\n      var _this3 = this;\n\n      this.loading = true;\n      var pageData = {\n        pageSize: this.pageSize,\n        pageIndex: this.pageIndex,\n        startDate: this.form.time ? this.form.time[0] : '',\n        endDate: this.form.time ? this.form.time[1] : ''\n      };\n      var requestData = this.hadSearch ? {\n        publishStartDate: this.form.sendTime ? this.form.sendTime[0] : '',\n        publishEndDate: this.form.sendTime ? this.form.sendTime[1] : '',\n        agentId: this.form.agentId,\n        type: this.form.type,\n        status: this.form.status\n      } : {};\n\n      var form = _objectSpread(_objectSpread({}, pageData), requestData);\n\n      this.$api.noticeList(form).then(function (_) {\n        _this3.loading = false;\n\n        if (_.code === 200) {\n          var data = _.data;\n          _this3.list = data.record;\n          _this3.total = data.totalRecord;\n        }\n      }).catch(function () {\n        _this3.loading = false;\n      });\n    },\n    editRow: function editRow(row) {\n      var _this4 = this;\n\n      setTimeout(function () {\n        var releaseTime = _this4.getReleaseTime(row);\n\n        _this4.noticeDialogForm = _objectSpread({\n          releaseTime: releaseTime\n        }, row);\n        _this4.editNoticeType = 1;\n        _this4.noticeDialogVisible = true;\n      }, 800);\n    },\n    getReleaseTime: function getReleaseTime(row) {\n      return [dayjs(row.publishStartTime).valueOf(), dayjs(row.publishEndTime).valueOf()];\n    },\n    updateStatus: function updateStatus() {\n      var _this5 = this;\n\n      var params = {\n        id: this.noticeData.id,\n        status: this.noticeData.status === 1 ? 0 : 1\n      };\n      this.$api.noticeUpdateStatus(params).then(function (_) {\n        if (_.code === 200) {\n          var index = _this5.list.findIndex(function (val) {\n            return val.id === params.id;\n          });\n\n          if (index > -1) {\n            _this5.list[index].status = params.status;\n            _this5.dialogVisible = false;\n          }\n\n          message({\n            type: 'success',\n            message: _this5.$t('notice.notice_39')\n          });\n        }\n      });\n    },\n    editAccountStatus: function editAccountStatus(index, row) {\n      this.dialogVisible = true;\n      this.modalType = row.status === 1 ? 2 : 1;\n      this.noticeData = _objectSpread({}, row);\n    },\n    commitNoticeDialog: function commitNoticeDialog() {\n      var _this6 = this;\n\n      var timeSpan = 365 * 24 * 60 * 60 * 1000;\n      this.$refs.noticeDialogForm.validate(function (valid) {\n        if (valid) {\n          if (_this6.noticeDialogForm.releaseTime && _this6.noticeDialogForm.releaseTime[0] >= _this6.noticeDialogForm.releaseTime[1]) {\n            return message({\n              type: 'warning',\n              message: _this6.$t('notice_notice_index_1272')\n            });\n          }\n\n          if (_this6.noticeDialogForm.releaseTime[1] - _this6.noticeDialogForm.releaseTime[0] > timeSpan) {\n            return message({\n              type: 'warning',\n              message: _this6.$t('notice_notice_index_1273')\n            });\n          }\n\n          var form = {\n            content: _this6.noticeDialogForm.content,\n            publishStartTime: _this6.noticeDialogForm.releaseTime && _this6.noticeDialogForm.releaseTime[0] || '',\n            publishEndTime: _this6.noticeDialogForm.releaseTime && _this6.noticeDialogForm.releaseTime[1] || '',\n            title: _this6.noticeDialogForm.title,\n            type: _this6.noticeDialogForm.type,\n            id: _this6.noticeDialogForm.id\n          };\n\n          var loading = _this6.$loading({\n            lock: true,\n            text: 'Loading',\n            spinner: 'el-icon-loading',\n            background: 'rgba(0, 0, 0, 0.7)'\n          }); // 判断是修改还是新建\n\n\n          if (_this6.editNoticeType === 0) {\n            _this6.$api.noticeCreate(form).then(function (_) {\n              _this6.noticeDialogVisible = false;\n\n              _this6.loadData();\n\n              _this6.$message({\n                type: 'success',\n                message: _this6.$t('notice.notice_43')\n              });\n\n              loading.close();\n            }).catch(function () {\n              loading.close();\n            });\n          } else if (_this6.editNoticeType === 1) {\n            // 编辑\n            _this6.$api.noticeUpdate(form).then(function (_) {\n              if (_.code === 200) {\n                _this6.loadData();\n\n                _this6.noticeDialogVisible = false;\n\n                _this6.$message({\n                  type: 'success',\n                  message: _this6.$t('notice.notice_44')\n                });\n              }\n\n              loading.close();\n            }).catch(function () {\n              loading.close();\n            });\n          }\n        }\n      });\n    },\n    handleNewNotice: function handleNewNotice() {\n      this.noticeDialogVisible = true;\n      this.noticeDialogForm = _objectSpread({}, noticeDialogForm);\n      this.editNoticeType = 0;\n    },\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.loadData();\n    },\n    handleReset: function handleReset() {\n      var end = dayjs().endOf('day').valueOf();\n      var start = dayjs().startOf('day').subtract(29, 'd').valueOf();\n      this.pageIndex = 1;\n      this.form = {\n        time: [start, end],\n        sendTime: '',\n        createdBy: '',\n        type: -1,\n        status: -1\n      };\n      this.hadSearch = false;\n      this.loadData();\n    },\n    handleSearch: function handleSearch() {\n      this.hadSearch = true;\n      this.pageIndex = 1;\n      this.loadData();\n    },\n    afterDialogClose: function afterDialogClose() {\n      var _this7 = this;\n\n      this.noticeDialogVisible = false;\n      this.$refs.noticeDialogForm.clearValidate();\n      setTimeout(function () {\n        _this7.noticeDialogForm = {\n          releaseTime: [],\n          title: '',\n          type: 1,\n          content: ''\n        };\n      }, 300);\n    }\n  }\n};",null]}