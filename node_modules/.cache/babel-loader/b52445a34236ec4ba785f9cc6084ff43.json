{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\store\\modules\\user.js","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\store\\modules\\user.js","mtime":1617594855333},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgc3RvcmFnZSBmcm9tICdzdG9yZSc7CmltcG9ydCB7IGxvZ2luLCBnZXRJbmZvLCBsb2dvdXQgfSBmcm9tICdAL2FwaS9sb2dpbic7CmltcG9ydCB7IEFDQ0VTU19UT0tFTiB9IGZyb20gJ0Avc3RvcmUvbXV0YXRpb24tdHlwZXMnOwppbXBvcnQgeyB3ZWxjb21lIH0gZnJvbSAnQC91dGlscy91dGlsJzsKdmFyIHVzZXIgPSB7CiAgc3RhdGU6IHsKICAgIHRva2VuOiAnJywKICAgIG5hbWU6ICcnLAogICAgd2VsY29tZTogJycsCiAgICBhdmF0YXI6ICcnLAogICAgcm9sZXM6IFtdLAogICAgaW5mbzoge30KICB9LAogIG11dGF0aW9uczogewogICAgU0VUX1RPS0VOOiBmdW5jdGlvbiBTRVRfVE9LRU4oc3RhdGUsIHRva2VuKSB7CiAgICAgIHN0YXRlLnRva2VuID0gdG9rZW47CiAgICB9LAogICAgU0VUX05BTUU6IGZ1bmN0aW9uIFNFVF9OQU1FKHN0YXRlLCBfcmVmKSB7CiAgICAgIHZhciBuYW1lID0gX3JlZi5uYW1lLAogICAgICAgICAgd2VsY29tZSA9IF9yZWYud2VsY29tZTsKICAgICAgc3RhdGUubmFtZSA9IG5hbWU7CiAgICAgIHN0YXRlLndlbGNvbWUgPSB3ZWxjb21lOwogICAgfSwKICAgIFNFVF9BVkFUQVI6IGZ1bmN0aW9uIFNFVF9BVkFUQVIoc3RhdGUsIGF2YXRhcikgewogICAgICBzdGF0ZS5hdmF0YXIgPSBhdmF0YXI7CiAgICB9LAogICAgU0VUX1JPTEVTOiBmdW5jdGlvbiBTRVRfUk9MRVMoc3RhdGUsIHJvbGVzKSB7CiAgICAgIHN0YXRlLnJvbGVzID0gcm9sZXM7CiAgICB9LAogICAgU0VUX0lORk86IGZ1bmN0aW9uIFNFVF9JTkZPKHN0YXRlLCBpbmZvKSB7CiAgICAgIHN0YXRlLmluZm8gPSBpbmZvOwogICAgfQogIH0sCiAgYWN0aW9uczogewogICAgLy8g55m75b2VCiAgICBMb2dpbjogZnVuY3Rpb24gTG9naW4oX3JlZjIsIHVzZXJJbmZvKSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmMi5jb21taXQ7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgbG9naW4odXNlckluZm8pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVzcG9uc2UuZGF0YSB8fCB7fTsKCiAgICAgICAgICBpZiAocmVzdWx0LnRva2VuKSB7CiAgICAgICAgICAgIHJlc3VsdC50b2tlbiA9IHJlc3VsdC50b2tlbjsKICAgICAgICAgICAgc3RvcmFnZS5zZXQoQUNDRVNTX1RPS0VOLCByZXN1bHQudG9rZW4sIDI0ICogNjAgKiA2MCAqIDEwMDApOwogICAgICAgICAgICBjb21taXQoJ1NFVF9UT0tFTicsIHJlc3VsdC50b2tlbik7CiAgICAgICAgICB9CgogICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDojrflj5bnlKjmiLfkv6Hmga8KICAgIEdldEluZm86IGZ1bmN0aW9uIEdldEluZm8oX3JlZjMpIHsKICAgICAgdmFyIGNvbW1pdCA9IF9yZWYzLmNvbW1pdDsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBnZXRJbmZvKCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5jb2RlICE9IDIwMCkgewogICAgICAgICAgICByZWplY3QocmVzcG9uc2UubXNnKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfcmVmNCA9IHJlc3BvbnNlLmRhdGEgfHwge30sCiAgICAgICAgICAgICAgX3JlZjQkdXNlckluZm8gPSBfcmVmNC51c2VySW5mbywKICAgICAgICAgICAgICB1c2VySW5mbyA9IF9yZWY0JHVzZXJJbmZvID09PSB2b2lkIDAgPyB7fSA6IF9yZWY0JHVzZXJJbmZvOwoKICAgICAgICAgIGlmICghdXNlckluZm8udXNlcm5hbWUpIHsKICAgICAgICAgICAgcmVqZWN0KCfpnZ7ms5XnlKjmiLfkv6Hmga/vvIzor7fogZTns7vnrqHnkIblkZgnKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbW1pdCgnU0VUX1JPTEVTJywgW3VzZXJJbmZvLnJvbGVJZF0pOwogICAgICAgICAgY29tbWl0KCdTRVRfSU5GTycsIHVzZXJJbmZvKTsKICAgICAgICAgIGNvbW1pdCgnU0VUX05BTUUnLCB7CiAgICAgICAgICAgIG5hbWU6IHVzZXJJbmZvLnVzZXJuYW1lLAogICAgICAgICAgICB3ZWxjb21lOiB3ZWxjb21lKCkKICAgICAgICAgIH0pOwogICAgICAgICAgY29tbWl0KCdTRVRfQVZBVEFSJywgdXNlckluZm8uYXZhdGFyKTsKICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgICByZWplY3QoJ+ivt+axgueUqOaIt+S/oeaBr+Wksei0pe+8jOivt+iBlOezu+euoeeQhuWRmCcpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDnmbvlh7oKICAgIExvZ291dDogZnVuY3Rpb24gTG9nb3V0KF9yZWY1KSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmNS5jb21taXQsCiAgICAgICAgICBzdGF0ZSA9IF9yZWY1LnN0YXRlOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICBsb2dvdXQoc3RhdGUudG9rZW4pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgY29tbWl0KCdTRVRfVE9LRU4nLCAnJyk7CiAgICAgICAgICBjb21taXQoJ1NFVF9ST0xFUycsIFtdKTsKICAgICAgICAgIHN0b3JhZ2UucmVtb3ZlKEFDQ0VTU19UT0tFTik7CiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgY29tbWl0KCdTRVRfVE9LRU4nLCAnJyk7CiAgICAgICAgICBjb21taXQoJ1NFVF9ST0xFUycsIFtdKTsKICAgICAgICAgIHN0b3JhZ2UucmVtb3ZlKEFDQ0VTU19UT0tFTik7CiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7fSk7CiAgICAgIH0pOwogICAgfQogIH0KfTsKZXhwb3J0IGRlZmF1bHQgdXNlcjs="},{"version":3,"sources":["C:/Users/admin/Desktop/merchant-manager-web/src/store/modules/user.js"],"names":["storage","login","getInfo","logout","ACCESS_TOKEN","welcome","user","state","token","name","avatar","roles","info","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","SET_INFO","actions","Login","userInfo","commit","Promise","resolve","reject","then","response","result","data","set","catch","error","GetInfo","code","msg","username","roleId","console","Logout","remove","finally"],"mappings":"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","sourcesContent":["import storage from 'store'\r\nimport { login, getInfo, logout } from '@/api/login'\r\nimport { ACCESS_TOKEN } from '@/store/mutation-types'\r\nimport { welcome } from '@/utils/util'\r\n\r\nconst user = {\r\n  state: {\r\n    token: '',\r\n    name: '',\r\n    welcome: '',\r\n    avatar: '',\r\n    roles: [],\r\n    info: {}\r\n  },\r\n\r\n  mutations: {\r\n    SET_TOKEN: (state, token) => {\r\n      state.token = token\r\n    },\r\n    SET_NAME: (state, { name, welcome }) => {\r\n      state.name = name\r\n      state.welcome = welcome\r\n    },\r\n    SET_AVATAR: (state, avatar) => {\r\n      state.avatar = avatar\r\n    },\r\n    SET_ROLES: (state, roles) => {\r\n      state.roles = roles\r\n    },\r\n    SET_INFO: (state, info) => {\r\n      state.info = info\r\n    }\r\n  },\r\n\r\n  actions: {\r\n    // 登录\r\n    Login({ commit }, userInfo) {\r\n      return new Promise((resolve, reject) => {\r\n        login(userInfo).then(response => {\r\n          const result = response.data || {}\r\n          if (result.token) {\r\n            result.token = result.token\r\n            storage.set(ACCESS_TOKEN, result.token, 24 * 60 * 60 * 1000)\r\n            commit('SET_TOKEN', result.token)\r\n          }\r\n          resolve(response)\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n\r\n    // 获取用户信息\r\n    GetInfo({ commit }) {\r\n      return new Promise((resolve, reject) => {\r\n        getInfo().then(response => {\r\n          if (response.code != 200) {\r\n            reject(response.msg)\r\n            return\r\n          }\r\n          const { userInfo = {} } = response.data || {}\r\n          if (!userInfo.username) {\r\n            reject('非法用户信息，请联系管理员')\r\n            return\r\n          }\r\n          commit('SET_ROLES', [userInfo.roleId])\r\n          commit('SET_INFO', userInfo)\r\n          commit('SET_NAME', { name: userInfo.username, welcome: welcome() })\r\n          commit('SET_AVATAR', userInfo.avatar)\r\n\r\n          resolve(response)\r\n        }).catch(error => {\r\n          console.error(error)\r\n          reject('请求用户信息失败，请联系管理员')\r\n        })\r\n      })\r\n    },\r\n\r\n    // 登出\r\n    Logout({ commit, state }) {\r\n      return new Promise((resolve) => {\r\n        logout(state.token).then(() => {\r\n          commit('SET_TOKEN', '')\r\n          commit('SET_ROLES', [])\r\n          storage.remove(ACCESS_TOKEN)\r\n          resolve()\r\n        }).catch(() => {\r\n          commit('SET_TOKEN', '')\r\n          commit('SET_ROLES', [])\r\n          storage.remove(ACCESS_TOKEN)\r\n          resolve()\r\n        }).finally(() => {\r\n        })\r\n      })\r\n    },\r\n  }\r\n}\r\n\r\nexport default user\r\n"]}]}