{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\usermanage\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\usermanage\\index.vue","mtime":1617695097410},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport _objectSpread from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapGetters } from 'vuex';\nimport list from '@/mixins/list';\nimport EditUser from \"./components/EditUser\";\nimport UserDetail from \"./components/UserDetail\";\nimport { validPassword } from '@/utils/validate';\nimport { routerNames } from '@/utils/consts';\nimport { message } from '@/utils/message';\nimport { i18nRoute } from '@/utils/i18n';\nexport default {\n  name: routerNames.systemUser,\n  components: {\n    EditUser: EditUser,\n    UserDetail: UserDetail\n  },\n  mixins: [list],\n  data: function data() {\n    var _this = this;\n\n    var validatePwd = function validatePwd(rule, value, callback) {\n      if (value === '') {\n        callback(new Error(_this.$t('systemmanagement.systemmanagement_126')));\n      } else if (!validPassword(value)) {\n        callback(new Error(_this.$t('systemmanagement.systemmanagement_127')));\n      } else {\n        callback();\n      }\n    };\n\n    var validateRepwd = function validateRepwd(rule, value, callback) {\n      if (value === '') {\n        callback(new Error(_this.$t('systemmanagement.systemmanagement_128')));\n      } else if (!validPassword(value)) {\n        callback(new Error(_this.$t('systemmanagement.systemmanagement_127')));\n      } else if (value !== _this.passDialogForm.pwd) {\n        callback(new Error(_this.$t('systemmanagement.systemmanagement_129')));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      hadSearch: false,\n      loading: false,\n      passDialogForm: {\n        userId: '',\n        pwd: '',\n        rePwd: ''\n      },\n      passDialogFormRules: {\n        pwd: [{\n          required: true,\n          validator: validatePwd,\n          trigger: 'blur'\n        }],\n        rePwd: [{\n          required: true,\n          validator: validateRepwd,\n          trigger: 'blur'\n        }]\n      },\n      editType: 1,\n      // 新建为1 ,用户授权为2, 3为修改密码\n      drawer: false,\n      form: {\n        username: '',\n        role: '',\n        status: -1,\n        systemType: -1\n      },\n      userData: {},\n      roleList: [],\n      userRole: [],\n      list: [],\n      dialogVisible: false,\n      currentData: {},\n      currentIndex: -1,\n      remark: '',\n      currentRow: {},\n      detailDrawer: false,\n      detailPermissions: []\n    };\n  },\n  computed: _objectSpread(_objectSpread(_objectSpread({}, mapGetters(['name'])), mapGetters(['buttonPermissions'])), mapGetters(['userInfo'])),\n  created: function created() {\n    this.loadRoleList();\n  },\n  activated: function activated() {\n    this.getUserDetail();\n  },\n  methods: {\n    loadData: function loadData() {\n      var _this2 = this;\n\n      this.loading = true;\n      var form = {\n        pageSize: this.pageSize,\n        pageIndex: this.pageIndex,\n        systemType: this.form.systemType,\n        roleId: this.form.role,\n        status: this.form.status,\n        userName: this.form.username && this.form.username.replace(/\\s+/g, '')\n      };\n      this.$api.merchantUserList(form).then(function (_) {\n        _this2.loading = false;\n\n        if (_.code === 200) {\n          _this2.list = _.data.userList;\n          _this2.total = _.data.totalRecord;\n        }\n      }).catch(function () {\n        _this2.loading = false;\n      });\n    },\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.loadData();\n    },\n    handleReset: function handleReset() {\n      this.form = {\n        username: '',\n        role: '',\n        status: -1,\n        systemType: -1\n      };\n      this.pageIndex = 1;\n      this.hadSearch = false;\n      this.initList();\n    },\n    handleSearch: function handleSearch() {\n      this.hadSearch = true;\n      this.pageIndex = 1;\n      this.loadData();\n    },\n    // 获取角色的所有可操作权限\n    loadRoleList: function loadRoleList() {\n      var _this3 = this;\n\n      this.$api.merchantUserRoleList().then(function (_) {\n        _this3.roleList = _this3.filterRoleList(_.data) || [];\n      });\n    },\n    filterRoleList: function filterRoleList(lists) {\n      return lists && lists.map(function (item) {\n        item.label = item.roleName;\n        item.key = item.id;\n        return item;\n      });\n    },\n    switchChange: function switchChange(val, row) {\n      var _this4 = this;\n\n      var params = {\n        userId: row.id,\n        status: val ? '1' : '0'\n      };\n      this.$api.merchantModifyUserStatus(params).then(function (res) {\n        if (res.code === 200) {\n          var index = _this4.list.findIndex(function (val) {\n            return val.id === row.id;\n          });\n\n          _this4.list[index].status = params.status;\n          var statusText = params.status === '1' ? _this4.$t('authoritymanagement_usermanage_index_328') : _this4.$t('authoritymanagement_usermanage_index_327');\n          return message({\n            message: _this4.$t('authoritymanagement_usermanage_index_342', [row.userName, statusText]),\n            type: 'success'\n          });\n        }\n      });\n    },\n    lockEvent: function lockEvent(row) {\n      var _this5 = this;\n\n      var params = {\n        userId: row.id\n      };\n      this.$api.modifyLockStatus(params).then(function (res) {\n        if (res.code === 200) {\n          _this5.loadData();\n\n          return message({\n            message: _this5.$t('authoritymanagement_usermanage_index_343', [row.userName]),\n            type: 'success'\n          });\n        }\n      });\n    },\n    editRow: function editRow(index, row) {\n      this.editType = 2;\n      this.drawer = true;\n      this.currentRow = row;\n      this.getUserDetail();\n    },\n    detailRow: function detailRow(index, row) {\n      var _this6 = this;\n\n      this.roleData = _objectSpread({}, row);\n      this.detailDrawer = true;\n      this.$api.getUserPermissions({\n        searchId: row.id\n      }).then(function (res) {\n        if (res.code === 200) {\n          _this6.detailPermissions = res.data || []; // 增加查看权限，相当于菜单，这个是前端增加的，为了这个tree组件兼容，提交的时候需要过滤掉id为'list'的值\n\n          _this6.detailPermissions.forEach(function (element) {\n            if (element.children && element.children.length !== 0) {\n              element.children.forEach(function (childElement) {\n                childElement.children = childElement.children || [];\n                childElement.children.unshift({\n                  children: null,\n                  id: 'list' + childElement.id,\n                  isExist: null,\n                  parentId: childElement.id,\n                  path: childElement,\n                  permissionName: 'view',\n                  type: 1\n                });\n              });\n            }\n          });\n\n          _this6.loopPermission(_this6.detailPermissions);\n        } else {\n          _this6.$message({\n            type: 'error',\n            message: _this6.$t('systemmanagement.systemmanagement_111')\n          });\n        }\n      });\n    },\n    loopPermission: function loopPermission(datas) {\n      var _this7 = this;\n\n      datas.forEach(function (i) {\n        i.permissionName = i18nRoute(i.permissionName);\n\n        if (i.children && i.children.length !== 0) {\n          _this7.loopPermission(i.children);\n        }\n      });\n    },\n    getUserDetail: function getUserDetail() {\n      var _this8 = this;\n\n      if (this.currentRow.id) {\n        this.$api.merchantGetUserDetail({\n          id: this.currentRow.id\n        }).then(function (_) {\n          if (_.code === 200) {\n            _this8.userData = _.data;\n            _this8.userRole = _.data.userRole || [];\n          }\n        });\n      }\n    },\n    editPass: function editPass(row) {\n      this.drawer = true;\n      this.editType = 3;\n      this.userData = _objectSpread({}, row);\n      this.passDialogForm.userName = row.userName;\n      this.passDialogForm.userId = row.id;\n    },\n    handleNewUser: function handleNewUser() {\n      this.drawer = true;\n      this.editType = 1;\n      this.userData = {\n        userName: '',\n        googleAuthCode: ''\n      };\n      this.userRole = [];\n    },\n    editCallBack: function editCallBack() {\n      this.loadData();\n    },\n    handleSure: function handleSure() {\n      var _this9 = this;\n\n      var data = {\n        userName: this.currentData.userName,\n        userId: this.currentData.id,\n        status: this.currentData.switchStatus ? 1 : 0,\n        remark: this.remark || ''\n      };\n      this.$api.merchantModifyUserStatus(data).then(function (_) {\n        // 静态更新状态\n        if (_.code === 200) {\n          _this9.loadData();\n\n          _this9.dialogVisible = false;\n          _this9.remark = '';\n\n          _this9.$message({\n            type: 'success',\n            message: _this9.$t('systemmanagement.systemmanagement_39')\n          });\n        }\n      });\n    },\n    closeDetail: function closeDetail() {\n      this.detailDrawer = false;\n    }\n  }\n};",null]}