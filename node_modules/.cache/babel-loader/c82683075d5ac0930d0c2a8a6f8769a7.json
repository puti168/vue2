{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\gamemanagement\\tableconfig\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\gamemanagement\\tableconfig\\index.vue","mtime":1615171048117},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.replace\";\nimport _objectSpread from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapGetters } from 'vuex';\nimport list from '@/mixins/list';\nimport EditTable from \"./components/EditTable\";\nimport { validPassword } from '@/utils/validate';\nimport { routerNames } from '@/utils/consts';\nexport default {\n  name: routerNames.systemUser,\n  components: {\n    EditTable: EditTable\n  },\n  mixins: [list],\n  data: function data() {\n    var _this = this;\n\n    var validatePwd = function validatePwd(rule, value, callback) {\n      if (value === '') {\n        callback(new Error(_this.$t('systemmanagement.systemmanagement_126')));\n      } else if (!validPassword(value)) {\n        callback(new Error(_this.$t('systemmanagement.systemmanagement_127')));\n      } else {\n        callback();\n      }\n    };\n\n    var validateRepwd = function validateRepwd(rule, value, callback) {\n      if (value === '') {\n        callback(new Error(_this.$t('systemmanagement.systemmanagement_128')));\n      } else if (!validPassword(value)) {\n        callback(new Error(_this.$t('systemmanagement.systemmanagement_127')));\n      } else if (value !== _this.passDialogForm.pwd) {\n        callback(new Error(_this.$t('systemmanagement.systemmanagement_129')));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      hadSearch: false,\n      loading: false,\n      passDialogVisible: false,\n      passDialogForm: {\n        userId: '',\n        pwd: '',\n        rePwd: ''\n      },\n      passDialogFormRules: {\n        pwd: [{\n          required: true,\n          validator: validatePwd,\n          trigger: 'blur'\n        }],\n        rePwd: [{\n          required: true,\n          validator: validateRepwd,\n          trigger: 'blur'\n        }]\n      },\n      editType: 0,\n      // 新建为0 ,编辑为1\n      drawer: false,\n      addDrawer: false,\n      currentPage: 1,\n      form: {\n        startTime: '',\n        endTime: '',\n        time: [],\n        userName: '',\n        status: -1,\n        createBy: '',\n        pageSize: '',\n        pageIndex: ''\n      },\n      userData: {},\n      permissions: [],\n      assignedPermissions: [],\n      list: [],\n      dialogVisible: false,\n      currentData: {},\n      currentIndex: -1,\n      remark: ''\n    };\n  },\n  computed: _objectSpread(_objectSpread(_objectSpread({}, mapGetters(['name'])), mapGetters(['buttonPermissions'])), mapGetters(['userInfo'])),\n  created: function created() {\n    this.loadRoleList();\n  },\n  methods: {\n    loadData: function loadData() {\n      var _this2 = this;\n\n      this.loading = true;\n      var initData = {\n        pageSize: this.pageSize,\n        pageIndex: this.pageIndex\n      };\n      var requestData = this.hadSearch ? {\n        startTime: this.form.time ? this.form.time[0] : '',\n        endTime: this.form.time ? this.form.time[1] : '',\n        createBy: this.form.createBy,\n        status: this.form.status,\n        userName: this.form.userName && this.form.userName.replace(/\\s+/g, '')\n      } : {};\n\n      var form = _objectSpread(_objectSpread({}, initData), requestData);\n\n      this.$api.merchantUserList(form).then(function (_) {\n        _this2.loading = false;\n\n        if (_.code === 200) {\n          _this2.list = _this2.getComList(_.data.userList);\n          _this2.total = _.data.totalRecord;\n        }\n      }).catch(function () {\n        _this2.loading = false;\n      });\n    },\n    getComList: function getComList(list) {\n      return list.map(function (item) {\n        if (item.status === '0') {\n          item.switchStatus = false;\n        } else if (item.status === '1') {\n          item.switchStatus = true;\n        }\n\n        return item;\n      });\n    },\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.loadData();\n    },\n    handleReset: function handleReset() {\n      this.form = {\n        startTime: '',\n        endTime: '',\n        time: [],\n        userName: '',\n        status: -1,\n        createBy: '',\n        pageSize: '',\n        pageIndex: ''\n      };\n      this.hadSearch = false;\n      this.initList();\n    },\n    handleSearch: function handleSearch() {\n      this.hadSearch = true;\n      this.pageIndex = 1;\n      this.loadData();\n    },\n    // 获取角色的所有可操作权限\n    loadRoleList: function loadRoleList() {\n      var _this3 = this;\n\n      this.$api.merchantUserRoleList().then(function (_) {\n        _this3.permissions = _this3.filterPermissions(_.data) || [];\n      });\n    },\n    filterPermissions: function filterPermissions(list) {\n      return list && list.map(function (item) {\n        item.label = item.roleName;\n        item.key = item.id;\n        return item;\n      });\n    },\n    handleDialogClose: function handleDialogClose() {\n      this.$refs.passDialogForm.resetFields();\n      this.passDialogVisible = false;\n    },\n    commitPassDialogForm: function commitPassDialogForm() {\n      var _this4 = this;\n\n      this.$refs.passDialogForm.validate(function (valid) {\n        if (valid) {\n          _this4.$api.merchantModifyUserPass(_this4.passDialogForm).then(function (_) {\n            if (_.code === 200) {\n              _this4.$refs.passDialogForm.resetFields();\n\n              _this4.$message({\n                type: 'success',\n                message: _this4.$t('systemmanagement.systemmanagement_39')\n              });\n\n              _this4.passDialogVisible = false;\n            }\n          });\n        }\n      });\n    },\n    editRow: function editRow(index, row) {\n      var _this5 = this;\n\n      this.drawer = true;\n      this.$api.merchantGetUserDetail({\n        id: row.id\n      }).then(function (_) {\n        if (_.code === 200) {\n          _this5.userData = _.data;\n          _this5.assignedPermissions = _.data.userRole || [];\n        }\n      });\n    },\n    editAccountStatus: function editAccountStatus(index, row) {\n      this.currentData = row;\n      this.currentIndex = index;\n      this.dialogVisible = true;\n    },\n    editPass: function editPass(row) {\n      this.addDrawer = true;\n      this.editType = 1;\n      this.userData = row;\n      this.passDialogForm.userName = row.userName;\n      this.passDialogForm.userId = row.id;\n    },\n    handleNewRole: function handleNewRole() {\n      this.addDrawer = true;\n      this.editType = 0;\n      this.userData = {\n        userName: ''\n      };\n      this.assignedPermissions = [];\n    },\n    stopRow: function stopRow(index, row, list) {\n      var _this6 = this;\n\n      var status = '-1';\n\n      if (row.status === '0') {\n        status = '1';\n      } else if (row.status === '1') {\n        status = '0';\n      }\n\n      this.$api.merchantModifyUserStatus({\n        userId: row.id,\n        userName: row.userName,\n        status: status\n      }).then(function (_) {\n        // 静态更新状态\n        if (_.code === 200) {\n          _this6.$set(_this6.list[index], 'status', status);\n        }\n      });\n    },\n    updateList: function updateList(id, status, list) {\n      var _this7 = this;\n\n      this.list = list.map(function (item) {\n        if (item.id === id) {\n          item.status = status;\n          item.statusText = status === '0' ? _this7.$t('gamemanagement_tableconfig_index_393') : _this7.$t('gamemanagement_tableconfig_index_394');\n        }\n\n        return item;\n      });\n    },\n    editCallBack: function editCallBack() {\n      this.loadData();\n    },\n    handleCancle: function handleCancle() {\n      this.remark = '';\n      this.dialogVisible = false;\n      this.currentData.switchStatus = !this.currentData.switchStatus;\n      this.list.splice(this.currentIndex, 1, this.currentData);\n    },\n    handleSure: function handleSure() {\n      var _this8 = this;\n\n      var data = {\n        userName: this.currentData.userName,\n        userId: this.currentData.id,\n        status: this.currentData.switchStatus ? 1 : 0,\n        remark: this.remark || ''\n      };\n      this.$api.merchantModifyUserStatus(data).then(function (_) {\n        // 静态更新状态\n        if (_.code === 200) {\n          _this8.loadData();\n\n          _this8.dialogVisible = false;\n          _this8.remark = '';\n\n          _this8.$message({\n            type: 'success',\n            message: _this8.$t('systemmanagement.systemmanagement_39')\n          });\n        }\n      });\n    }\n  }\n};",null]}