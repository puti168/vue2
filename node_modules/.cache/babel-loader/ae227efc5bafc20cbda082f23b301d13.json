{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\store\\modules\\user.js","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\store\\modules\\user.js","mtime":1617783516809},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport storage from 'store';\nimport { login, getInfo, logout } from '@/api/login';\nimport { ACCESS_TOKEN } from '@/store/mutation-types';\nimport { welcome } from '@/utils/util';\nvar user = {\n  state: {\n    token: '',\n    name: '',\n    welcome: '',\n    avatar: '',\n    roles: [],\n    info: {}\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.token = token;\n    },\n    SET_NAME: function SET_NAME(state, _ref) {\n      var name = _ref.name,\n          welcome = _ref.welcome;\n      state.name = name;\n      state.welcome = welcome;\n    },\n    SET_AVATAR: function SET_AVATAR(state, avatar) {\n      state.avatar = avatar;\n    },\n    SET_ROLES: function SET_ROLES(state, roles) {\n      state.roles = roles;\n    },\n    SET_INFO: function SET_INFO(state, info) {\n      state.info = info;\n    }\n  },\n  actions: {\n    // 登录\n    Login: function Login(_ref2, userInfo) {\n      var commit = _ref2.commit;\n      return new Promise(function (resolve, reject) {\n        login(userInfo).then(function (response) {\n          var result = response.data || {};\n\n          if (result.token) {\n            result.token = result.token;\n            storage.set(ACCESS_TOKEN, result.token, 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n          }\n\n          resolve(response);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 获取用户信息\n    GetInfo: function GetInfo(_ref3) {\n      var commit = _ref3.commit;\n      return new Promise(function (resolve, reject) {\n        getInfo().then(function (response) {\n          if (response.code != 200) {\n            reject(response.msg);\n            return;\n          }\n\n          var _ref4 = response.data || {},\n              _ref4$userInfo = _ref4.userInfo,\n              userInfo = _ref4$userInfo === void 0 ? {} : _ref4$userInfo;\n\n          if (!userInfo.username) {\n            reject('非法用户信息，请联系管理员');\n            return;\n          }\n\n          commit('SET_ROLES', [userInfo.roleId]);\n          commit('SET_INFO', userInfo);\n          commit('SET_NAME', {\n            name: userInfo.username,\n            welcome: welcome()\n          });\n          commit('SET_AVATAR', userInfo.avatar);\n          resolve(response);\n        }).catch(function (error) {\n          console.error(error);\n          reject('请求用户信息失败，请联系管理员');\n        });\n      });\n    },\n    // 登出\n    Logout: function Logout(_ref5) {\n      var commit = _ref5.commit,\n          state = _ref5.state;\n      return new Promise(function (resolve) {\n        logout(state.token).then(function () {\n          commit('SET_TOKEN', '');\n          commit('SET_ROLES', []);\n          storage.remove(ACCESS_TOKEN);\n          resolve();\n        }).catch(function () {\n          commit('SET_TOKEN', '');\n          commit('SET_ROLES', []);\n          storage.remove(ACCESS_TOKEN);\n          resolve();\n        }).finally(function () {});\n      });\n    }\n  }\n};\nexport default user;",null]}