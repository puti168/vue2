{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\merchant\\merchantInfo\\components\\EditAccount.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\merchant\\merchantInfo\\components\\EditAccount.vue","mtime":1616384580083},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { decimalValidate } from '@/utils/validate';\nimport { IsURL } from '@/utils';\nimport { mapGetters } from 'vuex';\nimport dayjs from 'dayjs';\nexport default {\n  name: 'EditAccount',\n  props: {\n    cloneApiRate: {\n      type: Number,\n      default: 0\n    },\n    cloneCountPercentage: {\n      type: Number,\n      default: 0\n    },\n    accountData: {\n      type: Object,\n      default: function _default() {}\n    },\n    value: {\n      type: Boolean,\n      default: false\n    },\n    currency: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    }\n  },\n  data: function data() {\n    return {\n      modalVisible: false,\n      showApiRate: false,\n      showDot: false,\n      apiRateData: [],\n      dotData: [],\n      accountForm: {\n        agentName: '',\n        apiRate: '',\n        cooperations: [],\n        buyCreditsEffectiveDate: '',\n        verifyCodeType: 1,\n        walletType: 0,\n        merchantType: 1\n      },\n      countPercentageStatus: true,\n      apiRateStatus: true,\n      showGoogleCode: true,\n      betLimits: []\n    };\n  },\n  computed: _objectSpread(_objectSpread({}, mapGetters(['globalDics', 'userInfo'])), {}, {\n    walletmodels: function walletmodels() {\n      return this.globalDics.walletmodel;\n    },\n    agenttype: function agenttype() {\n      return this.globalDics.agenttype;\n    },\n    accountFormRules: function accountFormRules() {\n      var _this = this;\n\n      /* eslint-disable */\n      var validateAgentName = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(rule, value, callback) {\n          var result;\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (!(_this.accountForm.type === 1)) {\n                    _context.next = 7;\n                    break;\n                  }\n\n                  _context.next = 3;\n                  return _this.$api.checkAgentNameConflict({\n                    agentName: value,\n                    agentId: _this.accountData.agentId\n                  });\n\n                case 3:\n                  result = _context.sent;\n\n                  if (result.data === 1) {\n                    callback(new Error(_this.$t('merchant_merchantinfo_components_editaccount_957')));\n                  } else if (!/^[[a-zA-Z0-9\\u4e00-\\u9fa5]+$/.test(value)) {\n                    callback(new Error(_this.$t('merchant_merchantinfo_components_editaccount_958')));\n                  } else if (value.length > 20) {\n                    callback(new Error(_this.$t('merchant_merchantinfo_components_editaccount_959')));\n                  } else if (value.length < 2) {\n                    callback(new Error(_this.$t('merchant_merchantinfo_components_editaccount_960')));\n                  } else {\n                    callback();\n                  }\n\n                  _context.next = 8;\n                  break;\n\n                case 7:\n                  if (!/^[[a-zA-Z0-9\\u4e00-\\u9fa5]+$/.test(value)) {\n                    callback(new Error(_this.$t('merchant_merchantinfo_components_editaccount_958')));\n                  } else if (value.length > 20) {\n                    callback(new Error(_this.$t('merchant_merchantinfo_components_editaccount_959')));\n                  } else if (value.length < 2) {\n                    callback(new Error(_this.$t('merchant_merchantinfo_components_editaccount_960')));\n                  } else {\n                    callback();\n                  }\n\n                case 8:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function validateAgentName(_x, _x2, _x3) {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      var countPercentageValidate = function countPercentageValidate(rule, value, callback) {\n        if (!decimalValidate(value) || Number(value) === 0 || Number(value) > 100) {\n          callback(new Error(_this.$t('merchant_merchantinfo_components_editaccount_961')));\n        } else {\n          callback();\n        }\n      };\n\n      var apiRateValidate = function apiRateValidate(rule, value, callback) {\n        if (!decimalValidate(value) || Number(value) === 0 || Number(value) > 100) {\n          callback(new Error(_this.$t('merchant_merchantinfo_components_editaccount_962')));\n        } else {\n          callback();\n        }\n      };\n\n      return {\n        agentName: [{\n          required: true,\n          trigger: 'blur',\n          message: this.$t('merchant_merchantinfo_components_editaccount_963')\n        }, {\n          validator: validateAgentName,\n          trigger: 'blur'\n        }],\n        apiRate: [{\n          required: true,\n          validator: apiRateValidate,\n          trigger: 'blur'\n        }],\n        countPercentage: [{\n          required: true,\n          validator: countPercentageValidate,\n          trigger: 'blur'\n        }],\n        walletType: [{\n          required: true,\n          message: this.$t('merchant.merchant_87'),\n          trigger: 'blur'\n        }],\n        walletUrl: [{\n          trigger: 'blur',\n          validator: function validator(rule, value, callback) {\n            if (!value || IsURL(value) && value.length <= 255) {\n              callback();\n            } else {\n              callback(new Error(_this.$t('merchant_merchantinfo_components_editaccount_964')));\n            }\n          }\n        }]\n      };\n    }\n  }),\n  watch: {\n    value: function value(val) {\n      this.modalVisible = val;\n    },\n    accountData: function accountData(val) {\n      this.accountForm = _objectSpread(_objectSpread({}, val), {}, {\n        cooperations: val.cooperationModel === 1 ? [2, 3] : [val.cooperationModel],\n        rateSharingEffectiveDate: val.rateSharingEffectiveDate ? dayjs(val.rateSharingEffectiveDate).valueOf() : new Date().valueOf(),\n        buyCreditsEffectiveDate: val.buyCreditsEffectiveDate ? dayjs(val.buyCreditsEffectiveDate).valueOf() : new Date().valueOf(),\n        verifyCodeType: val.verifyCodeType,\n        newPlayerLimitRed: val.newPlayerLimitRed\n      });\n      this.showGoogleCode = val.verifyCodeType === 1;\n      this.loadBetLimitList();\n    },\n    'accountForm.apiRate': {\n      handler: function handler(val) {\n        if (val && Number(val) !== Number(this.cloneApiRate) && this.accountData.cooperationModel !== 3) {\n          this.apiRateStatus = false;\n        } else {\n          this.apiRateStatus = true;\n        }\n      },\n      deep: true\n    },\n    'accountForm.countPercentage': {\n      handler: function handler(val) {\n        if (val && Number(val) !== Number(this.cloneCountPercentage) && this.accountData.cooperationModel !== 2) {\n          this.countPercentageStatus = false;\n        } else {\n          this.countPercentageStatus = true;\n        }\n      },\n      deep: true\n    },\n    'accountForm.verifyCodeType': function accountFormVerifyCodeType(val) {\n      if (val === 2) {\n        this.showGoogleCode = false;\n      } else {\n        this.showGoogleCode = true;\n      }\n    }\n  },\n  methods: {\n    loadBetLimitList: function loadBetLimitList() {\n      var _this2 = this;\n\n      // 自定义限红的type  因为自定义限红暂时隐藏，所以这里传type为 1\n      var type = 1;\n      this.$api.memberBetLimitList({\n        type: type\n      }).then(function (_) {\n        if (_.code === 200) {\n          _this2.betLimits = _.data || [];\n        }\n      });\n    },\n    getGoogleAuth: function getGoogleAuth() {\n      var _this3 = this;\n\n      this.$api.getGoogleAuth().then(function (res) {\n        if (res.code === 200) {\n          _this3.accountForm.googleAuthCode = res.data;\n        }\n      });\n    },\n    handleClose: function handleClose() {\n      this.showApiRate = false;\n      this.showDot = false;\n      this.$refs.accountForm.clearValidate();\n      this.$emit('input', false);\n    },\n    getCooperation: function getCooperation() {\n      var cooperations = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n      if (cooperations.length > 1) {\n        return 1;\n      }\n\n      return cooperations[0];\n    },\n    commitAccount: function commitAccount() {\n      var _this4 = this;\n\n      this.$refs.accountForm.validate(function (valid) {\n        if (valid) {\n          console.log(_this4.accountForm.platformAgent);\n\n          var form = _objectSpread(_objectSpread({}, _this4.accountForm), {}, {\n            model: _this4.accountForm.cooperations && _this4.getCooperation(_this4.accountForm.cooperations),\n            cooperationModel: _this4.accountForm.cooperations && _this4.getCooperation(_this4.accountForm.cooperations),\n            countPercentage: _this4.accountForm.countPercentage && Number(_this4.accountForm.countPercentage),\n            // apiRate: this.accountForm.apiRate && Number(this.accountForm.apiRate),\n            rateSharingEffectiveDate: String(_this4.accountForm.rateSharingEffectiveDate),\n            buyCreditsEffectiveDate: String(_this4.accountForm.buyCreditsEffectiveDate),\n            agentId: _this4.accountForm.agentId,\n            editUserName: _this4.accountForm.adminUserName,\n            verifyCodeType: _this4.accountForm.verifyCodeType,\n            newPlayerLimitRed: _this4.accountForm.newPlayerLimitRed\n          });\n\n          console.log('form :>> ', form);\n\n          _this4.$api.merchantUpdate(form).then(function (_) {\n            if (_.code === 200) {\n              _this4.$emit('input', false);\n\n              form.rateSharingEffectiveDate = form.rateSharingEffectiveDate && dayjs(Number(form.rateSharingEffectiveDate)).format('YYYY-MM-DD hh:mm:ss');\n              form.buyCreditsEffectiveDate = form.buyCreditsEffectiveDate && dayjs(Number(form.buyCreditsEffectiveDate)).format('YYYY-MM-DD hh:mm:ss');\n\n              _this4.$emit('editSuccess', form);\n\n              _this4.$message({\n                message: _this4.$t('merchant.merchant_88'),\n                type: 'success'\n              });\n            }\n          });\n        }\n      });\n    },\n    filterCurrency: function filterCurrency(type) {\n      if (!type) return '';\n      return this.currency.filter(function (item) {\n        return item.value === type;\n      })[0].text;\n    },\n    // 根据合作模式的不同，展示不同结算账户\n    getSettlementAccount: function getSettlementAccount() {\n      if (this.accountForm.cooperations.includes(2) && this.accountForm.cooperations.includes(3)) {\n        return this.$t('merchant_merchantinfo_components_editaccount_965');\n      } else if (this.accountForm.cooperations.includes(2)) {\n        return this.$t('merchant_merchantinfo_components_editaccount_966');\n      } else if (this.accountForm.cooperations.includes(3)) {\n        return this.$t('merchant_merchantinfo_components_editaccount_967');\n      }\n    },\n    // 获取货币类型\n    getCurrency: function getCurrency() {\n      var _this5 = this;\n\n      var index = this.currency.findIndex(function (val) {\n        return Number(val.id) === Number(_this5.accountForm.currency);\n      });\n\n      if (index > -1) {\n        return this.currency[index].code;\n      }\n    }\n  }\n};",null]}