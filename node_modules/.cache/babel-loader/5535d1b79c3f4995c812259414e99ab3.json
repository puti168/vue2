{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\systemmanagement\\downloadlog\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\systemmanagement\\downloadlog\\index.vue","mtime":1615171048174},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/es6.number.constructor\";\nimport _objectSpread from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport list from '@/mixins/list';\nimport { mapGetters } from 'vuex';\nimport { routerNames } from '@/utils/consts';\nimport SelectAgentTree from '@/components/SelectAgentTree';\nimport dayjs from 'dayjs';\nimport { message } from '@/utils/message';\nexport default {\n  name: routerNames.downloadlog,\n  components: {\n    SelectAgentTree: SelectAgentTree\n  },\n  mixins: [list],\n  data: function data() {\n    var end = dayjs().endOf('day').valueOf();\n    var start = dayjs().startOf('day').subtract(6, 'd').valueOf();\n    return {\n      hadSearch: false,\n      loading: false,\n      form: {\n        ip: '',\n        time: [start, end],\n        agentId: ''\n      }\n    };\n  },\n  computed: _objectSpread({}, mapGetters(['buttonPermissions'])),\n  methods: {\n    loadData: function loadData() {\n      var _this = this;\n\n      if (this.form.time) {\n        var divides = Number(this.form.time[1]) - Number(this.form.time[0]);\n\n        if (divides > 90 * 24 * 60 * 60 * 1000) {\n          return message({\n            type: 'error',\n            message: this.$t('systemmanagement_downloadlog_index_1401')\n          });\n        }\n      }\n\n      this.loading = true;\n      var initData = {\n        pageSize: this.pageSize,\n        pageIndex: this.pageIndex,\n        startDate: this.form.time ? this.form.time[0] : '',\n        endDate: this.form.time ? this.form.time[1] : ''\n      };\n      var requestData = this.hadSearch ? {\n        createdBy: this.form.createdBy,\n        agentId: this.form.agentId\n      } : {};\n\n      var form = _objectSpread(_objectSpread({}, initData), requestData);\n\n      this.$api.listDownPage(_objectSpread({}, form)).then(function (_) {\n        _this.loading = false;\n        var data = _.data;\n        _this.total = data.totalRecord;\n        _this.list = data.record;\n      }).catch(function () {\n        _this.loading = false;\n      });\n    },\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.loadData();\n    },\n    handleReset: function handleReset() {\n      var end = dayjs().endOf('day').valueOf();\n      var start = dayjs().startOf('day').subtract(6, 'd').valueOf();\n      this.form = {\n        time: [start, end],\n        agentId: '',\n        createdBy: ''\n      };\n      this.hadSearch = false;\n      this.initList();\n    },\n    handleSearch: function handleSearch() {\n      this.hadSearch = true;\n      this.pageIndex = 1;\n      this.loadData();\n    },\n    // 重新生成文件\n    uploadAgain: function uploadAgain(id) {\n      var _this2 = this;\n\n      this.$api.uploadAgain({\n        id: id\n      }).then(function (res) {\n        if (res.code === 200) {\n          var index = _this2.list.findIndex(function (val) {\n            return val.id === id;\n          });\n\n          if (index > -1) {\n            var newOne = _objectSpread(_objectSpread({}, _this2.list[index]), {}, {\n              status: '2'\n            });\n\n            _this2.list.splice(index, 1, newOne);\n          }\n\n          return message({\n            message: _this2.$t('systemmanagement_downloadlog_index_1402'),\n            type: 'success'\n          });\n        }\n      });\n    },\n    // 下载文件\n    downLoadFile: function downLoadFile(id) {\n      var _this3 = this;\n\n      this.$api.downLoadFile({\n        id: id\n      }).then(function (res) {\n        window.open(res.data.resourceUrl, '_blank');\n\n        if (res.code === 200) {\n          var index = _this3.list.findIndex(function (val) {\n            return val.id === id;\n          });\n\n          if (index > -1) {\n            var newOne = _objectSpread(_objectSpread({}, _this3.list[index]), {}, {\n              status: '3'\n            });\n\n            _this3.list.splice(index, 1, newOne);\n          }\n        }\n      });\n    }\n  }\n};",null]}