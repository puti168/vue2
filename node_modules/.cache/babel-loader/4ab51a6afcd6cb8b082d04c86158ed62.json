{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\listPermissionItem\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\listPermissionItem\\index.vue","mtime":1616384580048},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport _objectSpread from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport list from '@/mixins/list';\nimport { mapGetters } from 'vuex';\nimport { routerNames } from '@/utils/consts';\nimport AuthoritySearch from '@/views/authoritymanagement/listPermissionItem/components/AuthoritySearch';\nimport { i18nRoute } from '@/utils/i18n';\nexport default {\n  name: routerNames.agentsLimitRed,\n  components: {\n    AuthoritySearch: AuthoritySearch\n  },\n  mixins: [list],\n  data: function data() {\n    return {\n      drawer: false,\n      limitPlanShow: false,\n      limitStatus: 1,\n      editFlag: 0,\n      form: {\n        id: ''\n      },\n      query: [],\n      limitDialogVisible: false,\n      EditLimitForm: {},\n      limitId: '',\n      limitPlanData: {}\n    };\n  },\n  computed: _objectSpread(_objectSpread({}, mapGetters(['buttonPermissions'])), {}, {\n    cities: function cities() {\n      return [{\n        value: 5,\n        label: this.$t('merchant_merchantinfo_components_edittrial_973')\n      }, {\n        value: 4,\n        label: this.$t('merchant_merchantinfo_components_edittrial_972')\n      }, {\n        value: 1,\n        label: this.$t('merchant.merchant_139')\n      }];\n    },\n    rules: function rules() {\n      var _this = this;\n\n      var validName = function validName(rule, value, callback) {\n        var regValue = value ? value.replace(/[\\u4e00-\\u9fa5]/g, 'xx') : '';\n\n        if (regValue && /^[A-Za-z0-9]{4,20}$/.test(regValue)) {\n          callback();\n        } else {\n          callback(new Error(_this.$t('message.deskValidName')));\n        }\n      };\n\n      var validateNumber = function validateNumber(rule, value, callback) {\n        var EditLimitForm = _this.EditLimitForm;\n\n        if (!/^[0-9]*[1-9][0-9]*$/.test(value)) {\n          callback(new Error(_this.$t('message.integerThan0')));\n        } else if (rule.field === 'max' && EditLimitForm.min && Number(EditLimitForm.min) > Number(value)) {\n          callback(new Error(_this.$t('message.maxThanMin')));\n        } else if (rule.field === 'min' && EditLimitForm.max && Number(EditLimitForm.max) < Number(value)) {\n          callback(new Error(_this.$t('message.minThanMax')));\n        }\n\n        callback();\n      };\n\n      return {\n        limitRedName: [{\n          required: true,\n          validator: validName,\n          trigger: 'blur'\n        }],\n        min: [{\n          required: true,\n          message: this.$t('message.minimumBet'),\n          trigger: 'blur'\n        }, {\n          validator: validateNumber,\n          trigger: 'blur'\n        }],\n        max: [{\n          required: true,\n          message: this.$t('message.maximumBet'),\n          trigger: 'blur'\n        }, {\n          validator: validateNumber,\n          trigger: 'blur'\n        }]\n      };\n    }\n  }),\n  methods: {\n    loadData: function loadData() {\n      var _this2 = this;\n\n      this.$api.listPermissionItem().then(function (_) {\n        if (_.code === 200) {\n          _this2.list = _this2.filterRes(_.data);\n          console.log(_this2.list);\n        } else {\n          _this2.list = [];\n        }\n      }).catch(function (_) {\n        _this2.list = [];\n      });\n    },\n    handleCheckAllChange: function handleCheckAllChange(val, row) {\n      if (row.check5 && row.check4 && row.check1) {\n        row.isIndeterminate = false;\n        row.checkAll = false;\n        row.check5 = false;\n        row.check4 = false;\n        row.check1 = false;\n        return;\n      }\n\n      row.checkAll = true;\n      row.check5 = true;\n      row.check4 = true;\n      row.check1 = true;\n      row.isIndeterminate = false;\n    },\n    check: function check(val, row) {\n      if (row.check5 && row.check4 && row.check1) {\n        row.isIndeterminate = false;\n        row.checkAll = true;\n        return;\n      }\n\n      if (!row.check5 && !row.check4 && !row.check1) {\n        row.isIndeterminate = false;\n        row.checkAll = false;\n        return;\n      }\n\n      row.isIndeterminate = true;\n    },\n    confirm: function confirm() {\n      var _this3 = this;\n\n      this.pushChildren(this.list);\n      var loading = this.$loading({\n        lock: true,\n        text: 'Loading',\n        spinner: 'el-icon-loading',\n        background: 'rgba(0, 0, 0, 0.7)'\n      });\n      this.$api.initPermission({\n        list: this.query\n      }).then(function (_) {\n        if (_.code === 200) {\n          _this3.$message({\n            message: _this3.$t('notice.notice_39'),\n            type: 'success'\n          });\n        }\n\n        loading.close();\n      }).catch(function (_) {\n        loading.close();\n      });\n      this.query = [];\n    },\n    pushChildren: function pushChildren(child) {\n      var _this4 = this;\n\n      child.forEach(function (item) {\n        if (item.checkAll) {\n          _this4.query.push({\n            permissionId: item.id,\n            systemType: 0\n          });\n        } else {\n          if (item.check5) {\n            _this4.query.push({\n              permissionId: item.id,\n              systemType: 5\n            });\n          }\n\n          if (item.check4) {\n            _this4.query.push({\n              permissionId: item.id,\n              systemType: 4\n            });\n          }\n\n          if (item.check1) {\n            _this4.query.push({\n              permissionId: item.id,\n              systemType: 1\n            });\n          }\n        }\n\n        if (item.children && item.children.length > 0) {\n          _this4.pushChildren(item.children);\n        }\n      });\n    },\n    filterRes: function filterRes(data) {\n      var _this5 = this;\n\n      var result = [];\n\n      if (data) {\n        data.forEach(function (element) {\n          if (element.parentId === 0) {\n            result.push(_objectSpread(_objectSpread({}, element), {}, {\n              check1: false,\n              check4: false,\n              check5: false,\n              checkAll: false,\n              isIndeterminate: false,\n              children: []\n            }));\n          }\n        }); // 必须先插入父节点，再循环子节点\n\n        data.forEach(function (element) {\n          if (element.parentId !== 0) {\n            var findIndex = result.findIndex(function (e) {\n              return e.id === element.parentId;\n            });\n\n            if (findIndex >= 0) {\n              result[findIndex].children.push(_objectSpread(_objectSpread({}, element), {}, {\n                check1: false,\n                check4: false,\n                check5: false,\n                checkAll: false,\n                isIndeterminate: false\n              }));\n            }\n          }\n        });\n      }\n\n      if (result.length > 0) {\n        result.forEach(function (r) {\n          if (r.children.length > 0) {\n            _this5.patchChildren(r.children, data);\n          }\n        });\n      }\n\n      return result;\n    },\n    patchChildren: function patchChildren(child, data) {\n      child.forEach(function (item) {\n        item.children = data.filter(function (d) {\n          return d.parentId === item.id;\n        });\n      });\n    },\n    changeLimitStatus: function changeLimitStatus(val) {\n      this.limitStatus = val;\n      this.loadData();\n    },\n    handleCurrentChange: function handleCurrentChange(val) {\n      console.log(this.$t('merchant.merchant_27', [val]));\n      this.loadData();\n    },\n    handleReset: function handleReset() {\n      this.form = {\n        id: '',\n        time: ''\n      };\n    },\n    handleNewLimit: function handleNewLimit() {\n      this.editFlag = 0;\n      this.EditLimitForm = {};\n      this.limitDialogVisible = true;\n    },\n    handleDetail: function handleDetail(item) {\n      this.limitPlanShow = true;\n      this.limitPlanData = _objectSpread(_objectSpread({}, item), {}, {\n        type: this.limitStatus\n      });\n    },\n    editRow: function editRow(index, row, flag) {\n      this.limitDialogVisible = true;\n      this.editFlag = flag;\n      this.EditLimitForm = row;\n    },\n    stopRow: function stopRow(index, row) {\n      var _this6 = this;\n\n      var status = row.status ? 0 : 1;\n      this.$api.merchantLimitRedModifyStatus(_objectSpread(_objectSpread({}, row), {}, {\n        status: status\n      })).then(function (_) {\n        if (_.code === 200) {\n          _this6.$message({\n            type: 'success',\n            message: _this6.$t('merchant.merchant_28')\n          });\n\n          _this6.loadData();\n        }\n      });\n    },\n    cancelLimitDialog: function cancelLimitDialog() {\n      this.limitDialogVisible = false;\n      this.$refs.form.resetFields();\n    },\n    commitLimitDialog: function commitLimitDialog() {\n      var _this7 = this;\n\n      var form = this.EditLimitForm;\n      this.$refs.form.validate(function (valid) {\n        if (valid) {\n          if (_this7.editFlag) {\n            // 修改\n            _this7.$api.merchantLimitRedEdit(form).then(function (_) {\n              if (_.code === 200) {\n                _this7.limitDialogVisible = false;\n\n                _this7.$message({\n                  type: 'success',\n                  message: _this7.$t('merchant.merchant_28')\n                });\n              }\n            });\n          } else {\n            _this7.$api.merchantLimitRedAdd(form).then(function (_) {\n              if (_.code === 200) {\n                _this7.limitDialogVisible = false;\n\n                _this7.$message({\n                  type: 'success',\n                  message: _this7.$t('merchant.merchant_29')\n                });\n              }\n            });\n          }\n        }\n      });\n    },\n    getNameByTran: function getNameByTran(row) {\n      return i18nRoute(row.permissionName);\n    }\n  }\n};",null]}