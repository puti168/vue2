{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\rolemanage\\components\\EditRole.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\rolemanage\\components\\EditRole.vue","mtime":1617695097407},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapGetters } from 'vuex';\nimport { generateTitle } from '@/utils/i18n';\nimport { message } from '@/utils/message';\nexport default {\n  name: 'Editrole',\n  props: {\n    type: {\n      type: Number,\n      default: 0\n    },\n    permissions: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    assignedPermissions: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    roledata: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    }\n  },\n  data: function data() {\n    return {\n      transferKey: 0,\n      checkedAll: false,\n      checkedKeys: [],\n      ps: [],\n      form: {\n        roleName: '',\n        remark: ''\n      },\n      direction: 'ttb',\n      memoryRemark: '',\n      // 用于判断是否做修改,\n      memoryIds: []\n    };\n  },\n  computed: _objectSpread(_objectSpread({}, mapGetters(['userInfo'])), {}, {\n    defaultProps: function defaultProps() {\n      return {\n        label: function label(data) {\n          return generateTitle(data.permissionName);\n        },\n        children: 'children'\n      };\n    },\n    rules: function rules() {\n      var _this = this;\n\n      var validRoleName = function validRoleName(rule, value, callback) {\n        if (!value) {\n          callback(new Error(_this.$t('authoritymanagement_rolemanage_components_editrole_1')));\n        } else if (value && value.length > 20) {\n          callback(new Error(_this.$t('authoritymanagement_rolemanage_components_editrole_254')));\n        } else if (!/^[\\u4e00-\\u9fa5a-zA-Z]{1,20}$/.test(value)) {\n          callback(new Error(_this.$t('authoritymanagement_rolemanage_components_editrole_255')));\n        } else {\n          callback();\n        }\n      };\n\n      return {\n        roleName: [{\n          required: true,\n          message: this.$t('authoritymanagement_rolemanage_components_editrole_256'),\n          trigger: 'blur'\n        }, {\n          validator: validRoleName,\n          trigger: 'blur'\n        }]\n      };\n    }\n  }),\n  watch: {\n    roledata: {\n      handler: function handler(newVal, old) {\n        if (newVal.id) {\n          this.form.roleName = newVal.roleName;\n          this.form.remark = newVal.remark;\n          this.memoryRemark = newVal.remark;\n          this.form.id = newVal.id;\n          this.form.systemType = newVal.systemType;\n        } else {\n          this.resetForm();\n        }\n      },\n      immediate: true,\n      deep: true\n    },\n    permissions: {\n      handler: function handler(newVal, oldVal) {\n        var _this2 = this;\n\n        if (newVal) {\n          console.log('newVal :>> ', newVal);\n          this.ps = newVal;\n          this.$nextTick(function () {\n            // 叶子节点平铺\n            var doms = document.querySelectorAll('.el-tree-node__content > .is-leaf') || [];\n            doms.length !== 0 && doms.forEach(function (node) {\n              // try {\n              // \tif (\n              // \t\tnode.parentNode &&\n              // \t\t(node.parentNode\n              // \t\t\t.querySelector('.el-tree-node__label')\n              // \t\t\t.innerHTML.includes('查看完整账号信息') ||\n              // \t\t\tnode.parentNode\n              // \t\t\t\t.querySelector('.el-tree-node__label')\n              // \t\t\t\t.innerHTML.includes('View full account information'))\n              // \t) {\n              // \t\tnode.parentNode.classList.add('no-tile')\n              // \t} else {\n              // \t\tnode.parentNode.classList.add('tile')\n              // \t}\n              // } catch (error) {\n              // \tconsole.log('error :>> ', error)\n              // \tnode.parentNode.classList.add('tile')\n              // }\n              node.parentNode.classList.add('tile');\n            });\n\n            _this2.checkIfAllChecked();\n          });\n        }\n      },\n      deep: true\n    },\n    assignedPermissions: {\n      handler: function handler(newVal, oldVal) {\n        var _this3 = this;\n\n        if (newVal.length && newVal.length > 0) {\n          newVal.forEach(function (element) {\n            if (element.includes('list')) {\n              _this3.memoryIds.push(element.replace('list', ''));\n            } else {\n              _this3.memoryIds.push(element);\n            }\n          });\n          this.$refs.tree.setCheckedKeys(newVal);\n          this.$nextTick(function () {\n            _this3.checkIfAllChecked();\n          });\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    checkIfAllChecked: function checkIfAllChecked() {\n      var arr = this.filterPS(this.ps);\n      arr = arr.filter(function (val) {\n        return !val.id.includes('list');\n      });\n\n      if (arr.length <= this.assignedPermissions.length) {\n        this.checkedAll = true;\n      } else {\n        this.checkedAll = false;\n      }\n    },\n    // 点击复选框判断是否全选\n    clickIfAllChecked: function clickIfAllChecked(checkedKeys) {\n      var arr = this.filterPS(this.ps);\n\n      if (arr.length === checkedKeys.length) {\n        this.checkedAll = true;\n      } else {\n        this.checkedAll = false;\n      }\n    },\n    checkAllChange: function checkAllChange(val) {\n      if (val) {\n        this.selectAll();\n      } else {\n        this.resetTree();\n      }\n    },\n    check: function check(data, obj) {\n      if (!obj.checkedKeys.includes(data.id) && data.id.includes('list')) {\n        this.$refs.tree.setChecked(data.parentId, false, true);\n      }\n\n      if (obj.checkedKeys.includes(data.id)) {\n        this.$refs.tree.setChecked(\"list\".concat(data.parentId), true);\n      }\n\n      this.clickIfAllChecked(obj.checkedKeys);\n    },\n    selectAll: function selectAll() {\n      if (this.$refs.tree) this.$refs.tree.setCheckedNodes(this.ps);\n    },\n    resetTree: function resetTree() {\n      if (this.$refs.tree) this.$refs.tree.setCheckedNodes([]);\n    },\n    filterAssignedKeys: function filterAssignedKeys(arr) {\n      var list = [];\n      arr.forEach(function (item) {\n        list.push(item.id);\n      });\n      return list;\n    },\n    filterPS: function filterPS(ps) {\n      var list = [];\n\n      var getList = function getList(ps) {\n        ps.forEach(function (item) {\n          if (item.children) {\n            list.push(item);\n            getList(item.children);\n          } else {\n            list.push(item);\n          }\n        });\n      };\n\n      getList(ps);\n      return list;\n    },\n    resetForm: function resetForm() {\n      this.form = {};\n      this.checkedAll = false;\n      this.resetTree();\n    },\n    handleSure: function handleSure() {\n      var _this4 = this;\n\n      var permissionKeys = [];\n      var keys = this.$refs.tree.getCheckedKeys() || [];\n      var halfKeys = this.$refs.tree.getHalfCheckedKeys() || [];\n      permissionKeys = keys.concat(halfKeys); // 过滤掉id为'list'的值\n\n      permissionKeys = permissionKeys.filter(function (element) {\n        return !element.includes('list');\n      });\n      this.$refs.form.validate(function (valid) {\n        if (valid) {\n          if (keys.length === 0) {\n            return message({\n              type: 'error',\n              message: _this4.$t('authoritymanagement_rolemanage_components_editrole_257')\n            });\n          } // 获取参数\n\n\n          var form = _objectSpread({\n            permissionIds: permissionKeys\n          }, _this4.form);\n\n          console.log('form :', form);\n\n          if (_this4.type === 0) {\n            _this4.$api.merchantAddRole(form).then(function (_) {\n              if (_.code === 200) {\n                message({\n                  type: 'success',\n                  message: _this4.$t('authoritymanagement_rolemanage_components_editrole_258', [form.roleName])\n                });\n\n                _this4.$emit('handleCallBack');\n\n                _this4.$emit('closeEdit');\n              }\n            });\n          } else {\n            var beforeData = {\n              remark: _this4.memoryRemark,\n              ids: _this4.memoryIds.sort()\n            };\n            var nowData = {\n              remark: _this4.form.remark,\n              ids: form.permissionIds.sort()\n            };\n\n            if (JSON.stringify(beforeData) === JSON.stringify(nowData)) {\n              return message({\n                message: _this4.$t('authoritymanagement_rolemanage_components_editrole_259'),\n                type: 'warning'\n              });\n            }\n\n            _this4.$api.merchantEditRole(form).then(function (_) {\n              if (_.code === 200) {\n                _this4.resetDialog();\n\n                message({\n                  type: 'success',\n                  message: _this4.$t('authoritymanagement_rolemanage_components_editrole_260', [form.roleName])\n                });\n\n                _this4.$emit('handleCallBack');\n\n                _this4.$emit('closeEdit');\n              }\n            });\n          }\n        } else {\n          var isError = document.getElementsByClassName('is-error');\n          setTimeout(function () {\n            isError[0].querySelector('input').focus();\n          }, 500);\n        }\n      });\n    },\n    handleClose: function handleClose() {\n      this.$emit('closeEdit');\n    },\n    handleClosed: function handleClosed() {\n      this.resetDialog();\n    },\n    resetDialog: function resetDialog() {\n      this.$refs.form.resetFields();\n      this.transferKey = +new Date();\n      this.memoryRemark = '';\n      this.memoryIds = [];\n    }\n  }\n};",null]}