{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\usermanage\\components\\EditUser.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\usermanage\\components\\EditUser.vue","mtime":1617695097409},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { validPassword } from '@/utils/validate';\nimport { message } from '@/utils/message';\nimport { mapGetters } from 'vuex';\nimport store from '@/store';\nimport router from '@/router'; // import md5 from 'js-md5'\n\nexport default {\n  name: 'Edituser',\n  props: {\n    type: {\n      type: Number,\n      default: 1 // 新建为1 ,用户授权为2, 3为修改密码\n\n    },\n    drawer: Boolean,\n    roleList: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    userRole: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    userdata: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    }\n  },\n  data: function data() {\n    return {\n      dialogKey: 0,\n      transferKey: 0,\n      tranferVal: [],\n      elDrawer: false,\n      showGoogleCode: true,\n      form: {\n        nickName: '',\n        userName: '',\n        pwd: '',\n        rePwd: '',\n        googleAuthCode: '',\n        verifyCodeType: 1\n      },\n      memoryData: [] // 用于判断是否做修改\n\n    };\n  },\n  computed: _objectSpread(_objectSpread({}, mapGetters(['userInfo'])), {}, {\n    rules: function rules() {\n      var _this = this;\n\n      var validNumberUserName = function validNumberUserName(rule, value, callback) {\n        if (!/^[a-zA-Z]([0-9]|[a-zA-Z])*$/g.test(value)) {\n          callback(new Error(_this.$t('authoritymanagement_usermanage_components_edituser_306')));\n        } else if (value.length < 5) {\n          callback(new Error(_this.$t('authoritymanagement_usermanage_components_edituser_307')));\n        } else if (value.length > 12) {\n          callback(new Error(_this.$t('authoritymanagement_usermanage_components_edituser_308')));\n        } else {\n          callback();\n        }\n      };\n\n      var validNumberEnCn = function validNumberEnCn(rule, value, callback) {\n        if (value && /^[\\u4e00-\\u9fa5a-zA-Z0-9_]{0,30}$/.test(value)) {\n          callback();\n        } else {\n          callback(new Error(_this.$t('merchant.merchant_143')));\n        }\n      };\n\n      var validatePwd = function validatePwd(rule, value, callback) {\n        if (value && value.length < 6) {\n          callback(new Error(_this.$t('authoritymanagement_usermanage_components_edituser_309')));\n        } else if (value && value.length > 12) {\n          callback(new Error(_this.$t('authoritymanagement_usermanage_components_edituser_310')));\n        } else if (value === '' || !validPassword(value)) {\n          callback(new Error(_this.$t('authoritymanagement_usermanage_components_edituser_311')));\n        } else {\n          callback();\n        }\n      };\n\n      var validateRepwd = function validateRepwd(rule, value, callback) {\n        if (value !== _this.form.pwd) {\n          callback(new Error(_this.$t('authoritymanagement_usermanage_components_edituser_312')));\n        } else {\n          callback();\n        }\n      };\n\n      return {\n        userName: [{\n          required: true,\n          message: this.$t('systemmanagement.systemmanagement_130'),\n          trigger: 'blur'\n        }, {\n          validator: validNumberUserName,\n          trigger: 'blur'\n        }],\n        nickName: [{\n          required: true,\n          message: this.$t('systemmanagement.systemmanagement_119'),\n          trigger: 'blur'\n        }, {\n          validator: validNumberEnCn,\n          trigger: 'blur'\n        }],\n        pwd: [{\n          required: true,\n          validator: validatePwd,\n          trigger: 'blur'\n        }],\n        rePwd: [{\n          required: true,\n          validator: validateRepwd,\n          trigger: 'blur'\n        }],\n        googleAuthCode: [{\n          required: true,\n          message: this.$t('authoritymanagement_usermanage_components_edituser_313'),\n          trigger: 'blur'\n        }]\n      };\n    }\n  }),\n  watch: {\n    drawer: function drawer(val) {\n      var _this2 = this;\n\n      this.elDrawer = val;\n\n      if (val) {\n        this.$nextTick(function () {\n          _this2.$refs.form.clearValidate();\n        });\n      }\n    },\n    userdata: {\n      handler: function handler(newVal) {\n        var _this3 = this;\n\n        if (this.type === 1) {\n          this.getGoogleAuth();\n        }\n\n        console.log(newVal);\n\n        if (newVal) {\n          if (newVal.verifyCodeType) {\n            this.form = _objectSpread({}, newVal);\n          } else {\n            this.form = _objectSpread(_objectSpread({}, newVal), {}, {\n              verifyCodeType: 1\n            });\n          }\n\n          newVal.userRole && newVal.userRole.forEach(function (val) {\n            if (val.isExist === '1') {\n              _this3.memoryData.push(val.id);\n            }\n          });\n        }\n      },\n      deep: true\n    },\n    userRole: {\n      handler: function handler(newVal, oldVal) {\n        this.tranferVal = this.filterAssignedKeys(newVal);\n      },\n      deep: true\n    },\n    'form.verifyCodeType': function formVerifyCodeType(val) {\n      if (val === 2) {\n        this.showGoogleCode = false;\n      } else {\n        this.showGoogleCode = true;\n      }\n    }\n  },\n  methods: {\n    getGoogleAuth: function getGoogleAuth() {\n      var _this4 = this;\n\n      this.$api.getGoogleAuth().then(function (res) {\n        if (res.code === 200) {\n          _this4.form.googleAuthCode = res.data;\n        }\n      });\n    },\n    renderTitle: function renderTitle() {\n      var type = this.type;\n\n      if (type === 1) {\n        return this.$t('authoritymanagement_usermanage_components_edituser_314');\n      } else if (type === 2) {\n        return this.$t('authoritymanagement_usermanage_components_edituser_315');\n      }\n\n      return this.$t('authoritymanagement_usermanage_components_edituser_316');\n    },\n    filterAssignedKeys: function filterAssignedKeys(arr) {\n      var list = [];\n      arr.forEach(function (item) {\n        if (item.isExist === '1') {\n          list.push(item.id);\n        }\n      });\n      return list;\n    },\n    handleRequest: function handleRequest(params) {\n      var _this5 = this;\n\n      var api = this.type === 1 ? 'merchantAddUser' : this.type === 2 ? 'merchantEditUser' : 'merchantModifyUserPass';\n      this.$api[api](params).then(function (res) {\n        if (res.code === 200) {\n          _this5.$emit('update:drawer', false);\n\n          if (_this5.type === 3) {\n            if (_this5.userdata.userName === _this5.userInfo.username) {\n              setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n                var fullPath;\n                return regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        fullPath = router.history.current.fullPath;\n                        _context.next = 3;\n                        return store.dispatch('user/logout');\n\n                      case 3:\n                        _context.next = 5;\n                        return store.dispatch('permission/clearRoutes');\n\n                      case 5:\n                        router.push(\"/login?redirect=\".concat(fullPath));\n\n                      case 6:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              })), 1000);\n            } else {\n              _this5.$emit('handleCallBack');\n            }\n          } else {\n            _this5.$emit('handleCallBack');\n          }\n\n          return message({\n            type: 'success',\n            message: _this5.$t('authoritymanagement_usermanage_components_edituser_317')\n          });\n        }\n      });\n    },\n    handleSure: function handleSure() {\n      var _this6 = this;\n\n      this.$refs.form.validate(function (valid) {\n        if (valid) {\n          // 获取参数\n          var form = {\n            // pwd: this.type !== 2 ? md5(this.form.pwd + this.form.userName.toLocaleLowerCase().trim()) : undefined,\n            // rePwd: this.type !== 2 ? md5(this.form.rePwd + this.form.userName.toLocaleLowerCase().trim()) : undefined,\n            pwd: _this6.type !== 2 ? _this6.form.pwd : undefined,\n            rePwd: _this6.type !== 2 ? _this6.form.rePwd : undefined,\n            roleIds: _this6.type !== 3 ? _this6.tranferVal : undefined,\n            googleAuthCode: _this6.form.googleAuthCode,\n            userName: _this6.form.userName.toLocaleLowerCase(),\n            userId: _this6.form.id,\n            verifyCodeType: _this6.form.verifyCodeType\n          }; // if (\n          // \tthis.type === 2 &&\n          // \tJSON.stringify(form.roleIds) === JSON.stringify(this.memoryData)\n          // ) {\n          // \treturn message({\n          // \t\tmessage: '未作修改，不能提交',\n          // \t\ttype: 'warning'\n          // \t})\n          // }\n\n          if (_this6.type !== 3) {\n            if (!form.roleIds || form.roleIds.length === 0) {\n              return message({\n                message: _this6.$t('authoritymanagement_usermanage_components_edituser_318'),\n                type: 'error'\n              });\n            }\n          }\n\n          _this6.handleRequest(form);\n        }\n      });\n    },\n    handleClose: function handleClose() {\n      var _this7 = this;\n\n      this.$emit('update:drawer', false);\n      this.resetForm();\n      setTimeout(function () {\n        _this7.dialogKey = +new Date();\n      }, 100);\n    },\n    resetForm: function resetForm() {\n      this.transferKey = +new Date();\n      this.tranferVal = [];\n      this.memoryData = [];\n    }\n  }\n};",null]}