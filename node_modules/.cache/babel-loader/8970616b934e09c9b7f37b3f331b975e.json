{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\merchant\\merchantInfo\\components\\NewBusiness.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\merchant\\merchantInfo\\components\\NewBusiness.vue","mtime":1616384580089},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"C:/Users/admin/Desktop/merchant-manager-web/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { validPassword, decimalValidate } from '@/utils/validate';\nimport { IsURL } from '@/utils';\nimport { mapGetters } from 'vuex';\nimport { message } from '@/utils/message';\nimport dayjs from 'dayjs';\nexport default {\n  name: 'NewBusiness',\n  props: {\n    businessDrawer: {\n      type: Boolean,\n      default: false\n    },\n    type: {\n      type: Number,\n      default: 1\n    },\n    // 1为新增商户商户 2位新增线路商商户,\n    agentCode: {\n      type: String,\n      default: function _default() {\n        return '';\n      }\n    },\n    md5: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    agentType: {\n      type: [String, Number],\n      default: function _default() {\n        return '';\n      }\n    },\n    googleAuthCode: {\n      type: String,\n      default: function _default() {\n        return '';\n      }\n    },\n    agentsLevel: {\n      type: String,\n      default: function _default() {\n        return '';\n      }\n    },\n    createLevel: {\n      type: String,\n      default: function _default() {\n        return '';\n      }\n    },\n    platformAgent: {\n      type: Number,\n      default: function _default() {\n        return 1;\n      }\n    },\n    agentId: {\n      type: String,\n      default: function _default() {\n        return '';\n      }\n    },\n    currencyId: {\n      type: String,\n      default: function _default() {\n        return '1';\n      }\n    },\n    apiRate: {\n      type: Number,\n      default: function _default() {\n        return 0;\n      }\n    },\n    countPercentage: {\n      type: Number,\n      default: function _default() {\n        return 0;\n      }\n    },\n    cooperationModel: {\n      type: Number,\n      default: function _default() {\n        return 0;\n      }\n    }\n  },\n  data: function data() {\n    return {\n      step: 0,\n      drawer: false,\n      // 全部数据\n      data: [],\n      // 树数据\n      tree: [],\n      agentName: '',\n      agentCode2: '',\n      storeDatas: [],\n      currency: {},\n      form: {\n        agentName: '',\n        agentCode: '',\n        agentType: '',\n        apiRate: '',\n        walletMd5key: '',\n        showInPage: '',\n        countPercentage: '',\n        password: '',\n        passwordAgain: '',\n        walletModel: 1,\n        platformAgent: 0,\n        walletUrl: '',\n        currency: this.$store.state.user.userInfo.currencyId + '' || '1',\n        cooperations: [],\n        dsStartTime: dayjs().format('YYYY-MM-DD'),\n        rateStartTime: dayjs().format('YYYY-MM-DD'),\n        verifyCodeType: 1,\n        walletType: 0,\n        limitRed: ''\n      },\n      direction: 'ttb',\n      showGoogleCode: true,\n      betLimits: []\n    };\n  },\n  computed: _objectSpread(_objectSpread(_objectSpread({}, mapGetters(['globalDics'])), mapGetters(['userInfo'])), {}, {\n    walletmodel: function walletmodel() {\n      return this.globalDics.walletmodel;\n    },\n    rules: function rules() {\n      var _this = this;\n\n      var validAdminAccount = function validAdminAccount(rule, value, callback) {\n        if (!/^[a-zA-Z]([0-9]|[a-zA-Z])*$/g.test(value)) {\n          callback(new Error(_this.$t('merchant_merchantinfo_components_newbusiness_1055')));\n        } else if (value.length < 5) {\n          callback(new Error(_this.$t('merchant_merchantinfo_components_newbusiness_1056')));\n        } else if (value.length > 12) {\n          callback(new Error(_this.$t('merchant_merchantinfo_components_newbusiness_1057')));\n        } else {\n          callback();\n        }\n      };\n\n      var countPercentageValidate = function countPercentageValidate(rule, value, callback) {\n        if (!decimalValidate(value) || Number(value) === 0 || Number(value) > 100) {\n          callback(new Error(_this.$t('merchant_merchantinfo_components_newbusiness_1058')));\n        } else if (_this.countPercentage && _this.createLevel !== 'top' && Number(value) > Number(_this.countPercentage)) {\n          callback(new Error(_this.$t('merchant_merchantinfo_components_newbusiness_1059')));\n        } else {\n          callback();\n        }\n      };\n\n      var apiRateValidate = function apiRateValidate(rule, value, callback) {\n        if (!decimalValidate(value) || Number(value) === 0 || Number(value) > 100) {\n          callback(new Error(_this.$t('merchant_merchantinfo_components_newbusiness_1060')));\n        } else if (_this.apiRate && _this.createLevel !== 'top' && Number(value) < Number(_this.apiRate)) {\n          callback(new Error(_this.$t('merchant_merchantinfo_components_newbusiness_1061')));\n        } else {\n          callback();\n        }\n      };\n      /* eslint-disable */\n\n\n      var validateAgentName = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(rule, value, callback) {\n          var result;\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return _this.$api.checkAgentNameConflict({\n                    agentName: value\n                  });\n\n                case 2:\n                  result = _context.sent;\n\n                  if (result.data === 1) {\n                    callback(new Error(_this.$t('merchant_merchantinfo_components_editaccount_957')));\n                  } else if (!/^[a-zA-Z0-9\\u4e00-\\u9fa5]+$/.test(value)) {\n                    callback(new Error(_this.$t('systemmanagement_currency_index_16')));\n                  } else if (value.length > 20) {\n                    callback(new Error(_this.$t('systemmanagement_parameter_index_25')));\n                  } else if (value.length < 2) {\n                    callback(new Error(_this.$t('systemmanagement_parameter_index_26')));\n                  } else {\n                    callback();\n                  }\n\n                case 4:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function validateAgentName(_x, _x2, _x3) {\n          return _ref.apply(this, arguments);\n        };\n      }();\n      /* eslint-disable */\n\n\n      var validatePass = function validatePass(rule, value, callback) {\n        if (!validPassword(value)) {\n          callback(new Error(_this.$t('merchant.merchant_111')));\n        } else {\n          callback();\n        }\n      };\n\n      var validateDialogPass2 = function validateDialogPass2(rule, value, callback) {\n        if (!validPassword(value)) {\n          callback(new Error(_this.$t('merchant.merchant_111')));\n        } else if (value !== _this.form.password) {\n          callback(new Error(_this.$t('merchant.merchant_112')));\n        } else {\n          callback();\n        }\n      };\n\n      return {\n        walletType: [{\n          required: true,\n          message: this.$t('merchant.merchant_87'),\n          trigger: 'blur'\n        }],\n        agentLoginName: [{\n          required: true,\n          trigger: 'blur',\n          message: this.$t('merchant_merchantinfo_components_newbusiness_1062')\n        },, {\n          validator: validAdminAccount,\n          trigger: 'blur'\n        }],\n        agentName: [{\n          required: true,\n          trigger: 'blur',\n          message: this.$t('merchant_merchantinfo_components_newbusiness_1063')\n        }, {\n          validator: validateAgentName,\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          validator: validatePass,\n          trigger: 'blur'\n        }],\n        passwordAgain: [{\n          required: true,\n          validator: validateDialogPass2,\n          trigger: 'blur'\n        }],\n        countPercentage: [{\n          required: true,\n          validator: countPercentageValidate,\n          trigger: 'blur'\n        }],\n        apiRate: [{\n          required: true,\n          validator: apiRateValidate,\n          trigger: 'blur'\n        }],\n        walletModel: [{\n          required: true,\n          message: this.$t('merchant.merchant_115'),\n          trigger: 'blur'\n        }],\n        walletUrl: [{\n          trigger: 'blur',\n          validator: function validator(rule, value, callback) {\n            console.log('value.length :', value.length);\n\n            if (!value || IsURL(value) && value.length <= 255) {\n              callback();\n            } else {\n              callback(new Error(_this.$t('merchant_merchantinfo_components_newbusiness_1064')));\n            }\n          }\n        }],\n        currency: [{\n          required: true,\n          message: this.$t('merchant.merchant_135'),\n          trigger: 'blur'\n        }],\n        cooperations: [{\n          required: true,\n          message: this.$t('merchant_merchantinfo_components_newbusiness_1065'),\n          trigger: 'change'\n        }],\n        verifyCodeType: [{\n          required: true,\n          message: this.$t('merchant_merchantinfo_components_newbusiness_1066'),\n          trigger: 'change'\n        }]\n      };\n    }\n  }),\n  watch: {\n    agentCode: function agentCode(val) {\n      if (val) {\n        this.form.agentCode = val;\n      }\n    },\n    md5: function md5(val) {\n      if (val) {\n        this.form.walletMd5key = val.save;\n        this.form.showInPage = val.showInPage;\n      }\n    },\n    agentType: function agentType(val) {\n      if (val) {\n        this.form.agentType = val;\n      }\n    },\n    googleAuthCode: function googleAuthCode(val) {\n      if (val) {\n        this.form.googleAuthCode = val;\n        this.$set(this.form);\n      }\n    },\n    currencyId: {\n      handler: function handler(val) {\n        this.form.currency = val;\n      }\n    },\n    businessDrawer: function businessDrawer(val) {\n      var _this2 = this;\n\n      this.loadBetLimitList();\n      this.$api.getCurrencyComboBoxList({\n        pageIndex: 1,\n        pageSize: 100\n      }).then(function (_) {\n        var data = _.data;\n        _this2.currency = data.record;\n      });\n      this.drawer = val;\n    },\n    'form.verifyCodeType': function formVerifyCodeType(val) {\n      if (val === 2) {\n        this.showGoogleCode = false;\n      } else {\n        this.showGoogleCode = true;\n      }\n    }\n  },\n  mounted: function mounted() {},\n  methods: {\n    loadBetLimitList: function loadBetLimitList() {\n      var _this3 = this;\n\n      // 自定义限红的type  因为自定义限红暂时隐藏，所以这里传type为 1\n      var type = 1;\n      this.$api.memberBetLimitList({\n        type: type\n      }).then(function (_) {\n        if (_.code === 200) {\n          _this3.betLimits = _.data || [];\n\n          if (_this3.betLimits && _this3.betLimits.length > 0) {\n            _this3.form.limitRed = _this3.betLimits[0].id;\n          }\n        }\n      });\n    },\n    handleClose: function handleClose() {\n      this.$emit('update:businessDrawer', false);\n      this.$refs.form.clearValidate();\n      this.reset();\n    },\n    reset: function reset() {\n      this.step = 0;\n      this.form = {\n        googleAuthCode: '',\n        agentName: '',\n        agentCode: '',\n        agentType: '',\n        apiRate: '',\n        countPercentage: '',\n        walletMd5key: '',\n        showInpage: '',\n        password: '',\n        passwordAgain: '',\n        walletModel: 1,\n        walletType: 0,\n        platformAgent: 0,\n        walletUrl: '',\n        currency: this.$store.state.user.userInfo.currencyId + '' || '1',\n        cooperations: [],\n        dsStartTime: dayjs().format('YYYY-MM-DD'),\n        rateStartTime: dayjs().format('YYYY-MM-DD'),\n        verifyCodeType: 1\n      };\n      this.$emit('updateDialog');\n    },\n    clickLastStep: function clickLastStep() {\n      this.$refs.form.clearValidate();\n      this.step = this.step - 1;\n    },\n    clickNextStep: function clickNextStep() {\n      var _this4 = this;\n\n      this.$refs.form.validate(function (valid) {\n        if (valid) {\n          if (_this4.step === 1) {\n            var params = {\n              googleAuthCode: _this4.form.googleAuthCode,\n              agentLoginName: _this4.form.agentLoginName,\n              walletMd5key: _this4.form.walletMd5key,\n              agentCode: _this4.form.agentCode,\n              platformAgent: _this4.form.platformAgent,\n              agentName: _this4.form.agentName,\n              apiRate: _this4.form.apiRate && Number(_this4.form.apiRate),\n              countPercentage: _this4.form.countPercentage && Number(_this4.form.countPercentage),\n              currency: _this4.form.currency,\n              model: _this4.form.cooperations.length > 1 ? 1 : _this4.form.cooperations[0],\n              walletModel: _this4.form.walletModel,\n              walletType: _this4.form.walletType,\n              walletUrl: _this4.form.walletUrl,\n              verifyCodeType: _this4.form.verifyCodeType,\n              newPlayerLimitRed: _this4.form.limitRed\n            };\n            var api = '';\n\n            if (_this4.createLevel === 'top') {\n              api = _this4.type === 1 ? 'createMerchant' : 'createAgent';\n            } else {\n              params = _objectSpread(_objectSpread({}, params), {}, {\n                parentId: _this4.agentId,\n                agentType: _this4.form.agentType\n              });\n              api = _this4.type === 1 ? 'createMerchantOverLevel' : 'createAgentOverLevel';\n            }\n\n            _this4.$api[api](params).then(function (res) {\n              if (res.code === 200) {\n                _this4.$emit('update:businessDrawer', false);\n\n                message({\n                  type: 'success',\n                  message: _this4.$t('merchant_merchantinfo_components_newbusiness_1067')\n                });\n\n                _this4.$emit('closeEdit', false);\n\n                _this4.reset();\n              }\n            });\n          } else {\n            _this4.step = _this4.step + 1;\n          }\n        }\n      });\n    },\n    renderStepBtnText: function renderStepBtnText() {\n      if (this.step === 1) {\n        return this.$t('merchant_merchantinfo_components_newbusiness_1068');\n      }\n\n      return this.$t('merchant_merchantinfo_components_newbusiness_1069');\n    },\n    // 根据合作模式的不同，展示不同, type 1为 显示合作模式 2位显示结算账户\n    renderCooperationText: function renderCooperationText(type) {\n      if (this.form.cooperations.includes(2) && this.form.cooperations.includes(3)) {\n        return type === 1 ? this.$t('merchant_merchantinfo_components_newbusiness_1070') : this.$t('merchant_merchantinfo_components_newbusiness_1071');\n      } else if (this.form.cooperations.includes(2)) {\n        return type === 1 ? this.$t('merchant_merchantinfo_components_newbusiness_1015') : this.$t('merchant_merchantinfo_components_newbusiness_1072');\n      } else if (this.form.cooperations.includes(3)) {\n        return type === 1 ? this.$t('merchant_merchantinfo_components_newbusiness_1016') : this.$t('merchant_merchantinfo_components_newbusiness_1073');\n      }\n    },\n    // 获取货币类型\n    getCurrency: function getCurrency() {\n      var _this5 = this;\n\n      var index = this.currency.findIndex(function (val) {\n        return Number(val.id) === Number(_this5.form.currency);\n      });\n\n      if (index > -1) {\n        return this.currency[index].code;\n      }\n    },\n    // 通过agentCode判断当前用户是否顶级 AAAAA为顶级\n    judgeAgentCode: function judgeAgentCode() {\n      // 一级/二级/(0,1)线路商时可选择币种，其他线路商的下级线路商/商户继承上级线路商币种\n      var num = Number(this.agentsLevel);\n\n      if ([1, 2].includes(num)) {\n        return false;\n      } else {\n        return true;\n      }\n    },\n    getDefailtLimit: function getDefailtLimit() {\n      var _this6 = this;\n\n      var find = this.betLimits.find(function (i) {\n        return i.id === _this6.form.limitRed;\n      });\n      return find ? find.limitRedName : '-';\n    }\n  }\n};",null]}