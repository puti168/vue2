{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\rolemanage\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\rolemanage\\index.vue","mtime":1617695097407},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { mapGetters } from 'vuex'\r\nimport list from '@/mixins/list'\r\nimport EditRole from './components/EditRole'\r\nimport RoleDetail from './components/RoleDetail'\r\nimport Modal from '@/components/Modal'\r\nimport { routerNames } from '@/utils/consts'\r\nimport { message } from '@/utils/message'\r\nimport { i18nRoute } from '@/utils/i18n'\r\n\r\nexport default {\r\n\tname: routerNames.systemRole,\r\n\tcomponents: { EditRole, Modal, RoleDetail },\r\n\tmixins: [list],\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tcurOperation: '',\r\n\t\t\thadSearch: false,\r\n\t\t\tloading: false,\r\n\t\t\tdeleteDialog: false,\r\n\t\t\teditType: 0, // 新建为0 ,编辑为1\r\n\t\t\tdrawer: false,\r\n\t\t\tdetailDrawer: false,\r\n\t\t\tcurrentPage: 1,\r\n\t\t\tform: {\r\n\t\t\t\troleName: '',\r\n\t\t\t\tstatus: -1\r\n\t\t\t},\r\n\t\t\troleData: {},\r\n\t\t\tpermissions: [],\r\n\t\t\tassignedPermissions: [],\r\n\t\t\tdialogVisible: false,\r\n\t\t\tcurrentData: {},\r\n\t\t\tcurrentIndex: -1,\r\n\t\t\tremark: '',\r\n\t\t\tlist: [],\r\n\t\t\tshowAccount: false,\r\n\t\t\trelatives: [], // 关联的账号\r\n\t\t\tdetailPermissions: []\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['name']),\r\n\t\t...mapGetters(['buttonPermissions']),\r\n\t\trelativesStr() {\r\n\t\t\tlet str = ''\r\n\t\t\tif (this.relatives.length === 0) {\r\n\t\t\t\tstr = this.$t('authoritymanagement_rolemanage_index_282')\r\n\t\t\t} else {\r\n\t\t\t\tstr = this.relatives.join('，')\r\n\t\t\t}\r\n\t\t\treturn str\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tdocument.addEventListener('click', this.showRelative)\r\n\t},\r\n\tdestroyed() {\r\n\t\tdocument.removeEventListener('click', this.showRelative)\r\n\t},\r\n\tmethods: {\r\n\t\tshowRelative(e) {\r\n\t\t\tif (\r\n\t\t\t\te.target.innerText &&\r\n\t\t\t\te.target.innerText.replace(' ', '') !==\r\n\t\t\t\t\tthis.$t('authoritymanagement_rolemanage_index_1') &&\r\n\t\t\t\te.target.innerText.includes(['View', 'linked', 'accounts'])\r\n\t\t\t) {\r\n\t\t\t\tthis.showAccount = false\r\n\t\t\t}\r\n\t\t},\r\n\t\tcheckRelative(e, row) {\r\n\t\t\tthis.showAccount = !this.showAccount\r\n\t\t\tif (this.currentData.id !== row.id) {\r\n\t\t\t\tthis.currentData = { ...row }\r\n\t\t\t\tthis.showAccount = true\r\n\t\t\t}\r\n\t\t\tif (this.showAccount) {\r\n\t\t\t\tthis.$api\r\n\t\t\t\t\t.getAccList({\r\n\t\t\t\t\t\troleId: row.id\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then((res) => {\r\n\t\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\t\tthis.relatives = res.data || []\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tconst scrollTop = this.getScrollOffset().y\r\n\t\t\t\t\tconst top = e.target.getBoundingClientRect().top + scrollTop + 18\r\n\t\t\t\t\tconst accountDom = this.$refs.account\r\n\t\t\t\t\taccountDom.style.display = 'block'\r\n\t\t\t\t\taccountDom.style.top = top + 'px'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetScrollOffset() {\r\n\t\t\tif (window.pageXOffset) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: window.pageXOffset,\r\n\t\t\t\t\ty: window.pageYOffset\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: document.body.scrollLeft + document.documentElement.scrollLeft,\r\n\t\t\t\t\ty: document.body.scrollTop + document.documentElement.scrollTop\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tloadData() {\r\n\t\t\tthis.loading = true\r\n\t\t\tconst initData = {\r\n\t\t\t\tpageSize: this.pageSize,\r\n\t\t\t\tpageIndex: this.pageIndex,\r\n\t\t\t\troleName: this.form.roleName,\r\n\t\t\t\tstatus: this.form.status\r\n\t\t\t}\r\n\r\n\t\t\tthis.$api\r\n\t\t\t\t.merchantRoleList(initData)\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\tconst data = _.data\r\n\t\t\t\t\tthis.total = data.totalRecord\r\n\t\t\t\t\tthis.list = data.roleList\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t})\r\n\t\t},\r\n\t\t// 获取角色的所有可操作权限\r\n\t\tloadPermissions() {\r\n\t\t\tthis.$api.merchantPermissions().then((_) => {\r\n\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\tthis.permissions = _.data || []\r\n\t\t\t\t\t// 增加查看权限，相当于菜单，这个是前端增加的，为了这个tree组件兼容，提交的时候需要过滤掉id为'list'的值\r\n\t\t\t\t\tthis.permissions.forEach((element) => {\r\n\t\t\t\t\t\tif (element.children && element.children.length !== 0) {\r\n\t\t\t\t\t\t\telement.children.forEach((childElement) => {\r\n\t\t\t\t\t\t\t\tchildElement.children = childElement.children || []\r\n\t\t\t\t\t\t\t\tchildElement.children.unshift({\r\n\t\t\t\t\t\t\t\t\tchildren: null,\r\n\t\t\t\t\t\t\t\t\tid: 'list' + childElement.id,\r\n\t\t\t\t\t\t\t\t\tisExist: null,\r\n\t\t\t\t\t\t\t\t\tparentId: childElement.id,\r\n\t\t\t\t\t\t\t\t\tpath: childElement,\r\n\t\t\t\t\t\t\t\t\tpermissionName: 'view',\r\n\t\t\t\t\t\t\t\t\ttype: 1\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.loopPermission(this.permissions)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\ttype: 'error',\r\n\t\t\t\t\t\tmessage: this.$t('systemmanagement.systemmanagement_111')\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tloopPermission(datas) {\r\n\t\t\tdatas.forEach((i) => {\r\n\t\t\t\ti.permissionName = i18nRoute(i.permissionName)\r\n\t\t\t\tif (i.children && i.children.length !== 0) {\r\n\t\t\t\t\tthis.loopPermission(i.children)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tswitchChange(val, row) {\r\n\t\t\tconst params = {\r\n\t\t\t\troleName: row.roleName,\r\n\t\t\t\tid: row.id,\r\n\t\t\t\tstatus: val ? '1' : '0',\r\n\t\t\t\tsystemType: row.systemType\r\n\t\t\t}\r\n\t\t\tthis.$api.merchantModifyStatus(params).then((res) => {\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tif (res.data === 1) {\r\n\t\t\t\t\t\tthis.dialogVisible = true\r\n\t\t\t\t\t\tthis.currentData = { ...row }\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst index = this.list.findIndex((val) => val.id === row.id)\r\n\t\t\t\t\t\tthis.list[index].status = params.status\r\n\t\t\t\t\t\tconst statusText =\r\n\t\t\t\t\t\t\tparams.status === '1'\r\n\t\t\t\t\t\t\t\t? this.$t('authoritymanagement_rolemanage_index_269')\r\n\t\t\t\t\t\t\t\t: this.$t('authoritymanagement_rolemanage_index_268')\r\n\t\t\t\t\t\treturn message({\r\n\t\t\t\t\t\t\tmessage: this.$t('authoritymanagement_rolemanage_index_284', [\r\n\t\t\t\t\t\t\t\trow.roleName,\r\n\t\t\t\t\t\t\t\tstatusText\r\n\t\t\t\t\t\t\t]),\r\n\t\t\t\t\t\t\ttype: 'success'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tupdateStatus(form) {\r\n\t\t\treturn this.$api.merchantModifyStatus(form)\r\n\t\t},\r\n\t\thandleCurrentChange(val) {\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\thandleDelete() {\r\n\t\t\tthis.$api\r\n\t\t\t\t.systemDeleteRole({\r\n\t\t\t\t\tid: this.currentData.id,\r\n\t\t\t\t\troleName: this.currentData.roleName,\r\n\t\t\t\t\tremark: this.remark || ''\r\n\t\t\t\t})\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tthis.dialogVisible = false\r\n\t\t\t\t\tthis.deleteDialog = false\r\n\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\tmessage: this.$t('systemmanagement.systemmanagement_73'),\r\n\t\t\t\t\t\ttype: 'success'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.loadData()\r\n\t\t\t\t})\r\n\t\t},\r\n\t\thandleCancle() {\r\n\t\t\tthis.dialogVisible = false\r\n\t\t\tthis.curOperation = 'cancle'\r\n\t\t},\r\n\t\tonClosed() {\r\n\t\t\tif (this.deleteDialog) {\r\n\t\t\t\tthis.deleteDialog = false\r\n\t\t\t} else {\r\n\t\t\t\tthis.remark = ''\r\n\t\t\t\tif (this.curOperation === 'cancle') {\r\n\t\t\t\t\tthis.currentData.switchStatus = this.currentData.status === '1'\r\n\t\t\t\t\tthis.list.splice(this.currentIndex, 1, this.currentData)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\thandleSure() {\r\n\t\t\tif (this.deleteDialog) {\r\n\t\t\t\tthis.handleDelete()\r\n\t\t\t} else {\r\n\t\t\t\tthis.updateStatus({\r\n\t\t\t\t\troleName: this.currentData.roleName,\r\n\t\t\t\t\tid: this.currentData.id,\r\n\t\t\t\t\tstatus: this.currentData.switchStatus ? 1 : 0,\r\n\t\t\t\t\tremark: this.remark || '',\r\n\t\t\t\t\tsystemType: this.currentData.systemType\r\n\t\t\t\t}).then((_) => {\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tthis.dialogVisible = false\r\n\t\t\t\t\t\tthis.curOperation = 'sure'\r\n\t\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\t\tmessage: this.$t('systemmanagement.systemmanagement_39'),\r\n\t\t\t\t\t\t\ttype: 'success'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tthis.loadData()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\thandleReset() {\r\n\t\t\tthis.form = {\r\n\t\t\t\troleName: '',\r\n\t\t\t\tstatus: -1\r\n\t\t\t}\r\n\t\t\tthis.pageIndex = 1\r\n\t\t\tthis.hadSearch = false\r\n\t\t\tthis.initList()\r\n\t\t},\r\n\t\thandleSearch() {\r\n\t\t\tthis.hadSearch = true\r\n\t\t\tthis.pageIndex = 1\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\teditRow(index, row) {\r\n\t\t\tthis.loadPermissions()\r\n\t\t\tthis.editType = 1\r\n\t\t\tthis.roleData = { ...row }\r\n\t\t\tthis.drawer = true\r\n\t\t\tthis.$api.merchantRoleDetail({ id: row.id }).then((res) => {\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tconst currentPermissions = []\r\n\r\n\t\t\t\t\tres.data.assignedPermissions &&\r\n\t\t\t\t\t\tres.data.assignedPermissions.forEach((element) => {\r\n\t\t\t\t\t\t\tif (element.isExist === '1' && element.type !== '0') {\r\n\t\t\t\t\t\t\t\tcurrentPermissions.push(element.id)\r\n\t\t\t\t\t\t\t} else if (element.isExist === '1' && element.type === '0') {\r\n\t\t\t\t\t\t\t\tcurrentPermissions.push(`list${element.id}`)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\tthis.assignedPermissions = currentPermissions\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tdetailRow(index, row) {\r\n\t\t\tthis.editType = 1\r\n\t\t\tthis.roleData = { ...row }\r\n\t\t\tthis.detailDrawer = true\r\n\t\t\tthis.$api.getRoleDetail({ searchId: row.id }).then((res) => {\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tthis.detailPermissions = res.data || []\r\n\t\t\t\t\t// 增加查看权限，相当于菜单，这个是前端增加的，为了这个tree组件兼容，提交的时候需要过滤掉id为'list'的值\r\n\t\t\t\t\tthis.detailPermissions.forEach((element) => {\r\n\t\t\t\t\t\tif (element.children && element.children.length !== 0) {\r\n\t\t\t\t\t\t\telement.children.forEach((childElement) => {\r\n\t\t\t\t\t\t\t\tchildElement.children = childElement.children || []\r\n\t\t\t\t\t\t\t\tchildElement.children.unshift({\r\n\t\t\t\t\t\t\t\t\tchildren: null,\r\n\t\t\t\t\t\t\t\t\tid: 'list' + childElement.id,\r\n\t\t\t\t\t\t\t\t\tisExist: null,\r\n\t\t\t\t\t\t\t\t\tparentId: childElement.id,\r\n\t\t\t\t\t\t\t\t\tpath: childElement,\r\n\t\t\t\t\t\t\t\t\tpermissionName: 'view',\r\n\t\t\t\t\t\t\t\t\ttype: 1\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.loopPermission(this.detailPermissions)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\ttype: 'error',\r\n\t\t\t\t\t\tmessage: this.$t('systemmanagement.systemmanagement_111')\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tdeleteRow(index, row, list) {\r\n\t\t\tthis.currentData = { ...row }\r\n\t\t\tthis.dialogVisible = true\r\n\t\t\tthis.deleteDialog = true\r\n\t\t},\r\n\t\thandleNewRole() {\r\n\t\t\tthis.loadPermissions()\r\n\t\t\tthis.editType = 0\r\n\t\t\tthis.roleData = {\r\n\t\t\t\tid: '',\r\n\t\t\t\troleName: '',\r\n\t\t\t\tremark: ''\r\n\t\t\t}\r\n\t\t\tthis.assignedPermissions = []\r\n\t\t\tthis.drawer = true\r\n\t\t},\r\n\t\tcheckHasPermissions() {\r\n\t\t\tif (!this.permissions || this.permissions.length === 0) {\r\n\t\t\t\tthis.$message.error(this.$t('systemmanagement.systemmanagement_116'))\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\treturn true\r\n\t\t},\r\n\t\teditCallBack() {\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\tcloseEdit() {\r\n\t\t\tthis.drawer = false\r\n\t\t},\r\n\t\tcloseDetail() {\r\n\t\t\tthis.detailDrawer = false\r\n\t\t}\r\n\t}\r\n}\r\n",null]}