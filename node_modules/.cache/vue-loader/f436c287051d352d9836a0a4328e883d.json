{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\listPermissionItem\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\listPermissionItem\\index.vue","mtime":1616384580048},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport list from '@/mixins/list'\r\nimport { mapGetters } from 'vuex'\r\nimport { routerNames } from '@/utils/consts'\r\nimport AuthoritySearch from '@/views/authoritymanagement/listPermissionItem/components/AuthoritySearch'\r\nimport { i18nRoute } from '@/utils/i18n'\r\nexport default {\r\n\tname: routerNames.agentsLimitRed,\r\n\tcomponents: {\r\n\t\tAuthoritySearch\r\n\t},\r\n\tmixins: [list],\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tdrawer: false,\r\n\t\t\tlimitPlanShow: false,\r\n\t\t\tlimitStatus: 1,\r\n\t\t\teditFlag: 0,\r\n\t\t\tform: {\r\n\t\t\t\tid: ''\r\n\t\t\t},\r\n\t\t\tquery: [],\r\n\t\t\tlimitDialogVisible: false,\r\n\t\t\tEditLimitForm: {},\r\n\t\t\tlimitId: '',\r\n\t\t\tlimitPlanData: {}\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['buttonPermissions']),\r\n\t\tcities() {\r\n\t\t\treturn [\r\n\t\t\t\t{\r\n\t\t\t\t\tvalue: 5,\r\n\t\t\t\t\tlabel: this.$t('merchant_merchantinfo_components_edittrial_973')\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tvalue: 4,\r\n\t\t\t\t\tlabel: this.$t('merchant_merchantinfo_components_edittrial_972')\r\n\t\t\t\t},\r\n\t\t\t\t{ value: 1, label: this.$t('merchant.merchant_139') }\r\n\t\t\t]\r\n\t\t},\r\n\t\trules() {\r\n\t\t\tconst validName = (rule, value, callback) => {\r\n\t\t\t\tconst regValue = value ? value.replace(/[\\u4e00-\\u9fa5]/g, 'xx') : ''\r\n\t\t\t\tif (regValue && /^[A-Za-z0-9]{4,20}$/.test(regValue)) {\r\n\t\t\t\t\tcallback()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback(new Error(this.$t('message.deskValidName')))\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst validateNumber = (rule, value, callback) => {\r\n\t\t\t\tconst EditLimitForm = this.EditLimitForm\r\n\t\t\t\tif (!/^[0-9]*[1-9][0-9]*$/.test(value)) {\r\n\t\t\t\t\tcallback(new Error(this.$t('message.integerThan0')))\r\n\t\t\t\t} else if (\r\n\t\t\t\t\trule.field === 'max' &&\r\n\t\t\t\t\tEditLimitForm.min &&\r\n\t\t\t\t\tNumber(EditLimitForm.min) > Number(value)\r\n\t\t\t\t) {\r\n\t\t\t\t\tcallback(new Error(this.$t('message.maxThanMin')))\r\n\t\t\t\t} else if (\r\n\t\t\t\t\trule.field === 'min' &&\r\n\t\t\t\t\tEditLimitForm.max &&\r\n\t\t\t\t\tNumber(EditLimitForm.max) < Number(value)\r\n\t\t\t\t) {\r\n\t\t\t\t\tcallback(new Error(this.$t('message.minThanMax')))\r\n\t\t\t\t}\r\n\t\t\t\tcallback()\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tlimitRedName: [{ required: true, validator: validName, trigger: 'blur' }],\r\n\t\t\t\tmin: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\tmessage: this.$t('message.minimumBet'),\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvalidator: validateNumber,\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\tmax: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\tmessage: this.$t('message.maximumBet'),\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvalidator: validateNumber,\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tloadData() {\r\n\t\t\tthis.$api\r\n\t\t\t\t.listPermissionItem()\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tthis.list = this.filterRes(_.data)\r\n\t\t\t\t\t\tconsole.log(this.list)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.list = []\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch((_) => {\r\n\t\t\t\t\tthis.list = []\r\n\t\t\t\t})\r\n\t\t},\r\n\t\thandleCheckAllChange(val, row) {\r\n\t\t\tif (row.check5 && row.check4 && row.check1) {\r\n\t\t\t\trow.isIndeterminate = false\r\n\t\t\t\trow.checkAll = false\r\n\t\t\t\trow.check5 = false\r\n\t\t\t\trow.check4 = false\r\n\t\t\t\trow.check1 = false\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\trow.checkAll = true\r\n\t\t\trow.check5 = true\r\n\t\t\trow.check4 = true\r\n\t\t\trow.check1 = true\r\n\t\t\trow.isIndeterminate = false\r\n\t\t},\r\n\t\tcheck(val, row) {\r\n\t\t\tif (row.check5 && row.check4 && row.check1) {\r\n\t\t\t\trow.isIndeterminate = false\r\n\t\t\t\trow.checkAll = true\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (!row.check5 && !row.check4 && !row.check1) {\r\n\t\t\t\trow.isIndeterminate = false\r\n\t\t\t\trow.checkAll = false\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\trow.isIndeterminate = true\r\n\t\t},\r\n\t\tconfirm() {\r\n\t\t\tthis.pushChildren(this.list)\r\n\t\t\tconst loading = this.$loading({\r\n\t\t\t\tlock: true,\r\n\t\t\t\ttext: 'Loading',\r\n\t\t\t\tspinner: 'el-icon-loading',\r\n\t\t\t\tbackground: 'rgba(0, 0, 0, 0.7)'\r\n\t\t\t})\r\n\t\t\tthis.$api\r\n\t\t\t\t.initPermission({ list: this.query })\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\t\tmessage: this.$t('notice.notice_39'),\r\n\t\t\t\t\t\t\ttype: 'success'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tloading.close()\r\n\t\t\t\t})\r\n\t\t\t\t.catch((_) => {\r\n\t\t\t\t\tloading.close()\r\n\t\t\t\t})\r\n\t\t\tthis.query = []\r\n\t\t},\r\n\t\tpushChildren(child) {\r\n\t\t\tchild.forEach((item) => {\r\n\t\t\t\tif (item.checkAll) {\r\n\t\t\t\t\tthis.query.push({\r\n\t\t\t\t\t\tpermissionId: item.id,\r\n\t\t\t\t\t\tsystemType: 0\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (item.check5) {\r\n\t\t\t\t\t\tthis.query.push({\r\n\t\t\t\t\t\t\tpermissionId: item.id,\r\n\t\t\t\t\t\t\tsystemType: 5\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (item.check4) {\r\n\t\t\t\t\t\tthis.query.push({\r\n\t\t\t\t\t\t\tpermissionId: item.id,\r\n\t\t\t\t\t\t\tsystemType: 4\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (item.check1) {\r\n\t\t\t\t\t\tthis.query.push({\r\n\t\t\t\t\t\t\tpermissionId: item.id,\r\n\t\t\t\t\t\t\tsystemType: 1\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (item.children && item.children.length > 0) {\r\n\t\t\t\t\tthis.pushChildren(item.children)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tfilterRes(data) {\r\n\t\t\tconst result = []\r\n\t\t\tif (data) {\r\n\t\t\t\tdata.forEach((element) => {\r\n\t\t\t\t\tif (element.parentId === 0) {\r\n\t\t\t\t\t\tresult.push({\r\n\t\t\t\t\t\t\t...element,\r\n\t\t\t\t\t\t\tcheck1: false,\r\n\t\t\t\t\t\t\tcheck4: false,\r\n\t\t\t\t\t\t\tcheck5: false,\r\n\t\t\t\t\t\t\tcheckAll: false,\r\n\t\t\t\t\t\t\tisIndeterminate: false,\r\n\t\t\t\t\t\t\tchildren: []\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// 必须先插入父节点，再循环子节点\r\n\t\t\t\tdata.forEach((element) => {\r\n\t\t\t\t\tif (element.parentId !== 0) {\r\n\t\t\t\t\t\tconst findIndex = result.findIndex((e) => e.id === element.parentId)\r\n\t\t\t\t\t\tif (findIndex >= 0) {\r\n\t\t\t\t\t\t\tresult[findIndex].children.push({\r\n\t\t\t\t\t\t\t\t...element,\r\n\t\t\t\t\t\t\t\tcheck1: false,\r\n\t\t\t\t\t\t\t\tcheck4: false,\r\n\t\t\t\t\t\t\t\tcheck5: false,\r\n\t\t\t\t\t\t\t\tcheckAll: false,\r\n\t\t\t\t\t\t\t\tisIndeterminate: false\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tif (result.length > 0) {\r\n\t\t\t\tresult.forEach((r) => {\r\n\t\t\t\t\tif (r.children.length > 0) {\r\n\t\t\t\t\t\tthis.patchChildren(r.children, data)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\treturn result\r\n\t\t},\r\n\t\tpatchChildren(child, data) {\r\n\t\t\tchild.forEach((item) => {\r\n\t\t\t\titem.children = data.filter((d) => d.parentId === item.id)\r\n\t\t\t})\r\n\t\t},\r\n\t\tchangeLimitStatus(val) {\r\n\t\t\tthis.limitStatus = val\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\thandleCurrentChange(val) {\r\n\t\t\tconsole.log(this.$t('merchant.merchant_27', [val]))\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\thandleReset() {\r\n\t\t\tthis.form = {\r\n\t\t\t\tid: '',\r\n\t\t\t\ttime: ''\r\n\t\t\t}\r\n\t\t},\r\n\t\thandleNewLimit() {\r\n\t\t\tthis.editFlag = 0\r\n\t\t\tthis.EditLimitForm = {}\r\n\t\t\tthis.limitDialogVisible = true\r\n\t\t},\r\n\t\thandleDetail(item) {\r\n\t\t\tthis.limitPlanShow = true\r\n\t\t\tthis.limitPlanData = { ...item, type: this.limitStatus }\r\n\t\t},\r\n\t\teditRow(index, row, flag) {\r\n\t\t\tthis.limitDialogVisible = true\r\n\t\t\tthis.editFlag = flag\r\n\t\t\tthis.EditLimitForm = row\r\n\t\t},\r\n\t\tstopRow(index, row) {\r\n\t\t\tconst status = row.status ? 0 : 1\r\n\t\t\tthis.$api\r\n\t\t\t\t.merchantLimitRedModifyStatus({\r\n\t\t\t\t\t...row,\r\n\t\t\t\t\tstatus\r\n\t\t\t\t})\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\tmessage: this.$t('merchant.merchant_28')\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tthis.loadData()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t},\r\n\t\tcancelLimitDialog() {\r\n\t\t\tthis.limitDialogVisible = false\r\n\t\t\tthis.$refs.form.resetFields()\r\n\t\t},\r\n\t\tcommitLimitDialog() {\r\n\t\t\tconst form = this.EditLimitForm\r\n\t\t\tthis.$refs.form.validate((valid) => {\r\n\t\t\t\tif (valid) {\r\n\t\t\t\t\tif (this.editFlag) {\r\n\t\t\t\t\t\t// 修改\r\n\t\t\t\t\t\tthis.$api.merchantLimitRedEdit(form).then((_) => {\r\n\t\t\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\t\t\tthis.limitDialogVisible = false\r\n\t\t\t\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\t\t\tmessage: this.$t('merchant.merchant_28')\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$api.merchantLimitRedAdd(form).then((_) => {\r\n\t\t\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\t\t\tthis.limitDialogVisible = false\r\n\t\t\t\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\t\t\tmessage: this.$t('merchant.merchant_29')\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tgetNameByTran(row) {\r\n\t\t\treturn i18nRoute(row.permissionName)\r\n\t\t}\r\n\t}\r\n}\r\n",null]}