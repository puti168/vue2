{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\members\\report\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\members\\report\\index.vue","mtime":1617695097418},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { mapGetters } from 'vuex'\r\nimport list from '@/mixins/list'\r\nimport { colorNum } from '@/utils'\r\nimport dayjs from 'dayjs'\r\nimport { routerNames } from '@/utils/consts'\r\nimport SelectAgentTree from '@/components/SelectAgentTree'\r\n\r\nexport default {\r\n\tname: routerNames.membersreport,\r\n\tcomponents: { SelectAgentTree },\r\n\tmixins: [list],\r\n\tdata() {\r\n\t\tconst end = dayjs()\r\n\t\t\t.subtract(1, 'd')\r\n\t\t\t.endOf('day')\r\n\t\t\t.valueOf()\r\n\t\tconst start = dayjs()\r\n\t\t\t.startOf('day')\r\n\t\t\t.subtract(1, 'd')\r\n\t\t\t.valueOf()\r\n\t\treturn {\r\n\t\t\thadSearch: false,\r\n\t\t\tloading: false,\r\n\t\t\tcanDownload: true,\r\n\t\t\tcanNoticeTotal: true,\r\n\t\t\tcanNoticeTime: true,\r\n\t\t\tamountData: {},\r\n\t\t\tform: {\r\n\t\t\t\ttime: [start, end],\r\n\t\t\t\tplayerLoginName: '',\r\n\t\t\t\tminBetAmount: undefined,\r\n\t\t\t\tmaxBetAmount: undefined,\r\n\t\t\t\tminPayoutAmount: undefined,\r\n\t\t\t\tmaxPayoutAmount: undefined,\r\n\t\t\t\tminValidBetAmount: undefined,\r\n\t\t\t\tmaxValidBetAmount: undefined,\r\n\t\t\t\tminNetAmount: undefined,\r\n\t\t\t\tmaxNetAmount: undefined,\r\n\t\t\t\tminBetCount: undefined,\r\n\t\t\t\tmaxBetCount: undefined,\r\n\t\t\t\torderProp: 'betAmount',\r\n\t\t\t\torder: 'descending'\r\n\t\t\t},\r\n\t\t\tdefaultSort: { prop: 'betAmount', order: 'descending' },\r\n\t\t\tsummary: {}\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['name', 'userInfo'])\r\n\t},\r\n\tmethods: {\r\n\t\tloadData() {\r\n\t\t\tthis.loading = true\r\n\r\n\t\t\tconst end = dayjs()\r\n\t\t\t\t.subtract(1, 'd')\r\n\t\t\t\t.endOf('day')\r\n\t\t\t\t.valueOf()\r\n\t\t\tconst start = dayjs()\r\n\t\t\t\t.startOf('day')\r\n\t\t\t\t.subtract(1, 'd')\r\n\t\t\t\t.valueOf()\r\n\r\n\t\t\tconst initData = {\r\n\t\t\t\tpageIndex: this.pageIndex,\r\n\t\t\t\tpageSize: this.pageSize,\r\n\t\t\t\tstartReportTime: start,\r\n\t\t\t\tendReportTime: end,\r\n\t\t\t\torderProp: this.form.orderProp,\r\n\t\t\t\torder: this.form.order\r\n\t\t\t}\r\n\t\t\tconst requestData = this.hadSearch\r\n\t\t\t\t? {\r\n\t\t\t\t\t\tsearchAgentId: this.form.agentId,\r\n\t\t\t\t\t\tplayerLoginName: this.form.playerLoginName,\r\n\t\t\t\t\t\tstartReportTime: this.form.time ? this.form.time[0] : '',\r\n\t\t\t\t\t\tendReportTime: this.form.time ? this.form.time[1] : '',\r\n\t\t\t\t\t\tminBetAmount: this.form.minBetAmount,\r\n\t\t\t\t\t\tmaxBetAmount: this.form.maxBetAmount,\r\n\t\t\t\t\t\tminPayoutAmount: this.form.minPayoutAmount,\r\n\t\t\t\t\t\tmaxPayoutAmount: this.form.maxPayoutAmount,\r\n\t\t\t\t\t\tminValidBetAmount: this.form.minValidBetAmount,\r\n\t\t\t\t\t\tmaxValidBetAmount: this.form.maxValidBetAmount,\r\n\t\t\t\t\t\tminNetAmount: this.form.minNetAmount,\r\n\t\t\t\t\t\tmaxNetAmount: this.form.maxNetAmount,\r\n\t\t\t\t\t\tminBetCount: this.form.minBetCount,\r\n\t\t\t\t\t\tmaxBetCount: this.form.maxBetCount\r\n\t\t\t\t  }\r\n\t\t\t\t: {}\r\n\t\t\tconst form = {\r\n\t\t\t\t...initData,\r\n\t\t\t\t...requestData\r\n\t\t\t}\r\n\t\t\tthis.$api\r\n\t\t\t\t.memberPlayerReport(form)\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tconst data = _.data\r\n\t\t\t\t\t\tthis.list = data.record || []\r\n\t\t\t\t\t\tthis.total = data.totalRecord\r\n\t\t\t\t\t\tthis.summary = data.summary\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t})\r\n\t\t},\r\n\t\tgetSummaries(param) {\r\n\t\t\tconst { columns, data } = param\r\n\t\t\tconst sums = []\r\n\t\t\tcolumns.forEach((column, index) => {\r\n\t\t\t\tif (index === 0) {\r\n\t\t\t\t\tsums[index] = this.$t('members_report_index_723')\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tif (index === 1) {\r\n\t\t\t\t\tsums[index] = this.$t('new_15') + this.summary['totalBetPlayer']\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tconst values = data.map((item) => Number(item[column.property]))\r\n\t\t\t\tif (\r\n\t\t\t\t\t!values.every((value) => isNaN(value)) &&\r\n\t\t\t\t\t(column.property === 'betCount' ||\r\n\t\t\t\t\t\tcolumn.property === 'betAmount' ||\r\n\t\t\t\t\t\tcolumn.property === 'netAmount' ||\r\n\t\t\t\t\t\tcolumn.property === 'cumulativePayout' ||\r\n\t\t\t\t\t\tcolumn.property === 'payoutAmount' ||\r\n\t\t\t\t\t\tcolumn.property === 'activityAmount' ||\r\n\t\t\t\t\t\tcolumn.property === 'gainAmount' ||\r\n\t\t\t\t\t\tcolumn.property === 'validBetAmount')\r\n\t\t\t\t) {\r\n\t\t\t\t\tsums[index] = this.summary[column.property]\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn sums\r\n\t\t},\r\n\r\n\t\tcolorNum(val) {\r\n\t\t\treturn colorNum(val)\r\n\t\t},\r\n\t\thandleCurrentChange(val) {\r\n\t\t\tif (this.loading) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\thandleReset() {\r\n\t\t\tconst end = dayjs()\r\n\t\t\t\t.subtract(1, 'd')\r\n\t\t\t\t.endOf('day')\r\n\t\t\t\t.valueOf()\r\n\t\t\tconst start = dayjs()\r\n\t\t\t\t.startOf('day')\r\n\t\t\t\t.subtract(1, 'd')\r\n\t\t\t\t.valueOf()\r\n\t\t\tthis.form = {\r\n\t\t\t\ttime: [start, end],\r\n\t\t\t\tplayerLoginName: '',\r\n\t\t\t\tminBetAmount: undefined,\r\n\t\t\t\tmaxBetAmount: undefined,\r\n\t\t\t\tminPayoutAmount: undefined,\r\n\t\t\t\tmaxPayoutAmount: undefined,\r\n\t\t\t\tminValidBetAmount: undefined,\r\n\t\t\t\tmaxValidBetAmount: undefined,\r\n\t\t\t\tminNetAmount: undefined,\r\n\t\t\t\tmaxNetAmount: undefined,\r\n\t\t\t\tminBetCount: undefined,\r\n\t\t\t\tmaxBetCount: undefined,\r\n\t\t\t\torderProp: 'betAmount',\r\n\t\t\t\torder: 'descending'\r\n\t\t\t}\r\n\t\t\tthis.hadSearch = false\r\n\t\t\tthis.initList()\r\n\t\t},\r\n\t\thandleSearch() {\r\n\t\t\tthis.hadSearch = true\r\n\t\t\tthis.pageIndex = 1\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\texportCsv() {\r\n\t\t\tif (Number(this.total) > 20000) {\r\n\t\t\t\tif (this.canNoticeTotal) {\r\n\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\tmessage: this.$t('new_2'),\r\n\t\t\t\t\t\ttype: 'error'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.canNoticeTotal = false\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.canNoticeTotal = true\r\n\t\t\t\t\t}, 3000)\r\n\t\t\t\t}\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (!this.canDownload) {\r\n\t\t\t\tif (this.canNoticeTime) {\r\n\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\tmessage: this.$t('new_1'),\r\n\t\t\t\t\t\ttype: 'error'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.canNoticeTime = false\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.canNoticeTime = true\r\n\t\t\t\t\t}, 3000)\r\n\t\t\t\t}\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tthis.canDownload = false\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.canDownload = true\r\n\t\t\t}, 60000)\r\n\t\t\tconst params = {\r\n\t\t\t\tsearchAgentId: this.form.agentId,\r\n\t\t\t\tplayerLoginName: this.form.playerLoginName,\r\n\t\t\t\tminBetAmount: this.form.minBetAmount,\r\n\t\t\t\tmaxBetAmount: this.form.maxBetAmount,\r\n\t\t\t\tminPayoutAmount: this.form.minPayoutAmount,\r\n\t\t\t\tmaxPayoutAmount: this.form.maxPayoutAmount,\r\n\t\t\t\tminValidBetAmount: this.form.minValidBetAmount,\r\n\t\t\t\tmaxValidBetAmount: this.form.maxValidBetAmount,\r\n\t\t\t\tminNetAmount: this.form.minNetAmount,\r\n\t\t\t\tmaxNetAmount: this.form.maxNetAmount,\r\n\t\t\t\tminBetCount: this.form.minBetCount,\r\n\t\t\t\tmaxBetCount: this.form.maxBetCount,\r\n\t\t\t\tstartReportTime: this.form.time ? this.form.time[0] : '',\r\n\t\t\t\tendReportTime: this.form.time ? this.form.time[1] : '',\r\n\t\t\t\torderProp: this.form.orderProp,\r\n\t\t\t\torder: this.form.order\r\n\t\t\t}\r\n\t\t\tconst startday = dayjs(params.startReportTime).get('date')\r\n\t\t\tconst startmonth = dayjs(params.startReportTime).get('month') + 1\r\n\t\t\tconst endmonth = dayjs(params.endReportTime).get('month') + 1\r\n\t\t\tconst endday = dayjs(params.endReportTime).get('date')\r\n\t\t\tconst title =\r\n\t\t\t\tthis.$t('route.membersreport') +\r\n\t\t\t\t'(' +\r\n\t\t\t\tstartmonth +\r\n\t\t\t\tthis.$t('merchant_dailyrateaccount_index_802') +\r\n\t\t\t\tstartday +\r\n\t\t\t\tthis.$t('merchant_dailyrateaccount_index_803') +\r\n\t\t\t\t'-' +\r\n\t\t\t\tendmonth +\r\n\t\t\t\tthis.$t('merchant_dailyrateaccount_index_802') +\r\n\t\t\t\tendday +\r\n\t\t\t\tthis.$t('merchant_dailyrateaccount_index_803') +\r\n\t\t\t\t')'\r\n\t\t\tlocalStorage.setItem('title', title)\r\n\t\t\tthis.$api\r\n\t\t\t\t.reportExport(params)\r\n\t\t\t\t.then((res) => {})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t})\r\n\t\t},\r\n\t\tsortChange(val) {\r\n\t\t\tconst { prop, order } = val\r\n\t\t\tif (this.loading) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (order === null) {\r\n\t\t\t\tthis.form.orderProp === 'descending'\r\n\t\t\t\t\t? (val.order = 'descending')\r\n\t\t\t\t\t: (val.order = 'ascending')\r\n\t\t\t\tval.column.order = val.order\r\n\t\t\t\tthis.form.orderProp = prop\r\n\t\t\t\tthis.form.order = val.order\r\n\t\t\t\tthis.loadData()\r\n\t\t\t\treturn val\r\n\t\t\t}\r\n\t\t\tthis.form.orderProp = prop\r\n\t\t\tthis.form.order = order\r\n\t\t\tthis.defaultSort = { prop, order: order || 'descending' }\r\n\t\t\tthis.loadData()\r\n\t\t\treturn val\r\n\t\t},\r\n\t\tshowDailyDetail(row) {\r\n\t\t\tconst returnQuery = {\r\n\t\t\t\tpageIndex: this.pageIndex,\r\n\t\t\t\tpageSize: this.pageSize,\r\n\t\t\t\ttime: [this.form.time[0], this.form.time[1]],\r\n\t\t\t\tsearchAgentId: this.form.agentId,\r\n\t\t\t\tplayerLoginName: this.form.playerLoginNameNoMask,\r\n\t\t\t\torderProp: this.form.orderProp,\r\n\t\t\t\torder: this.form.order\r\n\t\t\t}\r\n\t\t\tthis.$store.dispatch('tagsView/delView', {\r\n\t\t\t\tname: routerNames.reportDaily\r\n\t\t\t})\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tconst targetUrl = '/members/reportDaily'\r\n\t\t\t\tthis.$router.push(`${targetUrl}`)\r\n\t\t\t\tlocalStorage.setItem('returnQuery', JSON.stringify(returnQuery))\r\n\t\t\t\tlocalStorage.setItem('agentId', row.agentId)\r\n\t\t\t\tlocalStorage.setItem('playerLoginName', row.playerLoginNameNoMask)\r\n\t\t\t\tlocalStorage.setItem('time', JSON.stringify(this.form.time))\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n",null]}