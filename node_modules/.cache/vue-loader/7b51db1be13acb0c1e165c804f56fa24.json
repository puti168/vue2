{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\subAccount\\components\\RoleDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\subAccount\\components\\RoleDetail.vue","mtime":1615171048109},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { mapGetters } from 'vuex'\r\nimport { generateTitle } from '@/utils/i18n'\r\nimport { message } from '@/utils/message'\r\n\r\nexport default {\r\n\tname: 'Editrole',\r\n\tprops: {\r\n\t\ttype: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 0\r\n\t\t},\r\n\t\tassignedPermissions: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\tdetailPermissions: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: function () {\r\n\t\t\t\treturn {}\r\n\t\t\t}\r\n\t\t},\r\n\t\troledata: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: function () {\r\n\t\t\t\treturn {}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\ttransferKey: 0,\r\n\t\t\tcheckedKeys: [],\r\n\t\t\tps: [],\r\n\t\t\tform: {\r\n\t\t\t\troleName: '',\r\n\t\t\t\tremark: ''\r\n\t\t\t},\r\n\t\t\tdirection: 'ttb',\r\n\t\t\tmemoryRemark: '', // 用于判断是否做修改,\r\n\t\t\tmemoryIds: []\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['userInfo']),\r\n\t\tdefaultProps() {\r\n\t\t\treturn {\r\n\t\t\t\tlabel: (data) => {\r\n\t\t\t\t\treturn generateTitle(data.permissionName)\r\n\t\t\t\t},\r\n\t\t\t\tchildren: 'children'\r\n\t\t\t}\r\n\t\t},\r\n\t\trules() {\r\n\t\t\tconst validRoleName = (rule, value, callback) => {\r\n\t\t\t\tif (!value) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_rolemanage_components_roledetail_4')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else if (value && value.length > 20) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_rolemanage_components_roledetail_5')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else if (!/^[\\u4e00-\\u9fa5]{1,20}$/.test(value)) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_rolemanage_components_roledetail_6')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\troleName: [{ required: true, validator: validRoleName, trigger: 'blur' }]\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\troledata: {\r\n\t\t\thandler(newVal, old) {\r\n\t\t\t\tif (newVal.id) {\r\n\t\t\t\t\tthis.form.roleName = newVal.roleName\r\n\t\t\t\t\tthis.form.remark = newVal.remark\r\n\t\t\t\t\tthis.memoryRemark = newVal.remark\r\n\t\t\t\t\tthis.form.id = newVal.id\r\n\t\t\t\t\tthis.form.systemType = newVal.systemType\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.resetForm()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\timmediate: true,\r\n\t\t\tdeep: true\r\n\t\t},\r\n\t\tdetailPermissions: {\r\n\t\t\thandler(newVal, oldVal) {\r\n\t\t\t\tif (newVal) {\r\n\t\t\t\t\tthis.ps = newVal\r\n\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t// 叶子节点平铺\r\n\t\t\t\t\t\tconst doms =\r\n\t\t\t\t\t\t\tdocument.querySelectorAll('.el-tree-node__content > .is-leaf') || []\r\n\t\t\t\t\t\tdoms.length !== 0 &&\r\n\t\t\t\t\t\t\tdoms.forEach((node) => {\r\n\t\t\t\t\t\t\t\tnode.parentNode.classList.add('tile')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdeep: true\r\n\t\t},\r\n\t\tassignedPermissions: {\r\n\t\t\thandler(newVal, oldVal) {\r\n\t\t\t\tif (newVal.length && newVal.length > 0) {\r\n\t\t\t\t\tnewVal.forEach((element) => {\r\n\t\t\t\t\t\tif (element.includes('list')) {\r\n\t\t\t\t\t\t\tthis.memoryIds.push(element.replace('list', ''))\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.memoryIds.push(element)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.$refs.tree.setCheckedKeys([])\r\n\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\tthis.checkIfAllChecked()\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdeep: true\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tcheckIfAllChecked() {\r\n\t\t\tlet arr = this.filterPS(this.ps)\r\n\t\t\tarr = arr.filter((val) => !val.id.includes('list'))\r\n\t\t\tif (arr.length <= this.assignedPermissions.length) {\r\n\t\t\t\tthis.checkedAll = true\r\n\t\t\t} else {\r\n\t\t\t\tthis.checkedAll = false\r\n\t\t\t}\r\n\t\t},\r\n\t\tfilterPS(ps) {\r\n\t\t\tconst list = []\r\n\t\t\tconst getList = function (ps) {\r\n\t\t\t\tps.forEach((item) => {\r\n\t\t\t\t\t// item.disabled = true\r\n\t\t\t\t\tif (item.children) {\r\n\t\t\t\t\t\tlist.push(item)\r\n\t\t\t\t\t\tgetList(item.children)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlist.push(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tgetList(ps)\r\n\t\t\treturn list\r\n\t\t},\r\n\t\tresetForm() {\r\n\t\t\tthis.form = {}\r\n\t\t\tthis.checkedAll = false\r\n\t\t},\r\n\t\thandleSure() {\r\n\t\t\tlet permissionKeys = []\r\n\t\t\tconst keys = this.$refs.tree.getCheckedKeys() || []\r\n\t\t\tconst halfKeys = this.$refs.tree.getHalfCheckedKeys() || []\r\n\t\t\tpermissionKeys = keys.concat(halfKeys)\r\n\r\n\t\t\t// 过滤掉id为'list'的值\r\n\t\t\tpermissionKeys = permissionKeys.filter(\r\n\t\t\t\t(element) => !element.includes('list')\r\n\t\t\t)\r\n\t\t\tthis.$refs.form.validate((valid) => {\r\n\t\t\t\tif (valid) {\r\n\t\t\t\t\tif (keys.length === 0) {\r\n\t\t\t\t\t\treturn message({\r\n\t\t\t\t\t\t\ttype: 'error',\r\n\t\t\t\t\t\t\tmessage: this.$t(\r\n\t\t\t\t\t\t\t\t'authoritymanagement_rolemanage_components_roledetail_7'\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 获取参数\r\n\t\t\t\t\tconst form = { permissionIds: permissionKeys, ...this.form }\r\n\t\t\t\t\tconsole.log('form :', form)\r\n\t\t\t\t\tif (this.type === 0) {\r\n\t\t\t\t\t\tthis.$api.merchantAddRole(form).then((_) => {\r\n\t\t\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\t\t\tmessage({\r\n\t\t\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\t\t\tmessage: this.$t(\r\n\t\t\t\t\t\t\t\t\t\t'authoritymanagement_rolemanage_components_roledetail_8',\r\n\t\t\t\t\t\t\t\t\t\t[form.roleName]\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t\tthis.$emit('handleCallBack')\r\n\t\t\t\t\t\t\t\tthis.$emit('closeDetail')\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst beforeData = {\r\n\t\t\t\t\t\t\tremark: this.memoryRemark,\r\n\t\t\t\t\t\t\tids: this.memoryIds.sort()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst nowData = {\r\n\t\t\t\t\t\t\tremark: this.form.remark,\r\n\t\t\t\t\t\t\tids: form.permissionIds.sort()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (JSON.stringify(beforeData) === JSON.stringify(nowData)) {\r\n\t\t\t\t\t\t\treturn message({\r\n\t\t\t\t\t\t\t\tmessage: this.$t(\r\n\t\t\t\t\t\t\t\t\t'authoritymanagement_rolemanage_components_roledetail_9'\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\ttype: 'warning'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.$api.merchantEditRole(form).then((_) => {\r\n\t\t\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\t\t\tthis.resetDialog()\r\n\t\t\t\t\t\t\t\tmessage({\r\n\t\t\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\t\t\tmessage: this.$t(\r\n\t\t\t\t\t\t\t\t\t\t'authoritymanagement_rolemanage_components_roledetail_10',\r\n\t\t\t\t\t\t\t\t\t\t[form.roleName]\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tthis.$emit('handleCallBack')\r\n\t\t\t\t\t\t\t\tthis.$emit('closeDetail')\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst isError = document.getElementsByClassName('is-error')\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tisError[0].querySelector('input').focus()\r\n\t\t\t\t\t}, 500)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\thandleClose() {\r\n\t\t\tthis.$emit('closeDetail')\r\n\t\t},\r\n\t\thandleClosed() {\r\n\t\t\tthis.resetDialog()\r\n\t\t},\r\n\t\tresetDialog() {\r\n\t\t\tthis.$refs.form.resetFields()\r\n\t\t\tthis.transferKey = +new Date()\r\n\t\t\tthis.memoryRemark = ''\r\n\t\t\tthis.memoryIds = []\r\n\t\t}\r\n\t}\r\n}\r\n",null]}