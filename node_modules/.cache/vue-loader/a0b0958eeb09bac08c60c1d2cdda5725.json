{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\usermanage\\components\\EditUser.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\usermanage\\components\\EditUser.vue","mtime":1617695097409},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { validPassword } from '@/utils/validate'\r\nimport { message } from '@/utils/message'\r\nimport { mapGetters } from 'vuex'\r\nimport store from '@/store'\r\nimport router from '@/router'\r\n// import md5 from 'js-md5'\r\nexport default {\r\n\tname: 'Edituser',\r\n\tprops: {\r\n\t\ttype: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 1 // 新建为1 ,用户授权为2, 3为修改密码\r\n\t\t},\r\n\t\tdrawer: Boolean,\r\n\t\troleList: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\tuserRole: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\tuserdata: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: function() {\r\n\t\t\t\treturn {}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tdialogKey: 0,\r\n\t\t\ttransferKey: 0,\r\n\t\t\ttranferVal: [],\r\n\t\t\telDrawer: false,\r\n\t\t\tshowGoogleCode: true,\r\n\t\t\tform: {\r\n\t\t\t\tnickName: '',\r\n\t\t\t\tuserName: '',\r\n\t\t\t\tpwd: '',\r\n\t\t\t\trePwd: '',\r\n\t\t\t\tgoogleAuthCode: '',\r\n\t\t\t\tverifyCodeType: 1\r\n\t\t\t},\r\n\t\t\tmemoryData: [] // 用于判断是否做修改\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['userInfo']),\r\n\t\trules() {\r\n\t\t\tconst validNumberUserName = (rule, value, callback) => {\r\n\t\t\t\tif (!/^[a-zA-Z]([0-9]|[a-zA-Z])*$/g.test(value)) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_usermanage_components_edituser_306')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else if (value.length < 5) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_usermanage_components_edituser_307')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else if (value.length > 12) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_usermanage_components_edituser_308')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst validNumberEnCn = (rule, value, callback) => {\r\n\t\t\t\tif (value && /^[\\u4e00-\\u9fa5a-zA-Z0-9_]{0,30}$/.test(value)) {\r\n\t\t\t\t\tcallback()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback(new Error(this.$t('merchant.merchant_143')))\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst validatePwd = (rule, value, callback) => {\r\n\t\t\t\tif (value && value.length < 6) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_usermanage_components_edituser_309')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else if (value && value.length > 12) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_usermanage_components_edituser_310')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else if (value === '' || !validPassword(value)) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_usermanage_components_edituser_311')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst validateRepwd = (rule, value, callback) => {\r\n\t\t\t\tif (value !== this.form.pwd) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_usermanage_components_edituser_312')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tuserName: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\tmessage: this.$t('systemmanagement.systemmanagement_130'),\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvalidator: validNumberUserName,\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\tnickName: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\tmessage: this.$t('systemmanagement.systemmanagement_119'),\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{ validator: validNumberEnCn, trigger: 'blur' }\r\n\t\t\t\t],\r\n\t\t\t\tpwd: [{ required: true, validator: validatePwd, trigger: 'blur' }],\r\n\t\t\t\trePwd: [{ required: true, validator: validateRepwd, trigger: 'blur' }],\r\n\t\t\t\tgoogleAuthCode: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\tmessage: this.$t(\r\n\t\t\t\t\t\t\t'authoritymanagement_usermanage_components_edituser_313'\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\tdrawer(val) {\r\n\t\t\tthis.elDrawer = val\r\n\t\t\tif (val) {\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tthis.$refs.form.clearValidate()\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserdata: {\r\n\t\t\thandler(newVal) {\r\n\t\t\t\tif (this.type === 1) {\r\n\t\t\t\t\tthis.getGoogleAuth()\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(newVal)\r\n\t\t\t\tif (newVal) {\r\n\t\t\t\t\tif (newVal.verifyCodeType) {\r\n\t\t\t\t\t\tthis.form = { ...newVal }\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.form = { ...newVal, verifyCodeType: 1 }\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnewVal.userRole &&\r\n\t\t\t\t\t\tnewVal.userRole.forEach((val) => {\r\n\t\t\t\t\t\t\tif (val.isExist === '1') {\r\n\t\t\t\t\t\t\t\tthis.memoryData.push(val.id)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdeep: true\r\n\t\t},\r\n\t\tuserRole: {\r\n\t\t\thandler(newVal, oldVal) {\r\n\t\t\t\tthis.tranferVal = this.filterAssignedKeys(newVal)\r\n\t\t\t},\r\n\t\t\tdeep: true\r\n\t\t},\r\n\t\t'form.verifyCodeType'(val) {\r\n\t\t\tif (val === 2) {\r\n\t\t\t\tthis.showGoogleCode = false\r\n\t\t\t} else {\r\n\t\t\t\tthis.showGoogleCode = true\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tgetGoogleAuth() {\r\n\t\t\tthis.$api.getGoogleAuth().then((res) => {\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tthis.form.googleAuthCode = res.data\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\trenderTitle() {\r\n\t\t\tconst type = this.type\r\n\t\t\tif (type === 1) {\r\n\t\t\t\treturn this.$t('authoritymanagement_usermanage_components_edituser_314')\r\n\t\t\t} else if (type === 2) {\r\n\t\t\t\treturn this.$t('authoritymanagement_usermanage_components_edituser_315')\r\n\t\t\t}\r\n\t\t\treturn this.$t('authoritymanagement_usermanage_components_edituser_316')\r\n\t\t},\r\n\t\tfilterAssignedKeys(arr) {\r\n\t\t\tconst list = []\r\n\t\t\tarr.forEach((item) => {\r\n\t\t\t\tif (item.isExist === '1') {\r\n\t\t\t\t\tlist.push(item.id)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn list\r\n\t\t},\r\n\t\thandleRequest(params) {\r\n\t\t\tconst api =\r\n\t\t\t\tthis.type === 1\r\n\t\t\t\t\t? 'merchantAddUser'\r\n\t\t\t\t\t: this.type === 2\r\n\t\t\t\t\t? 'merchantEditUser'\r\n\t\t\t\t\t: 'merchantModifyUserPass'\r\n\t\t\tthis.$api[api](params).then((res) => {\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tthis.$emit('update:drawer', false)\r\n\t\t\t\t\tif (this.type === 3) {\r\n\t\t\t\t\t\tif (this.userdata.userName === this.userInfo.username) {\r\n\t\t\t\t\t\t\tsetTimeout(async () => {\r\n\t\t\t\t\t\t\t\tconst fullPath = router.history.current.fullPath\r\n\t\t\t\t\t\t\t\tawait store.dispatch('user/logout')\r\n\t\t\t\t\t\t\t\tawait store.dispatch('permission/clearRoutes')\r\n\t\t\t\t\t\t\t\trouter.push(`/login?redirect=${fullPath}`)\r\n\t\t\t\t\t\t\t}, 1000)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.$emit('handleCallBack')\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$emit('handleCallBack')\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn message({\r\n\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\tmessage: this.$t('authoritymanagement_usermanage_components_edituser_317')\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\thandleSure() {\r\n\t\t\tthis.$refs.form.validate((valid) => {\r\n\t\t\t\tif (valid) {\r\n\t\t\t\t\t// 获取参数\r\n\t\t\t\t\tconst form = {\r\n\t\t\t\t\t\t// pwd: this.type !== 2 ? md5(this.form.pwd + this.form.userName.toLocaleLowerCase().trim()) : undefined,\r\n\t\t\t\t\t\t// rePwd: this.type !== 2 ? md5(this.form.rePwd + this.form.userName.toLocaleLowerCase().trim()) : undefined,\r\n\t\t\t\t\t\tpwd: this.type !== 2 ? this.form.pwd : undefined,\r\n\t\t\t\t\t\trePwd: this.type !== 2 ? this.form.rePwd : undefined,\r\n\t\t\t\t\t\troleIds: this.type !== 3 ? this.tranferVal : undefined,\r\n\t\t\t\t\t\tgoogleAuthCode: this.form.googleAuthCode,\r\n\t\t\t\t\t\tuserName: this.form.userName.toLocaleLowerCase(),\r\n\t\t\t\t\t\tuserId: this.form.id,\r\n\t\t\t\t\t\tverifyCodeType: this.form.verifyCodeType\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// if (\r\n\t\t\t\t\t// \tthis.type === 2 &&\r\n\t\t\t\t\t// \tJSON.stringify(form.roleIds) === JSON.stringify(this.memoryData)\r\n\t\t\t\t\t// ) {\r\n\t\t\t\t\t// \treturn message({\r\n\t\t\t\t\t// \t\tmessage: '未作修改，不能提交',\r\n\t\t\t\t\t// \t\ttype: 'warning'\r\n\t\t\t\t\t// \t})\r\n\t\t\t\t\t// }\r\n\r\n\t\t\t\t\tif (this.type !== 3) {\r\n\t\t\t\t\t\tif (!form.roleIds || form.roleIds.length === 0) {\r\n\t\t\t\t\t\t\treturn message({\r\n\t\t\t\t\t\t\t\tmessage: this.$t(\r\n\t\t\t\t\t\t\t\t\t'authoritymanagement_usermanage_components_edituser_318'\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\ttype: 'error'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.handleRequest(form)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\thandleClose() {\r\n\t\t\tthis.$emit('update:drawer', false)\r\n\t\t\tthis.resetForm()\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.dialogKey = +new Date()\r\n\t\t\t}, 100)\r\n\t\t},\r\n\t\tresetForm() {\r\n\t\t\tthis.transferKey = +new Date()\r\n\t\t\tthis.tranferVal = []\r\n\t\t\tthis.memoryData = []\r\n\t\t}\r\n\t}\r\n}\r\n",null]}