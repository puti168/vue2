{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\listPermissionItem\\components\\AuthoritySearch.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\listPermissionItem\\components\\AuthoritySearch.vue","mtime":1616384580043},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { message } from '@/utils/message'\r\nimport { generateTitle } from '@/utils/i18n'\r\nimport list from '@/mixins/list'\r\nimport { i18nRoute } from '@/utils/i18n'\r\nimport SelectAgentTree from '@/components/SelectAgentTree'\r\nimport { mapGetters } from 'vuex'\r\n\r\nexport default {\r\n\tname: 'AuthoritySearch',\r\n\tcomponents: {\r\n\t\tSelectAgentTree\r\n\t},\r\n\tmixins: [list],\r\n\tprops: {\r\n\t\t// 0为线路商模板配置 1为普通商户模板配置 2为默认角色配置\r\n\t\ttype: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 0\r\n\t\t},\r\n\t\tdrawer: Boolean,\r\n\t\tlimitPlanData: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: function() {\r\n\t\t\t\treturn {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tpermissions: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t}\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\telDrawer: false,\r\n\t\t\tcheckedAll: false,\r\n\t\t\tcheckedKeys: [],\r\n\t\t\tps: [],\r\n\t\t\tform: {\r\n\t\t\t\troleName: '',\r\n\t\t\t\tremark: ''\r\n\t\t\t},\r\n\t\t\tdirection: 'ttb',\r\n\t\t\trestaurants: [],\r\n\t\t\tstate2: '',\r\n\t\t\tlist: [],\r\n\t\t\tpermissionId: '',\r\n\t\t\t// 全部数据\r\n\t\t\tdata: [],\r\n\t\t\t// 树数据\r\n\t\t\ttree: [],\r\n\t\t\tstoreDatas: [],\r\n\t\t\tselectKey: Date.now()\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['userInfo']),\r\n\t\tdefaultProps() {\r\n\t\t\treturn {\r\n\t\t\t\tlabel: (data) => {\r\n\t\t\t\t\treturn generateTitle(data.permissionName)\r\n\t\t\t\t},\r\n\t\t\t\tchildren: 'children'\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\t'form.agentId'(val) {\r\n\t\t\tval && this.hasPermission(15401) && this.loadData2()\r\n\t\t},\r\n\t\tdrawer(val) {\r\n\t\t\tthis.elDrawer = val\r\n\t\t\tthis.selectKey = Date.now()\r\n\t\t},\r\n\t\tlimitPlanData: {\r\n\t\t\thandler(newVal, old) {\r\n\t\t\t\tconsole.log('newVal :>> ', newVal)\r\n\t\t\t\tif (newVal.id) {\r\n\t\t\t\t\tthis.form = { ...newVal }\r\n\t\t\t\t\tthis.hasPermission(15401) && this.loadData2()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.resetForm()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdeep: true\r\n\t\t},\r\n\t\tpermissions: {\r\n\t\t\thandler(newVal, oldVal) {\r\n\t\t\t\tif (newVal) {\r\n\t\t\t\t\tconst arr = this.filterPS(newVal)\r\n\t\t\t\t\tthis.restaurants = arr.map((i) => {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalue: i18nRoute(i.permissionName),\r\n\t\t\t\t\t\t\tid: i.id\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdeep: true\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tloadData2() {\r\n\t\t\tthis.tree = []\r\n\t\t\tthis.storeDatas = []\r\n\t\t\tif (!this.form.agentId) return\r\n\t\t\tconst form = {\r\n\t\t\t\tpermissionId: this.form.id,\r\n\t\t\t\tagentId: this.form.agentId\r\n\t\t\t}\r\n\t\t\tthis.$api\r\n\t\t\t\t.searchPermissionAgent(form)\r\n\t\t\t\t.then((res) => {\r\n\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\tconst organizations = res.data || []\r\n\t\t\t\t\t\tthis.data = organizations\r\n\t\t\t\t\t\tlet index\r\n\t\t\t\t\t\tif (!this.value) {\r\n\t\t\t\t\t\t\t// 找到初始agentId\r\n\t\t\t\t\t\t\tindex = this.data.findIndex((val) => val.agentCode === this.agentCode)\r\n\t\t\t\t\t\t\tif (index > -1) {\r\n\t\t\t\t\t\t\t\tthis.agentName = this.data[index].agentName\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tindex = this.data.findIndex((v) => Number(v.id) === Number(this.value))\r\n\t\t\t\t\t\t\tif (index > -1) {\r\n\t\t\t\t\t\t\t\tthis.agentName = this.data[index].agentName\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.generateTree(this.data)\r\n\t\t\t\t\t\tthis.tree = this.storeDatas\r\n\t\t\t\t\t\tconsole.log('this.tree1  :>> ', this.tree)\r\n\t\t\t\t\t\tthis.deleteItem(this.tree)\r\n\t\t\t\t\t\tconsole.log('this.tree2  :>> ', this.tree)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.list = []\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tconsole.log('error :>> ', error)\r\n\t\t\t\t\tthis.list = []\r\n\t\t\t\t})\r\n\t\t},\r\n\t\tdeleteItem(tree) {\r\n\t\t\tfor (let i = tree.length - 1; i >= 0; i--) {\r\n\t\t\t\tif (tree[i].children.length > 0) {\r\n\t\t\t\t\tthis.deleteItem(tree[i].children)\r\n\t\t\t\t}\r\n\t\t\t\tif (tree[i].isExit === '0' && tree[i].canDelete) {\r\n\t\t\t\t\tconsole.log('333')\r\n\t\t\t\t\ttree.splice(i, 1)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// tree.forEach((item, index) => {\r\n\t\t\t// \tif (item.isExit === '0' && item.canDelete) {\r\n\t\t\t// \t\ttree.splice(index, 1)\r\n\t\t\t// \t}\r\n\t\t\t// \tif (item.children.length > 0) {\r\n\t\t\t// \t\tthis.deleteItem(item.children)\r\n\t\t\t// \t}\r\n\t\t\t// })\r\n\t\t},\r\n\t\t// 生成树形结构\r\n\t\tgenerateTree(data) {\r\n\t\t\tconst datas = [...data]\r\n\t\t\t// 先找出父节点\r\n\t\t\tdatas.forEach((element, i) => {\r\n\t\t\t\tconst index = data.findIndex((val) => val.id === element.parentId)\r\n\t\t\t\tif (index < 0) {\r\n\t\t\t\t\tthis.storeDatas.push({\r\n\t\t\t\t\t\tid: element.id,\r\n\t\t\t\t\t\tlabel: `${element.agentName} ${element.agentCode}`,\r\n\t\t\t\t\t\tchildren: [],\r\n\t\t\t\t\t\tcanDelete: true,\r\n\t\t\t\t\t\t...element\r\n\t\t\t\t\t})\r\n\t\t\t\t\tdatas.splice(i, 1)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tthis.recursionData(datas, this.storeDatas)\r\n\t\t},\r\n\t\t// 递归生成\r\n\t\trecursionData(data, tree) {\r\n\t\t\tconst datas = [...data]\r\n\t\t\tconst pickIndex = []\r\n\t\t\tconst leftDatas = []\r\n\t\t\tdatas.forEach((element) => {\r\n\t\t\t\tconst index = tree.findIndex((val) => val.id === element.parentId)\r\n\t\t\t\ttree.forEach((item) => {\r\n\t\t\t\t\tif (item.id === element.parentId && element.isExit === '1') {\r\n\t\t\t\t\t\titem.canDelete = false\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tif (index > -1) {\r\n\t\t\t\t\ttree[index].children.push({\r\n\t\t\t\t\t\tid: element.id,\r\n\t\t\t\t\t\tlabel: `${element.agentName} ${element.agentCode}`,\r\n\t\t\t\t\t\tchildren: [],\r\n\t\t\t\t\t\tcanDelete: true,\r\n\t\t\t\t\t\t...element\r\n\t\t\t\t\t})\r\n\t\t\t\t\t!pickIndex.includes(index) && pickIndex.push(index)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tleftDatas.push(element)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tif (pickIndex.length > 0) {\r\n\t\t\t\tpickIndex.forEach((element) => {\r\n\t\t\t\t\tthis.recursionData(leftDatas, tree[element].children)\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 点击复选框判断是否全选\r\n\t\tclickIfAllChecked(checkedKeys) {\r\n\t\t\tconst arr = this.filterPS(this.ps)\r\n\t\t\tif (arr.length === checkedKeys.length) {\r\n\t\t\t\tthis.checkedAll = true\r\n\t\t\t} else {\r\n\t\t\t\tthis.checkedAll = false\r\n\t\t\t}\r\n\t\t},\r\n\t\tcheck(data, obj) {\r\n\t\t\tthis.clickIfAllChecked(obj.checkedKeys)\r\n\t\t},\r\n\t\tfilterPS(ps) {\r\n\t\t\tconst list = []\r\n\t\t\tconst getList = function(ps) {\r\n\t\t\t\tps.forEach((item) => {\r\n\t\t\t\t\tif (item.children) {\r\n\t\t\t\t\t\tlist.push(item)\r\n\t\t\t\t\t\tgetList(item.children)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlist.push(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tgetList(ps)\r\n\t\t\treturn list\r\n\t\t},\r\n\t\tresetForm() {\r\n\t\t\tthis.form = {}\r\n\t\t\tthis.checkedAll = false\r\n\t\t\tthis.resetTree()\r\n\t\t},\r\n\t\thandleClose() {\r\n\t\t\tthis.state2 = ''\r\n\t\t\tthis.permissionId = ''\r\n\t\t\tthis.selectKey = Date.now()\r\n\t\t\tthis.$emit('update:drawer', false)\r\n\t\t},\r\n\t\tquerySearch(queryString, cb) {\r\n\t\t\tconst restaurants = this.restaurants\r\n\t\t\tconst results = queryString\r\n\t\t\t\t? restaurants.filter((restaurant) => {\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\trestaurant.value.toLowerCase().indexOf(queryString.toLowerCase()) === 0\r\n\t\t\t\t\t\t)\r\n\t\t\t\t  })\r\n\t\t\t\t: restaurants\r\n\t\t\t// 调用 callback 返回建议列表的数据\r\n\t\t\tcb(results)\r\n\t\t},\r\n\t\thandleSelect(item) {\r\n\t\t\tthis.pageIndex = 1\r\n\t\t\tthis.permissionId = item.id\r\n\t\t\tthis.loadData2()\r\n\t\t},\r\n\t\thandleClearable() {\r\n\t\t\tthis.permissionId = ''\r\n\t\t\tthis.loadData2()\r\n\t\t},\r\n\t\thandleCurrentChange(val) {\r\n\t\t\tthis.loadData2()\r\n\t\t},\r\n\t\tdeleteRow(index, row) {\r\n\t\t\tthis.$confirm(\r\n\t\t\t\tthis.$t('authoritymanagement_defaultrole_components_authoritysearch_1977'),\r\n\t\t\t\tthis.$t('authoritymanagement_defaultrole_components_authoritysearch_198'),\r\n\t\t\t\t{\r\n\t\t\t\t\tconfirmButtonText: this.$t(\r\n\t\t\t\t\t\t'authoritymanagement_defaultrole_components_authoritysearch_199'\r\n\t\t\t\t\t),\r\n\t\t\t\t\tcancelButtonText: this.$t(\r\n\t\t\t\t\t\t'authoritymanagement_defaultrole_components_authoritysearch_200'\r\n\t\t\t\t\t),\r\n\t\t\t\t\ttype: 'warning',\r\n\t\t\t\t\tcenter: true\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tthis.$api\r\n\t\t\t\t\t\t.deletePermissionAgent({\r\n\t\t\t\t\t\t\tpermissionId: this.form.id,\r\n\t\t\t\t\t\t\tagentCode: row.agentCode\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.then((res) => {\r\n\t\t\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\t\t\tthis.loadData2()\r\n\t\t\t\t\t\t\t\treturn message({\r\n\t\t\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\t\t\tmessage: this.$t(\r\n\t\t\t\t\t\t\t\t\t\t'authoritymanagement_defaultrole_components_authoritysearch_201'\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {})\r\n\t\t},\r\n\t\t// 改变列表条数\r\n\t\thandleSizeChange(value) {\r\n\t\t\tthis.pageSize = value\r\n\t\t\tlocalStorage.setItem('pageSize', value)\r\n\t\t\tthis.loadData2()\r\n\t\t},\r\n\t\tgetNameByTran(row) {\r\n\t\t\treturn i18nRoute(row.permissionName)\r\n\t\t},\r\n\t\tgetEnName(row) {\r\n\t\t\treturn i18nRoute(row.permissionName)\r\n\t\t}\r\n\t}\r\n}\r\n",null]}