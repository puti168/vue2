{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\gamemanagement\\tableconfig\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\gamemanagement\\tableconfig\\index.vue","mtime":1615171048117},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { mapGetters } from 'vuex'\r\nimport list from '@/mixins/list'\r\nimport EditTable from './components/EditTable'\r\nimport { validPassword } from '@/utils/validate'\r\nimport { routerNames } from '@/utils/consts'\r\n\r\nexport default {\r\n\tname: routerNames.systemUser,\r\n\tcomponents: { EditTable },\r\n\tmixins: [list],\r\n\tdata() {\r\n\t\tconst validatePwd = (rule, value, callback) => {\r\n\t\t\tif (value === '') {\r\n\t\t\t\tcallback(new Error(this.$t('systemmanagement.systemmanagement_126')))\r\n\t\t\t} else if (!validPassword(value)) {\r\n\t\t\t\tcallback(new Error(this.$t('systemmanagement.systemmanagement_127')))\r\n\t\t\t} else {\r\n\t\t\t\tcallback()\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst validateRepwd = (rule, value, callback) => {\r\n\t\t\tif (value === '') {\r\n\t\t\t\tcallback(new Error(this.$t('systemmanagement.systemmanagement_128')))\r\n\t\t\t} else if (!validPassword(value)) {\r\n\t\t\t\tcallback(new Error(this.$t('systemmanagement.systemmanagement_127')))\r\n\t\t\t} else if (value !== this.passDialogForm.pwd) {\r\n\t\t\t\tcallback(new Error(this.$t('systemmanagement.systemmanagement_129')))\r\n\t\t\t} else {\r\n\t\t\t\tcallback()\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\thadSearch: false,\r\n\t\t\tloading: false,\r\n\t\t\tpassDialogVisible: false,\r\n\t\t\tpassDialogForm: {\r\n\t\t\t\tuserId: '',\r\n\t\t\t\tpwd: '',\r\n\t\t\t\trePwd: ''\r\n\t\t\t},\r\n\t\t\tpassDialogFormRules: {\r\n\t\t\t\tpwd: [{ required: true, validator: validatePwd, trigger: 'blur' }],\r\n\t\t\t\trePwd: [{ required: true, validator: validateRepwd, trigger: 'blur' }]\r\n\t\t\t},\r\n\t\t\teditType: 0, // 新建为0 ,编辑为1\r\n\t\t\tdrawer: false,\r\n\t\t\taddDrawer: false,\r\n\t\t\tcurrentPage: 1,\r\n\t\t\tform: {\r\n\t\t\t\tstartTime: '',\r\n\t\t\t\tendTime: '',\r\n\t\t\t\ttime: [],\r\n\t\t\t\tuserName: '',\r\n\t\t\t\tstatus: -1,\r\n\t\t\t\tcreateBy: '',\r\n\t\t\t\tpageSize: '',\r\n\t\t\t\tpageIndex: ''\r\n\t\t\t},\r\n\t\t\tuserData: {},\r\n\t\t\tpermissions: [],\r\n\t\t\tassignedPermissions: [],\r\n\t\t\tlist: [],\r\n\t\t\tdialogVisible: false,\r\n\t\t\tcurrentData: {},\r\n\t\t\tcurrentIndex: -1,\r\n\t\t\tremark: ''\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['name']),\r\n\t\t...mapGetters(['buttonPermissions']),\r\n\t\t...mapGetters(['userInfo'])\r\n\t},\r\n\tcreated() {\r\n\t\tthis.loadRoleList()\r\n\t},\r\n\tmethods: {\r\n\t\tloadData() {\r\n\t\t\tthis.loading = true\r\n\t\t\tconst initData = {\r\n\t\t\t\tpageSize: this.pageSize,\r\n\t\t\t\tpageIndex: this.pageIndex\r\n\t\t\t}\r\n\t\t\tconst requestData = this.hadSearch\r\n\t\t\t\t? {\r\n\t\t\t\t\t\tstartTime: this.form.time ? this.form.time[0] : '',\r\n\t\t\t\t\t\tendTime: this.form.time ? this.form.time[1] : '',\r\n\t\t\t\t\t\tcreateBy: this.form.createBy,\r\n\t\t\t\t\t\tstatus: this.form.status,\r\n\t\t\t\t\t\tuserName: this.form.userName && this.form.userName.replace(/\\s+/g, '')\r\n\t\t\t\t  }\r\n\t\t\t\t: {}\r\n\t\t\tconst form = {\r\n\t\t\t\t...initData,\r\n\t\t\t\t...requestData\r\n\t\t\t}\r\n\t\t\tthis.$api\r\n\t\t\t\t.merchantUserList(form)\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tthis.list = this.getComList(_.data.userList)\r\n\t\t\t\t\t\tthis.total = _.data.totalRecord\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t})\r\n\t\t},\r\n\t\tgetComList(list) {\r\n\t\t\treturn list.map((item) => {\r\n\t\t\t\tif (item.status === '0') {\r\n\t\t\t\t\titem.switchStatus = false\r\n\t\t\t\t} else if (item.status === '1') {\r\n\t\t\t\t\titem.switchStatus = true\r\n\t\t\t\t}\r\n\t\t\t\treturn item\r\n\t\t\t})\r\n\t\t},\r\n\t\thandleCurrentChange(val) {\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\thandleReset() {\r\n\t\t\tthis.form = {\r\n\t\t\t\tstartTime: '',\r\n\t\t\t\tendTime: '',\r\n\t\t\t\ttime: [],\r\n\t\t\t\tuserName: '',\r\n\t\t\t\tstatus: -1,\r\n\t\t\t\tcreateBy: '',\r\n\t\t\t\tpageSize: '',\r\n\t\t\t\tpageIndex: ''\r\n\t\t\t}\r\n\t\t\tthis.hadSearch = false\r\n\t\t\tthis.initList()\r\n\t\t},\r\n\t\thandleSearch() {\r\n\t\t\tthis.hadSearch = true\r\n\t\t\tthis.pageIndex = 1\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\t// 获取角色的所有可操作权限\r\n\t\tloadRoleList() {\r\n\t\t\tthis.$api.merchantUserRoleList().then((_) => {\r\n\t\t\t\tthis.permissions = this.filterPermissions(_.data) || []\r\n\t\t\t})\r\n\t\t},\r\n\t\tfilterPermissions(list) {\r\n\t\t\treturn (\r\n\t\t\t\tlist &&\r\n\t\t\t\tlist.map((item) => {\r\n\t\t\t\t\titem.label = item.roleName\r\n\t\t\t\t\titem.key = item.id\r\n\t\t\t\t\treturn item\r\n\t\t\t\t})\r\n\t\t\t)\r\n\t\t},\r\n\r\n\t\thandleDialogClose() {\r\n\t\t\tthis.$refs.passDialogForm.resetFields()\r\n\t\t\tthis.passDialogVisible = false\r\n\t\t},\r\n\t\tcommitPassDialogForm() {\r\n\t\t\tthis.$refs.passDialogForm.validate((valid) => {\r\n\t\t\t\tif (valid) {\r\n\t\t\t\t\tthis.$api.merchantModifyUserPass(this.passDialogForm).then((_) => {\r\n\t\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\t\tthis.$refs.passDialogForm.resetFields()\r\n\t\t\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\t\tmessage: this.$t('systemmanagement.systemmanagement_39')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tthis.passDialogVisible = false\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\teditRow(index, row) {\r\n\t\t\tthis.drawer = true\r\n\t\t\tthis.$api.merchantGetUserDetail({ id: row.id }).then((_) => {\r\n\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\tthis.userData = _.data\r\n\t\t\t\t\tthis.assignedPermissions = _.data.userRole || []\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\teditAccountStatus(index, row) {\r\n\t\t\tthis.currentData = row\r\n\t\t\tthis.currentIndex = index\r\n\t\t\tthis.dialogVisible = true\r\n\t\t},\r\n\t\teditPass(row) {\r\n\t\t\tthis.addDrawer = true\r\n\t\t\tthis.editType = 1\r\n\t\t\tthis.userData = row\r\n\t\t\tthis.passDialogForm.userName = row.userName\r\n\t\t\tthis.passDialogForm.userId = row.id\r\n\t\t},\r\n\t\thandleNewRole() {\r\n\t\t\tthis.addDrawer = true\r\n\t\t\tthis.editType = 0\r\n\t\t\tthis.userData = {\r\n\t\t\t\tuserName: ''\r\n\t\t\t}\r\n\t\t\tthis.assignedPermissions = []\r\n\t\t},\r\n\r\n\t\tstopRow(index, row, list) {\r\n\t\t\tlet status = '-1'\r\n\t\t\tif (row.status === '0') {\r\n\t\t\t\tstatus = '1'\r\n\t\t\t} else if (row.status === '1') {\r\n\t\t\t\tstatus = '0'\r\n\t\t\t}\r\n\t\t\tthis.$api\r\n\t\t\t\t.merchantModifyUserStatus({\r\n\t\t\t\t\tuserId: row.id,\r\n\t\t\t\t\tuserName: row.userName,\r\n\t\t\t\t\tstatus\r\n\t\t\t\t})\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\t// 静态更新状态\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tthis.$set(this.list[index], 'status', status)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t},\r\n\t\tupdateList(id, status, list) {\r\n\t\t\tthis.list = list.map((item) => {\r\n\t\t\t\tif (item.id === id) {\r\n\t\t\t\t\titem.status = status\r\n\t\t\t\t\titem.statusText =\r\n\t\t\t\t\t\tstatus === '0'\r\n\t\t\t\t\t\t\t? this.$t('gamemanagement_tableconfig_index_393')\r\n\t\t\t\t\t\t\t: this.$t('gamemanagement_tableconfig_index_394')\r\n\t\t\t\t}\r\n\t\t\t\treturn item\r\n\t\t\t})\r\n\t\t},\r\n\t\teditCallBack() {\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\thandleCancle() {\r\n\t\t\tthis.remark = ''\r\n\t\t\tthis.dialogVisible = false\r\n\t\t\tthis.currentData.switchStatus = !this.currentData.switchStatus\r\n\t\t\tthis.list.splice(this.currentIndex, 1, this.currentData)\r\n\t\t},\r\n\t\thandleSure() {\r\n\t\t\tconst data = {\r\n\t\t\t\tuserName: this.currentData.userName,\r\n\t\t\t\tuserId: this.currentData.id,\r\n\t\t\t\tstatus: this.currentData.switchStatus ? 1 : 0,\r\n\t\t\t\tremark: this.remark || ''\r\n\t\t\t}\r\n\t\t\tthis.$api.merchantModifyUserStatus(data).then((_) => {\r\n\t\t\t\t// 静态更新状态\r\n\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\tthis.loadData()\r\n\t\t\t\t\tthis.dialogVisible = false\r\n\t\t\t\t\tthis.remark = ''\r\n\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\tmessage: this.$t('systemmanagement.systemmanagement_39')\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n",null]}