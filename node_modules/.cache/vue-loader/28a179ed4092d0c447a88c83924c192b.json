{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\systemmanagement\\downloadlog\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\systemmanagement\\downloadlog\\index.vue","mtime":1615171048174},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport list from '@/mixins/list'\r\nimport { mapGetters } from 'vuex'\r\nimport { routerNames } from '@/utils/consts'\r\nimport SelectAgentTree from '@/components/SelectAgentTree'\r\nimport dayjs from 'dayjs'\r\nimport { message } from '@/utils/message'\r\n\r\nexport default {\r\n\tname: routerNames.downloadlog,\r\n\tcomponents: { SelectAgentTree },\r\n\tmixins: [list],\r\n\tdata() {\r\n\t\tconst end = dayjs()\r\n\t\t\t.endOf('day')\r\n\t\t\t.valueOf()\r\n\t\tconst start = dayjs()\r\n\t\t\t.startOf('day')\r\n\t\t\t.subtract(6, 'd')\r\n\t\t\t.valueOf()\r\n\t\treturn {\r\n\t\t\thadSearch: false,\r\n\t\t\tloading: false,\r\n\t\t\tform: {\r\n\t\t\t\tip: '',\r\n\t\t\t\ttime: [start, end],\r\n\t\t\t\tagentId: ''\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['buttonPermissions'])\r\n\t},\r\n\tmethods: {\r\n\t\tloadData() {\r\n\t\t\tif (this.form.time) {\r\n\t\t\t\tconst divides = Number(this.form.time[1]) - Number(this.form.time[0])\r\n\t\t\t\tif (divides > 90 * 24 * 60 * 60 * 1000) {\r\n\t\t\t\t\treturn message({\r\n\t\t\t\t\t\ttype: 'error',\r\n\t\t\t\t\t\tmessage: this.$t('systemmanagement_downloadlog_index_1401')\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.loading = true\r\n\t\t\tconst initData = {\r\n\t\t\t\tpageSize: this.pageSize,\r\n\t\t\t\tpageIndex: this.pageIndex,\r\n\t\t\t\tstartDate: this.form.time ? this.form.time[0] : '',\r\n\t\t\t\tendDate: this.form.time ? this.form.time[1] : ''\r\n\t\t\t}\r\n\t\t\tconst requestData = this.hadSearch\r\n\t\t\t\t? {\r\n\t\t\t\t\t\tcreatedBy: this.form.createdBy,\r\n\t\t\t\t\t\tagentId: this.form.agentId\r\n\t\t\t\t  }\r\n\t\t\t\t: {}\r\n\t\t\tconst form = {\r\n\t\t\t\t...initData,\r\n\t\t\t\t...requestData\r\n\t\t\t}\r\n\t\t\tthis.$api\r\n\t\t\t\t.listDownPage({\r\n\t\t\t\t\t...form\r\n\t\t\t\t})\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\tconst data = _.data\r\n\t\t\t\t\tthis.total = data.totalRecord\r\n\t\t\t\t\tthis.list = data.record\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t})\r\n\t\t},\r\n\t\thandleCurrentChange(val) {\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\thandleReset() {\r\n\t\t\tconst end = dayjs()\r\n\t\t\t\t.endOf('day')\r\n\t\t\t\t.valueOf()\r\n\t\t\tconst start = dayjs()\r\n\t\t\t\t.startOf('day')\r\n\t\t\t\t.subtract(6, 'd')\r\n\t\t\t\t.valueOf()\r\n\t\t\tthis.form = {\r\n\t\t\t\ttime: [start, end],\r\n\t\t\t\tagentId: '',\r\n\t\t\t\tcreatedBy: ''\r\n\t\t\t}\r\n\t\t\tthis.hadSearch = false\r\n\t\t\tthis.initList()\r\n\t\t},\r\n\t\thandleSearch() {\r\n\t\t\tthis.hadSearch = true\r\n\t\t\tthis.pageIndex = 1\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\t// 重新生成文件\r\n\t\tuploadAgain(id) {\r\n\t\t\tthis.$api\r\n\t\t\t\t.uploadAgain({\r\n\t\t\t\t\tid\r\n\t\t\t\t})\r\n\t\t\t\t.then((res) => {\r\n\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\tconst index = this.list.findIndex((val) => val.id === id)\r\n\t\t\t\t\t\tif (index > -1) {\r\n\t\t\t\t\t\t\tconst newOne = {\r\n\t\t\t\t\t\t\t\t...this.list[index],\r\n\t\t\t\t\t\t\t\tstatus: '2'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.list.splice(index, 1, newOne)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn message({\r\n\t\t\t\t\t\t\tmessage: this.$t('systemmanagement_downloadlog_index_1402'),\r\n\t\t\t\t\t\t\ttype: 'success'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t},\r\n\t\t// 下载文件\r\n\t\tdownLoadFile(id) {\r\n\t\t\tthis.$api.downLoadFile({ id }).then((res) => {\r\n\t\t\t\twindow.open(res.data.resourceUrl, '_blank')\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tconst index = this.list.findIndex((val) => val.id === id)\r\n\t\t\t\t\tif (index > -1) {\r\n\t\t\t\t\t\tconst newOne = {\r\n\t\t\t\t\t\t\t...this.list[index],\r\n\t\t\t\t\t\t\tstatus: '3'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.list.splice(index, 1, newOne)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n",null]}