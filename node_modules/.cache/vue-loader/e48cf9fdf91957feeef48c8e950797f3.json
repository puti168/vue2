{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\pages\\index\\views\\manager\\user\\index.vue?vue&type=style&index=0&id=ce87a4dc&lang=less&scoped=true&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\pages\\index\\views\\manager\\user\\index.vue","mtime":1617594855328},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KL2RlZXAvIHRoIHsNCiAgdGV4dC1hbGlnbjogY2VudGVyICFpbXBvcnRhbnQ7DQogIG92ZXJmbG93OiBoaWRkZW4gIWltcG9ydGFudDsNCiAgZm9udC1mYW1pbHk6ICdBcmlhbCBOZWdyZXRhJywgJ0FyaWFsIE5vcm1hbCcsICdBcmlhbCcsIHNhbnMtc2VyaWY7DQogIGZvbnQtd2VpZ2h0OiA3MDAgIWltcG9ydGFudDsNCiAgZm9udC1zdHlsZTogbm9ybWFsOw0KfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2VA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/index/views/manager/user","sourcesContent":["<template>\r\n  <div>\r\n    <a-card>\r\n      <search-form ref=\"searchForm\" :searchFunc=\"search\" :roleList=\"roleList\" />\r\n      <a-button\r\n        type=\"primary\"\r\n        class=\"bd-right\"\r\n        v-action:xzzh\r\n        style=\"margin: -20px 0 20px 0\"\r\n        @click=\"\r\n          () => {\r\n            modalVisible = true\r\n          }\r\n        \"\r\n      >\r\n        新增账号\r\n      </a-button>\r\n      <a-modal v-model=\"modalVisible\" width=\"680px\" title=\"新增账号\" @ok=\"nextSubmit\" destroyOnClose okText=\"下一步\">\r\n        <add-Form ref=\"addForm\" :roleList=\"roleList\"></add-Form>\r\n      </a-modal>\r\n      <a-modal v-model=\"googleModalVisible\" width=\"680px\" title=\"绑定Google验证器\" @ok=\"googleOk\" destroyOnClose>\r\n        <google-Key ref=\"googleKey\" :googleData=\"googleData\" :addData=\"addData\" :googlefn=\"googlefn\"></google-Key>\r\n      </a-modal>\r\n      <a-table\r\n        style=\"margin-bottom: 10px\"\r\n        :columns=\"columns\"\r\n        :data-source=\"tableData\"\r\n        :pagination=\"pagination\"\r\n        :loading=\"tableLoading\"\r\n        size=\"middle\"\r\n        bordered\r\n        rowKey=\"id\"\r\n        @change=\"onTableChange\"\r\n      >\r\n        <template slot=\"index\" slot-scope=\"text, record, index\">\r\n          <span>{{ index + 1 }}</span>\r\n        </template>\r\n        <template slot=\"login\" slot-scope=\"text, record\">\r\n          <span>{{ record.loginTime }}/{{ record.loginIp }}</span>\r\n        </template>\r\n        <template slot=\"switchStatus\" slot-scope=\"text, record, index\">\r\n          <div v-if=\"$auth('ztxg')\">\r\n            <a-switch\r\n              v-action:ztxg\r\n              style=\"width: 68px\"\r\n              v-show=\"record.id != id\"\r\n              checked-children=\"启用\"\r\n              un-checked-children=\"禁用\"\r\n              :checked=\"text == 1\"\r\n              @click=\"switchChange(text, record, index)\"\r\n            />\r\n            <span v-show=\"record.id == id\">启用</span>\r\n          </div>\r\n          <div v-else>\r\n            <span v-if=\"text == 1\">启用</span>\r\n            <span v-else>禁用</span>\r\n          </div>\r\n        </template>\r\n        <template slot=\"deleted\" slot-scope=\"text, record, index\">\r\n          <a-button type=\"link\" v-action:xg size=\"small\" v-show=\"record.id != id\" @click=\"edit(text, record, index)\">\r\n            修改\r\n          </a-button>\r\n          <a-button\r\n            type=\"link\"\r\n            v-action:gxmy\r\n            size=\"small\"\r\n            v-show=\"record.id != id\"\r\n            @click=\"updateKey(text, record, index)\"\r\n          >\r\n            更新秘钥\r\n          </a-button>\r\n          <a-button\r\n            type=\"link\"\r\n            v-action:sc\r\n            size=\"small\"\r\n            v-show=\"record.id != id\"\r\n            @click=\"deleteUpdate(text, record, index)\"\r\n          >\r\n            删除\r\n          </a-button>\r\n        </template>\r\n      </a-table>\r\n      <a-modal v-model=\"editModalVisible\" width=\"680px\" title=\"修改账号\" @ok=\"editSubmit\" destroyOnClose>\r\n        <edit-form ref=\"editForm\" :formData=\"formData\" :editformfn=\"editformfn\" :roleList=\"roleList\"></edit-form>\r\n      </a-modal>\r\n      <change-google-key-form\r\n        :visible.sync=\"googleForm.visible\"\r\n        :formData=\"googleForm.data\"\r\n        v-if=\"googleForm.visible\"\r\n        :type=\"googleForm.type\"\r\n        @ok=\"handleOk\"\r\n      />\r\n    </a-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { PaginationMixin, StoreMixin } from '@/core/mixins'\r\nimport SearchForm from './components/SearchForm'\r\nimport AddForm from './components/AddForm'\r\nimport googleKey from './components/googleKey'\r\nimport EditForm from './components/EditForm'\r\nimport ChangeGoogleKeyForm from './components/ChangeGoogleKeyForm'\r\nimport { getQueryUser, setStatusUpdate, setDeleteUpdate, getQueryRole, getGooglePath } from '@/api/user'\r\nconst columns = [\r\n  {\r\n    title: '序号',\r\n    dataIndex: 'index',\r\n    key: 'num',\r\n    width: '5%',\r\n    align: 'center',\r\n    scopedSlots: { customRender: 'index' },\r\n  },\r\n  {\r\n    title: '账号名称',\r\n    dataIndex: 'adminName',\r\n    key: 'acc',\r\n    align: 'center',\r\n    width: '10%',\r\n  },\r\n  {\r\n    title: '创建时间',\r\n    dataIndex: 'createdAt',\r\n    key: 'crea',\r\n    width: '10%',\r\n    align: 'center',\r\n  },\r\n  {\r\n    title: '所属角色',\r\n    dataIndex: 'roleName',\r\n    key: 'user',\r\n    width: '10%',\r\n    align: 'center',\r\n  },\r\n  {\r\n    title: '最近登录时间/IP',\r\n    dataIndex: 'login',\r\n    key: 'ip',\r\n    width: '18%',\r\n    align: 'center',\r\n    scopedSlots: { customRender: 'login' },\r\n  },\r\n  {\r\n    title: '创建人',\r\n    dataIndex: 'createdBy',\r\n    key: 'founder',\r\n    width: '10%',\r\n    align: 'center',\r\n  },\r\n  {\r\n    title: '备注信息',\r\n    dataIndex: 'remark',\r\n    key: 'rem',\r\n    width: '15%',\r\n    align: 'center',\r\n  },\r\n  {\r\n    title: '启用状态',\r\n    dataIndex: 'status',\r\n    key: 'state',\r\n    width: '10%',\r\n    align: 'center',\r\n    scopedSlots: { customRender: 'switchStatus' },\r\n  },\r\n  {\r\n    title: '操作',\r\n    dataIndex: 'deleted',\r\n    key: 'oper',\r\n    align: 'center',\r\n    width: '12%',\r\n    scopedSlots: { customRender: 'deleted' },\r\n  },\r\n]\r\nexport default {\r\n  mixins: [PaginationMixin, StoreMixin],\r\n  components: {\r\n    SearchForm,\r\n    AddForm,\r\n    googleKey,\r\n    EditForm,\r\n    ChangeGoogleKeyForm,\r\n  },\r\n  data() {\r\n    return {\r\n      roleList: [], //角色列表\r\n      columns,\r\n      tableData: [],\r\n      tableLoading: false,\r\n      modalVisible: false,\r\n      googleModalVisible: false,\r\n      editModalVisible: false,\r\n      adminName: '',\r\n      googleData: {\r\n        googleKey: '',\r\n        googleCode: '',\r\n        googleKeyUrl: '',\r\n      },\r\n      id: this.getUserInfo('id'),\r\n      addData: {},\r\n      formData: {},\r\n      googleForm: { data: {}, visible: false, type: 'add' },\r\n    }\r\n  },\r\n  created() {\r\n    getQueryRole()\r\n      .then((res) => {\r\n        if (res.code === 200) {\r\n          this.roleList = res.data\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        console.log(err)\r\n      })\r\n  },\r\n  methods: {\r\n    search() {\r\n      this.fetch(1, this.pageSize)\r\n    },\r\n    fetch(page, pageSize) {\r\n      console.log(page, pageSize)\r\n      this.tableLoading = true\r\n      this.page = page\r\n      this.pageSize = pageSize\r\n      let res = this.$refs.searchForm.searchForm\r\n      let resData = Object.assign({}, res)\r\n      resData.pageNum = page\r\n      resData.pageSize = pageSize\r\n      resData.adminName = resData.adminName == '' ? null : resData.adminName\r\n      resData.startTime = resData.startTime == '' ? null : resData.startTime\r\n      resData.endTime = resData.endTime == '' ? null : resData.endTime\r\n      resData.createdBy = resData.createdBy == '' ? null : resData.createdBy\r\n      resData.roleId = resData.roleId == '' ? null : resData.roleId\r\n      resData.roleName = resData.roleName == '' ? null : resData.roleName\r\n      resData.status = resData.status == null ? 0 : resData.status\r\n      getQueryUser(resData)\r\n        .then((res) => {\r\n          if (res.code === 200) {\r\n            this.tableData = res.data\r\n            this.total = res.totalCount\r\n            this.tableLoading = false\r\n          } else {\r\n            this.$message.error(res.msg)\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err)\r\n        })\r\n    },\r\n    nextSubmit() {\r\n      this.$refs.addForm.next(() => {\r\n        this.addData = this.$refs.addForm.addData\r\n        if (this.addData.adminName != '') {\r\n          this.modalVisible = false\r\n          this.googleModalVisible = true\r\n          getGooglePath({ adminName: this.addData.adminName })\r\n            .then((res) => {\r\n              console.log(res)\r\n              if (res.code === 200) {\r\n                this.googleData.googleKey = res.data.secret\r\n                this.googleData.googleCode = res.data.code\r\n                this.addData.secret = res.data.secret\r\n                this.googleData.googleKeyUrl = res.data.url\r\n              }\r\n            })\r\n            .catch((err) => {\r\n              console.log(err)\r\n            })\r\n        }\r\n      })\r\n    },\r\n    googleOk() {\r\n      this.$refs.googleKey.googleOk(() => {\r\n        this.googleModalVisible = false\r\n      })\r\n    },\r\n    googlefn() {\r\n      this.fetch(1, this.pageSize)\r\n    },\r\n    switchChange(text, record, index) {\r\n      this.tableLoading = true\r\n      let status\r\n      if (record.status != 0) {\r\n        status = 0\r\n      } else {\r\n        status = 1\r\n      }\r\n      setStatusUpdate({ status, adminId: record.id })\r\n        .then((res) => {\r\n          if (res.code === 200) {\r\n            this.$message.success(res.msg)\r\n            this.tableLoading = false\r\n            this.fetch(1, this.pageSize)\r\n          } else {\r\n            this.tableLoading = false\r\n            this.$message.error(res.msg)\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err)\r\n        })\r\n    },\r\n    editformfn() {\r\n      this.fetch(1, this.pageSize)\r\n    },\r\n    edit(text, record, index) {\r\n      this.formData = JSON.parse(JSON.stringify(record))\r\n      this.editModalVisible = true\r\n    },\r\n    editSubmit() {\r\n      this.$refs.editForm.editSubmit(() => {\r\n        this.editModalVisible = false\r\n      })\r\n    },\r\n    updateKey(text, record, index) {\r\n      this.googleForm = { data: { adminId: record.id, adminName: record.adminName }, visible: true, type: 'add' }\r\n    },\r\n    handleOk() {\r\n      this.fetch(1, this.pageSize)\r\n    },\r\n    deleteUpdate(text, index, record) {\r\n      let that = this\r\n      this.$confirm({\r\n        title: '您确定要删除该用户吗？',\r\n        content: (h) => <div style=\"color:red;\">删除用户后，该用户将无法登录平台</div>,\r\n        bodyStyle: { color: 'red' },\r\n        closable: true,\r\n        onOk() {\r\n          setDeleteUpdate({ id: index.id, adminName: index.adminName })\r\n            .then((res) => {\r\n              if (res.code === 200) {\r\n                that.fetch(1, that.pageSize)\r\n                that.$message.success(res.msg)\r\n              } else {\r\n                that.$message.error(res.msg)\r\n              }\r\n            })\r\n            .catch((err) => {\r\n              console.log(err)\r\n            })\r\n        },\r\n      })\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n/deep/ th {\r\n  text-align: center !important;\r\n  overflow: hidden !important;\r\n  font-family: 'Arial Negreta', 'Arial Normal', 'Arial', sans-serif;\r\n  font-weight: 700 !important;\r\n  font-style: normal;\r\n}\r\n</style>"]}]}