{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\layout\\components\\ModifyPassword.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\layout\\components\\ModifyPassword.vue","mtime":1615171048036},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport router from '@/router'\r\nimport { validPassword } from '@/utils/validate'\r\nimport { mapGetters } from 'vuex'\r\n// import md5 from 'js-md5'\r\nexport default {\r\n\tname: 'ModifyPassword',\r\n\tprops: {\r\n\t\teditVisible: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t}\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tvisible: false,\r\n\t\t\tpassDialogForm: {\r\n\t\t\t\toldPassword: '',\r\n\t\t\t\tpwd: '',\r\n\t\t\t\trePwd: ''\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['userInfo']),\r\n\t\trules() {\r\n\t\t\tconst validatePwd = (rule, value, callback) => {\r\n\t\t\t\tif (value && value.length < 6) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_usermanage_components_edituser_309')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else if (value && value.length > 12) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_usermanage_components_edituser_310')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else if (value === '' || !validPassword(value)) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_usermanage_components_edituser_311')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst validateRepwd = (rule, value, callback) => {\r\n\t\t\t\tif (value !== this.passDialogForm.password) {\r\n\t\t\t\t\tcallback(\r\n\t\t\t\t\t\tnew Error(\r\n\t\t\t\t\t\t\tthis.$t('authoritymanagement_usermanage_components_edituser_312')\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\toldPassword: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\tmessage: this.$t('other_008'),\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\tpassword: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\tvalidator: validatePwd,\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\tpasswordAgain: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\tvalidator: validateRepwd,\r\n\t\t\t\t\t\ttrigger: 'blur'\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\teditVisible(val) {\r\n\t\t\tthis.visible = val\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tcancel() {\r\n\t\t\tthis.$store.dispatch('app/setModify', false)\r\n\t\t\tthis.$refs.form.clearValidate()\r\n\t\t\tthis.passDialogForm = {\r\n\t\t\t\toldPassword: '',\r\n\t\t\t\tpwd: '',\r\n\t\t\t\trePwd: ''\r\n\t\t\t}\r\n\t\t},\r\n\t\thandleSure() {\r\n\t\t\tthis.$refs.form.validate((valid) => {\r\n\t\t\t\tif (valid) {\r\n\t\t\t\t\tconst params = {\r\n\t\t\t\t\t\tagentCode: this.userInfo.agentCode,\r\n\t\t\t\t\t\tloginName: this.userInfo.username,\r\n\t\t\t\t\t\t// oldPassword: md5(this.passDialogForm.oldPassword + this.userInfo.username.trim()),\r\n\t\t\t\t\t\t// password: md5(this.passDialogForm.password + this.userInfo.username.trim()),\r\n\t\t\t\t\t\t// passwordAgain: md5(this.passDialogForm.passwordAgain + this.userInfo.username.trim())\r\n\t\t\t\t\t\toldPassword: this.passDialogForm.oldPassword,\r\n\t\t\t\t\t\tpassword: this.passDialogForm.password,\r\n\t\t\t\t\t\tpasswordAgain: this.passDialogForm.passwordAgain\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.$api.changeLoginPwd(params).then(async (res) => {\r\n\t\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\t\tawait this.$store.dispatch('user/logout')\r\n\t\t\t\t\t\t\tawait this.$store.dispatch('permission/clearRoutes')\r\n\t\t\t\t\t\t\tawait this.$store.dispatch('app/setModify', false)\r\n\t\t\t\t\t\t\tthis.$router.push(`/login?redirect=${router.history.current.fullPath}`)\r\n\t\t\t\t\t\t\treturn this.$message({\r\n\t\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\t\tmessage: this.$t('other_009')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n",null]}