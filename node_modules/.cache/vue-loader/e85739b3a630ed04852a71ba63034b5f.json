{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\home\\components\\DataTrend.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\home\\components\\DataTrend.vue","mtime":1615171048119},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { formatCurrency } from '@/utils'\r\nimport dayjs from 'dayjs'\r\nimport SelectAgentTree from '@/components/SelectAgentTree'\r\nimport { mapGetters } from 'vuex'\r\n\r\nlet timer2\r\n\r\nexport default {\r\n\tname: 'DataTrend',\r\n\tcomponents: { SelectAgentTree },\r\n\tdata() {\r\n\t\tconst start = dayjs()\r\n\t\t\t.startOf('day')\r\n\t\t\t.subtract(30, 'd')\r\n\t\t\t.valueOf()\r\n\r\n\t\tconst end = dayjs()\r\n\t\t\t.subtract(1, 'd')\r\n\t\t\t.endOf('day')\r\n\t\t\t.valueOf()\r\n\t\treturn {\r\n\t\t\t// 走势时间区间\r\n\r\n\t\t\t// 数据走势\r\n\t\t\ttrendData: {},\r\n\t\t\t// 获取数据走势类型\r\n\t\t\ttrendTypes: 0,\r\n\t\t\tform: {\r\n\t\t\t\tagentId: '',\r\n\t\t\t\ttimes: [start, end]\r\n\t\t\t},\r\n\t\t\tcountDown: 30,\r\n\t\t\tlineData: {\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\ttrigger: 'axis',\r\n\t\t\t\t\tformatter: (params) => {\r\n\t\t\t\t\t\tlet str = ''\r\n\t\t\t\t\t\tparams &&\r\n\t\t\t\t\t\t\tparams.forEach((element, index) => {\r\n\t\t\t\t\t\t\t\tif (index === 0) {\r\n\t\t\t\t\t\t\t\t\tstr = `<div>${this.$t('detailrecord.detailrecord_18')}:${\r\n\t\t\t\t\t\t\t\t\t\telement.name\r\n\t\t\t\t\t\t\t\t\t}</div><div>${this.getEnName(element.seriesName)}:${formatCurrency(\r\n\t\t\t\t\t\t\t\t\t\telement.data,\r\n\t\t\t\t\t\t\t\t\t\tfalse\r\n\t\t\t\t\t\t\t\t\t)}</div>`\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tstr += `<div>${this.getEnName(element.seriesName)}:${formatCurrency(\r\n\t\t\t\t\t\t\t\t\t\telement.data,\r\n\t\t\t\t\t\t\t\t\t\tfalse\r\n\t\t\t\t\t\t\t\t\t)}</div>`\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\treturn str // 最后返回拼接好的值\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\txAxis: {\r\n\t\t\t\t\ttype: 'category',\r\n\t\t\t\t\tdata: []\r\n\t\t\t\t},\r\n\t\t\t\tyAxis: {\r\n\t\t\t\t\ttype: 'value'\r\n\t\t\t\t},\r\n\t\t\t\tseries: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: this.$t('home_totalline_components_datatrend_431'),\r\n\t\t\t\t\t\tdata: [],\r\n\t\t\t\t\t\ttype: 'line',\r\n\t\t\t\t\t\t// 显示数值\r\n\t\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\t\t\tformatter: (params) => {\r\n\t\t\t\t\t\t\t\t\t\tif (params.data !== 0) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn formatCurrency(params.data, false)\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\treturn ''\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsmooth: false\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tcomputed: {\r\n\t\t...mapGetters(['agentId']),\r\n\t\tpickerOptions() {\r\n\t\t\tconst _this = this\r\n\t\t\treturn {\r\n\t\t\t\tdisabledDate(time) {\r\n\t\t\t\t\tconst before = dayjs(_this.minDate)\r\n\t\t\t\t\t\t.startOf('day')\r\n\t\t\t\t\t\t.subtract(90, 'days')\r\n\t\t\t\t\t\t.valueOf()\r\n\t\t\t\t\tconst after = dayjs(_this.minDate)\r\n\t\t\t\t\t\t.endOf('day')\r\n\t\t\t\t\t\t.add(90, 'days')\r\n\t\t\t\t\t\t.valueOf()\r\n\t\t\t\t\tconst now = dayjs()\r\n\t\t\t\t\t\t.subtract(1, 'd')\r\n\t\t\t\t\t\t.endOf('day')\r\n\t\t\t\t\t\t.valueOf()\r\n\t\t\t\t\t// 如果after-now大于0,说明选择时间在当前时间90天之前\r\n\t\t\t\t\tif (after - now < 0) {\r\n\t\t\t\t\t\treturn time.getTime() > after || time.getTime() < before\r\n\t\t\t\t\t} else if (_this.minDate) {\r\n\t\t\t\t\t\treturn time.getTime() > now || time.getTime() < before\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn time.getTime() > now\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonPick({ maxDate, minDate }) {\r\n\t\t\t\t\tif (!maxDate) {\r\n\t\t\t\t\t\t_this.minDate = minDate\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\t'form.agentId'(val) {\r\n\t\t\tthis.getTrendData({\r\n\t\t\t\ttrendTypes: this.trendTypes,\r\n\t\t\t\ttimes: this.form.times\r\n\t\t\t})\r\n\t\t},\r\n\t\ttrendData(val) {\r\n\t\t\tthis.lineData.xAxis['data'] = val.xaxis.data\r\n\t\t\tthis.lineData.series[0] = {\r\n\t\t\t\t...this.lineData.series[0],\r\n\t\t\t\t...val.series[0],\r\n\t\t\t\tstack: this.$t('home_totalline_components_datatrend_432')\r\n\t\t\t}\r\n\t\t\tif (this.trendTypes === 3) {\r\n\t\t\t\tthis.lineData.series[1] = {\r\n\t\t\t\t\t...val.series[1],\r\n\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\t\tposition: 'bottom',\r\n\t\t\t\t\t\t\t\tformatter: (params) => {\r\n\t\t\t\t\t\t\t\t\tif (params.data !== 0) {\r\n\t\t\t\t\t\t\t\t\t\treturn formatCurrency(params.data, false)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\treturn ''\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tlineStyle: {\r\n\t\t\t\t\t\t\t\twidth: 2,\r\n\t\t\t\t\t\t\t\ttype: 'dashed' // 'dotted'虚线 'solid'实线\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstack: this.$t('home_totalline_components_datatrend_433')\r\n\t\t\t\t}\r\n\t\t\t\tthis.lineData.series[2] = {\r\n\t\t\t\t\t...val.series[2],\r\n\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\tnormal: {\r\n\t\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\t\tposition: 'bottom',\r\n\t\t\t\t\t\t\t\tformatter: (params) => {\r\n\t\t\t\t\t\t\t\t\tif (params.data !== 0) {\r\n\t\t\t\t\t\t\t\t\t\treturn formatCurrency(params.data, false)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\treturn ''\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tlineStyle: {\r\n\t\t\t\t\t\t\t\twidth: 2,\r\n\t\t\t\t\t\t\t\ttype: 'dotted' // 'dotted'虚线 'solid'实线\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstack: this.$t('home_totalline_components_datatrend_434')\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.lineData.series.splice(1, 2)\r\n\t\t\t}\r\n\t\t\tthis.lineData = {\r\n\t\t\t\t...this.lineData\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tcreated() {\r\n\t\tthis.form.agentId = this.agentId\r\n\t},\r\n\tmounted() {\r\n\t\twindow.addEventListener('resize', this.resizeHandle)\r\n\t},\r\n\tdestroyed() {\r\n\t\twindow.removeEventListener('resize', this.resizeHandle)\r\n\t\tclearInterval(timer2)\r\n\t},\r\n\tmethods: {\r\n\t\tgetEnName(name) {\r\n\t\t\tif (name.includes('新增注册人数')) {\r\n\t\t\t\treturn this.$t('home_totalline_components_datatrend_413')\r\n\t\t\t}\r\n\t\t\tif (name.includes('上线会员趋势')) {\r\n\t\t\t\treturn this.$t('home_totalline_components_datatrend_415')\r\n\t\t\t}\r\n\t\t\tif (name.includes('投注真钱用户数')) {\r\n\t\t\t\treturn this.$t('home_totalline_components_datatrend_417')\r\n\t\t\t}\r\n\t\t\tif (name.includes('派彩')) {\r\n\t\t\t\treturn this.$t('home_totalline_components_datatrend_428')\r\n\t\t\t}\r\n\t\t\tif (name === '投注金额') {\r\n\t\t\t\treturn this.$t('home_totalline_components_datatrend_426')\r\n\t\t\t}\r\n\t\t\tif (name === '有效投注金额') {\r\n\t\t\t\treturn this.$t('home_totalline_components_datatrend_427')\r\n\t\t\t}\r\n\t\t\tif (name.includes('商户盈利趋势')) {\r\n\t\t\t\treturn this.$t('home_totalline_components_datatrend_421')\r\n\t\t\t}\r\n\t\t\treturn name\r\n\t\t},\r\n\t\t// 数据走势数据获取\r\n\t\tgetTrendData(data) {\r\n\t\t\tlet api\r\n\t\t\tswitch (data.trendTypes) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tapi = 'newRegisterAnalysis'\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tapi = 'onlinePlayersAnalysis'\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tapi = 'betPlayersAnalysis'\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tapi = 'betAndPayoutAnalysis'\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\tapi = 'betNetAmountAnalysis'\r\n\t\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tthis.$api[api]({\r\n\t\t\t\tagentId: this.form.agentId,\r\n\t\t\t\tstartDate: data.times ? data.times[0] : '',\r\n\t\t\t\tendDate: data.times ? data.times[1] : ''\r\n\t\t\t}).then((res) => {\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tthis.trendData = res.data\r\n\t\t\t\t\tthis.showDataTrend = true\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t// 数据走势条件改变\r\n\t\ttrendDataChange(data) {\r\n\t\t\tconsole.log('33')\r\n\t\t\tif (data.trendTypes !== undefined) {\r\n\t\t\t\tthis.trendTypes = data.trendTypes\r\n\t\t\t}\r\n\t\t\tif (data.times) {\r\n\t\t\t\tthis.form.times = data.times\r\n\t\t\t}\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tthis.getTrendData({\r\n\t\t\t\t\ttrendTypes: this.trendTypes,\r\n\t\t\t\t\ttimes: this.form.times\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t},\r\n\t\tresizeHandle() {\r\n\t\t\tthis.$refs.myEchart && this.$refs.myEchart.resize()\r\n\t\t},\r\n\t\thandleChartType(index) {\r\n\t\t\tthis.trendDataChange({ trendTypes: index })\r\n\t\t},\r\n\t\ttimeChange(value) {\r\n\t\t\tthis.trendDataChange({ times: value })\r\n\t\t},\r\n\t\tgetText() {\r\n\t\t\tconst trendTypes = this.trendTypes\r\n\t\t\tlet scopeText, unitText\r\n\t\t\tif (trendTypes === 0) {\r\n\t\t\t\tscopeText = this.$t('home_totalline_components_datatrend_435')\r\n\t\t\t\tunitText = this.$t('home_totalline_components_datatrend_436')\r\n\t\t\t} else if (trendTypes === 1) {\r\n\t\t\t\tscopeText = this.$t('home_totalline_components_datatrend_437')\r\n\t\t\t\tunitText = this.$t('home_totalline_components_datatrend_436')\r\n\t\t\t} else if (trendTypes === 2) {\r\n\t\t\t\tscopeText = this.$t('home_totalline_components_datatrend_438')\r\n\t\t\t\tunitText = this.$t('home_totalline_components_datatrend_439')\r\n\t\t\t} else {\r\n\t\t\t\tscopeText = this.$t('home_totalline_components_datatrend_440')\r\n\t\t\t\tunitText = this.$t('home_totalline_components_datatrend_441')\r\n\t\t\t}\r\n\t\t\treturn { scopeText, unitText }\r\n\t\t},\r\n\t\t// 刷新倒计时\r\n\t\trefreshCountDown() {\r\n\t\t\tconst time = setInterval(() => {\r\n\t\t\t\tthis.countDown = this.countDown - 1\r\n\t\t\t\tif (this.countDown === 0) {\r\n\t\t\t\t\tclearInterval(time)\r\n\t\t\t\t\tthis.countDown = 30\r\n\t\t\t\t}\r\n\t\t\t}, 1000)\r\n\t\t},\r\n\t\t// 刷新\r\n\t\tonRefresh(value) {\r\n\t\t\tthis.trendDataChange()\r\n\t\t\tthis.refreshCountDown()\r\n\t\t}\r\n\t}\r\n}\r\n",null]}