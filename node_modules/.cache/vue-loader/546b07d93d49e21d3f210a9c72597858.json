{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\defaultrole\\components\\EditRole.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\defaultrole\\components\\EditRole.vue","mtime":1616384580042},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { message } from '@/utils/message'\r\nimport { generateTitle } from '@/utils/i18n'\r\n\r\nexport default {\r\n\tname: 'Editrole',\r\n\tprops: {\r\n\t\t// 0为线路商模板配置 1为普通商户模板配置 2为默认角色配置\r\n\t\ttype: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 0\r\n\t\t},\r\n\t\tdrawer: Boolean,\r\n\t\tpermissions: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\tassignedPermissions: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\troledata: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: function() {\r\n\t\t\t\treturn {}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\ttransferKey: 0,\r\n\t\t\telDrawer: false,\r\n\t\t\tcheckedAll: false,\r\n\t\t\tcheckedKeys: [],\r\n\t\t\tps: [],\r\n\t\t\tform: {\r\n\t\t\t\troleName: '',\r\n\t\t\t\tremark: ''\r\n\t\t\t},\r\n\t\t\tdirection: 'ttb'\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\tdefaultProps() {\r\n\t\t\treturn {\r\n\t\t\t\tlabel: (data) => {\r\n\t\t\t\t\treturn generateTitle(data.permissionName)\r\n\t\t\t\t},\r\n\t\t\t\tchildren: 'children'\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\tdrawer(val) {\r\n\t\t\tthis.elDrawer = val\r\n\t\t},\r\n\t\troledata: {\r\n\t\t\thandler(newVal, old) {\r\n\t\t\t\tif (newVal.id) {\r\n\t\t\t\t\tthis.form = { ...newVal }\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.resetForm()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdeep: true\r\n\t\t},\r\n\t\tpermissions: {\r\n\t\t\thandler(newVal, oldVal) {\r\n\t\t\t\tif (newVal) {\r\n\t\t\t\t\tthis.ps = newVal\r\n\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t// 叶子节点平铺\r\n\t\t\t\t\t\tconst doms =\r\n\t\t\t\t\t\t\tdocument.querySelectorAll('.el-tree-node__content > .is-leaf') || []\r\n\t\t\t\t\t\tdoms.length !== 0 &&\r\n\t\t\t\t\t\t\tdoms.forEach((node) => {\r\n\t\t\t\t\t\t\t\tnode.parentNode.classList.add('tile')\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\tthis.checkIfAllChecked()\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdeep: true\r\n\t\t},\r\n\t\tassignedPermissions: {\r\n\t\t\thandler(newVal, oldVal) {\r\n\t\t\t\tif (newVal.length && newVal.length > 0) {\r\n\t\t\t\t\tthis.$refs.editRoleTree && this.$refs.editRoleTree.setCheckedKeys(newVal)\r\n\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\tthis.checkIfAllChecked()\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdeep: true\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tcheckIfAllChecked() {\r\n\t\t\tlet arr = this.filterPS(this.ps)\r\n\t\t\tarr = arr.filter((val) => !String(val.id).includes('list'))\r\n\t\t\tif (arr.length <= this.assignedPermissions.length) {\r\n\t\t\t\tthis.checkedAll = true\r\n\t\t\t} else {\r\n\t\t\t\tthis.checkedAll = false\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 点击复选框判断是否全选\r\n\t\tclickIfAllChecked(checkedKeys) {\r\n\t\t\tconst arr = this.filterPS(this.ps)\r\n\t\t\tif (arr.length === checkedKeys.length) {\r\n\t\t\t\tthis.checkedAll = true\r\n\t\t\t} else {\r\n\t\t\t\tthis.checkedAll = false\r\n\t\t\t}\r\n\t\t},\r\n\t\tcheckAllChange(val) {\r\n\t\t\tif (val) {\r\n\t\t\t\tthis.selectAll()\r\n\t\t\t} else {\r\n\t\t\t\tthis.resetTree()\r\n\t\t\t}\r\n\t\t},\r\n\t\tcheck(data, obj) {\r\n\t\t\tif (!obj.checkedKeys.includes(data.id) && String(data.id).includes('list')) {\r\n\t\t\t\tthis.$refs.editRoleTree.setChecked(data.parentId, false, true)\r\n\t\t\t}\r\n\t\t\tif (obj.checkedKeys.includes(data.id)) {\r\n\t\t\t\tthis.$refs.editRoleTree.setChecked(`list${data.parentId}`, true)\r\n\t\t\t}\r\n\t\t\tthis.clickIfAllChecked(obj.checkedKeys)\r\n\t\t},\r\n\t\tselectAll() {\r\n\t\t\tif (this.$refs.editRoleTree) this.$refs.editRoleTree.setCheckedNodes(this.ps)\r\n\t\t},\r\n\t\tresetTree() {\r\n\t\t\tif (this.$refs.editRoleTree) this.$refs.editRoleTree.setCheckedNodes([])\r\n\t\t},\r\n\t\tfilterPS(ps) {\r\n\t\t\tconst list = []\r\n\t\t\tconst getList = function(ps) {\r\n\t\t\t\tps.forEach((item) => {\r\n\t\t\t\t\tif (item.children) {\r\n\t\t\t\t\t\tlist.push(item)\r\n\t\t\t\t\t\tgetList(item.children)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlist.push(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tgetList(ps)\r\n\t\t\treturn list\r\n\t\t},\r\n\t\tresetForm() {\r\n\t\t\tthis.form = {}\r\n\t\t\tthis.checkedAll = false\r\n\t\t\tthis.resetTree()\r\n\t\t},\r\n\t\thandleSure() {\r\n\t\t\tlet permissionKeys = []\r\n\t\t\tconst keys = this.$refs.editRoleTree.getCheckedKeys() || []\r\n\t\t\tconst halfKeys = this.$refs.editRoleTree.getHalfCheckedKeys() || []\r\n\t\t\tpermissionKeys = keys.concat(halfKeys)\r\n\t\t\t// 过滤掉id为'list'的值\r\n\t\t\tpermissionKeys = permissionKeys.filter(\r\n\t\t\t\t(element) => !String(element).includes('list')\r\n\t\t\t)\r\n\t\t\tthis.$refs.form.validate((valid) => {\r\n\t\t\t\tif (valid) {\r\n\t\t\t\t\tif (keys.length === 0) {\r\n\t\t\t\t\t\tthis.$message.error(this.$t('systemmanagement.systemmanagement_102'))\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 获取参数\r\n\t\t\t\t\tconsole.log(this.form)\r\n\t\t\t\t\tlet form = {\r\n\t\t\t\t\t\tpermissionIds: permissionKeys,\r\n\t\t\t\t\t\tid: this.form.id,\r\n\t\t\t\t\t\tsystemType: this.form.systemType\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst api =\r\n\t\t\t\t\t\tthis.type === 0\r\n\t\t\t\t\t\t\t? 'updateLineAgentTemplateConfig'\r\n\t\t\t\t\t\t\t: this.type === 1\r\n\t\t\t\t\t\t\t? 'updateAgentTemplateConfig'\r\n\t\t\t\t\t\t\t: 'updateAgentAdminUserConfig'\r\n\t\t\t\t\tif (this.type === 2) {\r\n\t\t\t\t\t\tform = {\r\n\t\t\t\t\t\t\tuserId: this.form.userId,\r\n\t\t\t\t\t\t\tagentCode: this.form.agentCode,\r\n\t\t\t\t\t\t\tpermissionIds: permissionKeys,\r\n\t\t\t\t\t\t\tsystemType: this.form.systemType\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst loading = this.$loading({\r\n\t\t\t\t\t\tlock: true,\r\n\t\t\t\t\t\ttext: 'Loading',\r\n\t\t\t\t\t\tspinner: 'el-icon-loading',\r\n\t\t\t\t\t\tbackground: 'rgba(0, 0, 0, 0.7)'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.$api[api](form)\r\n\t\t\t\t\t\t.then((res) => {\r\n\t\t\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\t\t\tloading.close()\r\n\t\t\t\t\t\t\t\tconst messageText =\r\n\t\t\t\t\t\t\t\t\tthis.type === 0\r\n\t\t\t\t\t\t\t\t\t\t? this.$t('authoritymanagement_defaultrole_components_editrole_214')\r\n\t\t\t\t\t\t\t\t\t\t: this.type === 1\r\n\t\t\t\t\t\t\t\t\t\t? this.$t('authoritymanagement_defaultrole_components_editrole_215')\r\n\t\t\t\t\t\t\t\t\t\t: this.$t('authoritymanagement_defaultrole_components_editrole_216', [\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.roledata.agentName\r\n\t\t\t\t\t\t\t\t\t\t  ])\r\n\t\t\t\t\t\t\t\tthis.resetDialog()\r\n\t\t\t\t\t\t\t\tthis.$emit('update:drawer', false)\r\n\t\t\t\t\t\t\t\treturn message({\r\n\t\t\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\t\t\tmessage: this.$t(\r\n\t\t\t\t\t\t\t\t\t\t'authoritymanagement_defaultrole_components_editrole_217',\r\n\t\t\t\t\t\t\t\t\t\t[messageText]\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tloading.close()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch(() => {\r\n\t\t\t\t\t\t\tloading.close()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\thandleClose() {\r\n\t\t\tthis.resetDialog()\r\n\t\t\tthis.$emit('update:drawer', false)\r\n\t\t},\r\n\t\tresetDialog() {\r\n\t\t\tthis.transferKey = +new Date()\r\n\t\t},\r\n\t\tfilterRoleName() {\r\n\t\t\treturn this.$t('other_010')\r\n\t\t},\r\n\t\tfilterRemark() {\r\n\t\t\treturn this.$t('other_011')\r\n\t\t}\r\n\t}\r\n}\r\n",null]}