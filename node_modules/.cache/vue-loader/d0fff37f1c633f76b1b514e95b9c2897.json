{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\components\\MerchantSelector\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\components\\MerchantSelector\\index.vue","mtime":1617594855289},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBTdG9yZU1peGluIH0gZnJvbSAnQC9jb3JlL21peGlucycNCmltcG9ydCB7IGdldE1lcmNoYW50VHJlZSwgZ2V0TWVyY2hhbnRSb290VHJlZSB9IGZyb20gJ0AvYXBpL21lcmNoYW50L2xpc3QnDQpleHBvcnQgZGVmYXVsdCB7DQogIHByb3BzOiB7DQogICAgZ2FtZVR5cGU6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICB9LA0KICAgIGZvclBhcmVudDogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgIH0sDQogICAgYWxsb3dDbGVhcjogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgIH0sDQogICAgdmFsdWU6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICB9LA0KICAgIGFwaTogew0KICAgICAgdHlwZTogRnVuY3Rpb24sDQogICAgICBkZWZhdWx0OiBnZXRNZXJjaGFudFRyZWUsDQogICAgfSwNCiAgICBxdWVyeTogew0KICAgICAgdHlwZTogT2JqZWN0LA0KICAgICAgZGVmYXVsdDogKCkgPT4gKHt9KSwNCiAgICB9LA0KICAgIHBsYWNlaG9sZGVyOiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgICBkZWZhdWx0OiAn6L6T5YWl5ZWG5oi35ZCN56ew5oiW5LiL5ouJ6YCJ5oupJywNCiAgICB9LA0KICB9LA0KICBtaXhpbnM6IFtTdG9yZU1peGluXSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgdHJlZURhdGE6IFtdLA0KICAgICAgc2VsZWN0ZWRWYWx1ZTogdW5kZWZpbmVkLA0KICAgIH0NCiAgfSwNCiAgY3JlYXRlZCgpIHsNCiAgICB0aGlzLmxvYWREYXRhKHRydWUpDQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgZXh0cmFQcm9wcygpIHsNCiAgICAgIGxldCBkZWZhdWx0RXhwYW5kZWRLZXlzID0ge30NCiAgICAgIGlmICh0aGlzLnRyZWVEYXRhLmxlbmd0aCA+IDApIHsNCiAgICAgICAgZGVmYXVsdEV4cGFuZGVkS2V5cyA9IHsgdHJlZURlZmF1bHRFeHBhbmRlZEtleXM6IFt0aGlzLnRyZWVEYXRhWzBdLnVuaXRlTWVyTnVtXSB9DQogICAgICB9DQogICAgICByZXR1cm4geyAuLi50aGlzLiRhdHRycywgLi4uZGVmYXVsdEV4cGFuZGVkS2V5cyB9DQogICAgfSwNCiAgICB1c2VDYWNoZSgpIHsNCiAgICAgIHJldHVybiAhKHRoaXMucXVlcnkgJiYgdGhpcy5mb3JQYXJlbnQpDQogICAgfSwNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIGNoYW5nZTogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICB0aGlzLnNlbGVjdGVkVmFsdWUgPSB2YWx1ZQ0KICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB2YWx1ZSkNCiAgICB9LA0KICAgIGxvYWREYXRhKGluaXQpIHsNCiAgICAgIGlmIChpbml0ICYmIHRoaXMudXNlQ2FjaGUgJiYgdGhpcy5nZXRVc2VySW5mbygnbWVyY2hhbnRzJykpIHsNCiAgICAgICAgdGhpcy50cmVlRGF0YSA9IHRoaXMuZ2V0VXNlckluZm8oJ21lcmNoYW50cycpDQogICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoaW5pdCkNCiAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB0aGlzLnNlbGVjdGVkVmFsdWUpDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgbGV0IHBhcmFtID0geyAuLi50aGlzLnF1ZXJ5IH0NCiAgICAgIGlmICh0aGlzLmdhbWVUeXBlKSB7DQogICAgICAgIHBhcmFtID0geyBkYXRhU291cmNlczogdGhpcy5nYW1lVHlwZSwgLi4ucGFyYW0gfQ0KICAgICAgfQ0KICAgICAgbGV0IHJlcXVlc3QgPSB0aGlzLmFwaQ0KICAgICAgaWYgKHRoaXMuZm9yUGFyZW50KSB7DQogICAgICAgIHJlcXVlc3QgPSBnZXRNZXJjaGFudFJvb3RUcmVlDQogICAgICB9DQogICAgICByZXF1ZXN0KHBhcmFtKS50aGVuKChyZXMpID0+IHsNCiAgICAgICAgdGhpcy50cmVlRGF0YSA9IHJlcy5kYXRhIHx8IFtdDQogICAgICAgIGlmICh0aGlzLnVzZUNhY2hlKSB7DQogICAgICAgICAgdGhpcy5zZXRVc2VySW5mbygnbWVyY2hhbnRzJywgdGhpcy50cmVlRGF0YSkNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnNlbGVjdGVkVmFsdWUgPSB0aGlzLmdldFZhbHVlKGluaXQpDQogICAgICAgIHRoaXMuJGVtaXQoJ2lucHV0JywgdGhpcy5zZWxlY3RlZFZhbHVlKQ0KICAgICAgfSkNCiAgICB9LA0KICAgIGdldFZhbHVlKGluaXQpIHsNCiAgICAgIGlmIChpbml0KSB7DQogICAgICAgIHJldHVybiB0aGlzLnZhbHVlDQogICAgICB9DQogICAgICBpZiAodGhpcy50cmVlRGF0YS5zb21lKCh2KSA9PiB2LnVuaXRlTWVyTnVtID09IHRoaXMudmFsdWUpKSB7DQogICAgICAgIHJldHVybiB0aGlzLnZhbHVlDQogICAgICB9DQogICAgICByZXR1cm4gdW5kZWZpbmVkDQogICAgfSwNCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICB2YWx1ZSh2YWwpIHsNCiAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZSA9IHZhbA0KICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB2YWwpDQogICAgfSwNCiAgfSwNCn0NCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAkBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/MerchantSelector","sourcesContent":["<template>\r\n  <a-tree-select\r\n    v-bind=\"extraProps\"\r\n    style=\"width: 100%\"\r\n    :dropdown-style=\"{ maxHeight: '400px', overflow: 'auto' }\"\r\n    :tree-data=\"treeData\"\r\n    :value=\"selectedValue\"\r\n    :allowClear=\"allowClear\"\r\n    show-search\r\n    treeNodeFilterProp=\"title\"\r\n    :placeholder=\"placeholder\"\r\n    :replaceFields=\"{ children: 'childList', key: 'uniteMerNum', value: 'uniteMerNum', title: 'uniteMerName' }\"\r\n    @change=\"change\"\r\n  >\r\n  </a-tree-select>\r\n</template>\r\n\r\n<script>\r\nimport { StoreMixin } from '@/core/mixins'\r\nimport { getMerchantTree, getMerchantRootTree } from '@/api/merchant/list'\r\nexport default {\r\n  props: {\r\n    gameType: {\r\n      type: String,\r\n    },\r\n    forParent: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    allowClear: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    value: {\r\n      type: String,\r\n    },\r\n    api: {\r\n      type: Function,\r\n      default: getMerchantTree,\r\n    },\r\n    query: {\r\n      type: Object,\r\n      default: () => ({}),\r\n    },\r\n    placeholder: {\r\n      type: String,\r\n      default: '输入商户名称或下拉选择',\r\n    },\r\n  },\r\n  mixins: [StoreMixin],\r\n  data() {\r\n    return {\r\n      treeData: [],\r\n      selectedValue: undefined,\r\n    }\r\n  },\r\n  created() {\r\n    this.loadData(true)\r\n  },\r\n  computed: {\r\n    extraProps() {\r\n      let defaultExpandedKeys = {}\r\n      if (this.treeData.length > 0) {\r\n        defaultExpandedKeys = { treeDefaultExpandedKeys: [this.treeData[0].uniteMerNum] }\r\n      }\r\n      return { ...this.$attrs, ...defaultExpandedKeys }\r\n    },\r\n    useCache() {\r\n      return !(this.query && this.forParent)\r\n    },\r\n  },\r\n  methods: {\r\n    change: function (value) {\r\n      this.selectedValue = value\r\n      this.$emit('input', value)\r\n    },\r\n    loadData(init) {\r\n      if (init && this.useCache && this.getUserInfo('merchants')) {\r\n        this.treeData = this.getUserInfo('merchants')\r\n        this.selectedValue = this.getValue(init)\r\n        this.$emit('input', this.selectedValue)\r\n        return\r\n      }\r\n      let param = { ...this.query }\r\n      if (this.gameType) {\r\n        param = { dataSources: this.gameType, ...param }\r\n      }\r\n      let request = this.api\r\n      if (this.forParent) {\r\n        request = getMerchantRootTree\r\n      }\r\n      request(param).then((res) => {\r\n        this.treeData = res.data || []\r\n        if (this.useCache) {\r\n          this.setUserInfo('merchants', this.treeData)\r\n        }\r\n        this.selectedValue = this.getValue(init)\r\n        this.$emit('input', this.selectedValue)\r\n      })\r\n    },\r\n    getValue(init) {\r\n      if (init) {\r\n        return this.value\r\n      }\r\n      if (this.treeData.some((v) => v.uniteMerNum == this.value)) {\r\n        return this.value\r\n      }\r\n      return undefined\r\n    },\r\n  },\r\n  watch: {\r\n    value(val) {\r\n      this.selectedValue = val\r\n      this.$emit('input', val)\r\n    },\r\n  },\r\n}\r\n</script>"]}]}