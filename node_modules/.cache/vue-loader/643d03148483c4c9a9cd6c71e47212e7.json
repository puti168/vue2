{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\usermanage\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\authoritymanagement\\usermanage\\index.vue","mtime":1617695097410},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { mapGetters } from 'vuex'\r\nimport list from '@/mixins/list'\r\nimport EditUser from './components/EditUser'\r\nimport UserDetail from './components/UserDetail'\r\nimport { validPassword } from '@/utils/validate'\r\nimport { routerNames } from '@/utils/consts'\r\nimport { message } from '@/utils/message'\r\nimport { i18nRoute } from '@/utils/i18n'\r\n\r\nexport default {\r\n\tname: routerNames.systemUser,\r\n\tcomponents: { EditUser, UserDetail },\r\n\tmixins: [list],\r\n\tdata() {\r\n\t\tconst validatePwd = (rule, value, callback) => {\r\n\t\t\tif (value === '') {\r\n\t\t\t\tcallback(new Error(this.$t('systemmanagement.systemmanagement_126')))\r\n\t\t\t} else if (!validPassword(value)) {\r\n\t\t\t\tcallback(new Error(this.$t('systemmanagement.systemmanagement_127')))\r\n\t\t\t} else {\r\n\t\t\t\tcallback()\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst validateRepwd = (rule, value, callback) => {\r\n\t\t\tif (value === '') {\r\n\t\t\t\tcallback(new Error(this.$t('systemmanagement.systemmanagement_128')))\r\n\t\t\t} else if (!validPassword(value)) {\r\n\t\t\t\tcallback(new Error(this.$t('systemmanagement.systemmanagement_127')))\r\n\t\t\t} else if (value !== this.passDialogForm.pwd) {\r\n\t\t\t\tcallback(new Error(this.$t('systemmanagement.systemmanagement_129')))\r\n\t\t\t} else {\r\n\t\t\t\tcallback()\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\thadSearch: false,\r\n\t\t\tloading: false,\r\n\t\t\tpassDialogForm: {\r\n\t\t\t\tuserId: '',\r\n\t\t\t\tpwd: '',\r\n\t\t\t\trePwd: ''\r\n\t\t\t},\r\n\t\t\tpassDialogFormRules: {\r\n\t\t\t\tpwd: [{ required: true, validator: validatePwd, trigger: 'blur' }],\r\n\t\t\t\trePwd: [{ required: true, validator: validateRepwd, trigger: 'blur' }]\r\n\t\t\t},\r\n\t\t\teditType: 1, // 新建为1 ,用户授权为2, 3为修改密码\r\n\t\t\tdrawer: false,\r\n\t\t\tform: {\r\n\t\t\t\tusername: '',\r\n\t\t\t\trole: '',\r\n\t\t\t\tstatus: -1,\r\n\t\t\t\tsystemType: -1\r\n\t\t\t},\r\n\t\t\tuserData: {},\r\n\t\t\troleList: [],\r\n\t\t\tuserRole: [],\r\n\t\t\tlist: [],\r\n\t\t\tdialogVisible: false,\r\n\t\t\tcurrentData: {},\r\n\t\t\tcurrentIndex: -1,\r\n\t\t\tremark: '',\r\n\t\t\tcurrentRow: {},\r\n\t\t\tdetailDrawer: false,\r\n\t\t\tdetailPermissions: []\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['name']),\r\n\t\t...mapGetters(['buttonPermissions']),\r\n\t\t...mapGetters(['userInfo'])\r\n\t},\r\n\tcreated() {\r\n\t\tthis.loadRoleList()\r\n\t},\r\n\tactivated() {\r\n\t\tthis.getUserDetail()\r\n\t},\r\n\tmethods: {\r\n\t\tloadData() {\r\n\t\t\tthis.loading = true\r\n\r\n\t\t\tconst form = {\r\n\t\t\t\tpageSize: this.pageSize,\r\n\t\t\t\tpageIndex: this.pageIndex,\r\n\t\t\t\tsystemType: this.form.systemType,\r\n\t\t\t\troleId: this.form.role,\r\n\t\t\t\tstatus: this.form.status,\r\n\t\t\t\tuserName: this.form.username && this.form.username.replace(/\\s+/g, '')\r\n\t\t\t}\r\n\r\n\t\t\tthis.$api\r\n\t\t\t\t.merchantUserList(form)\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tthis.list = _.data.userList\r\n\t\t\t\t\t\tthis.total = _.data.totalRecord\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t})\r\n\t\t},\r\n\t\thandleCurrentChange(val) {\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\thandleReset() {\r\n\t\t\tthis.form = {\r\n\t\t\t\tusername: '',\r\n\t\t\t\trole: '',\r\n\t\t\t\tstatus: -1,\r\n\t\t\t\tsystemType: -1\r\n\t\t\t}\r\n\t\t\tthis.pageIndex = 1\r\n\t\t\tthis.hadSearch = false\r\n\t\t\tthis.initList()\r\n\t\t},\r\n\t\thandleSearch() {\r\n\t\t\tthis.hadSearch = true\r\n\t\t\tthis.pageIndex = 1\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\t// 获取角色的所有可操作权限\r\n\t\tloadRoleList() {\r\n\t\t\tthis.$api.merchantUserRoleList().then((_) => {\r\n\t\t\t\tthis.roleList = this.filterRoleList(_.data) || []\r\n\t\t\t})\r\n\t\t},\r\n\t\tfilterRoleList(lists) {\r\n\t\t\treturn (\r\n\t\t\t\tlists &&\r\n\t\t\t\tlists.map((item) => {\r\n\t\t\t\t\titem.label = item.roleName\r\n\t\t\t\t\titem.key = item.id\r\n\t\t\t\t\treturn item\r\n\t\t\t\t})\r\n\t\t\t)\r\n\t\t},\r\n\t\tswitchChange(val, row) {\r\n\t\t\tconst params = {\r\n\t\t\t\tuserId: row.id,\r\n\t\t\t\tstatus: val ? '1' : '0'\r\n\t\t\t}\r\n\t\t\tthis.$api.merchantModifyUserStatus(params).then((res) => {\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tconst index = this.list.findIndex((val) => val.id === row.id)\r\n\t\t\t\t\tthis.list[index].status = params.status\r\n\t\t\t\t\tconst statusText =\r\n\t\t\t\t\t\tparams.status === '1'\r\n\t\t\t\t\t\t\t? this.$t('authoritymanagement_usermanage_index_328')\r\n\t\t\t\t\t\t\t: this.$t('authoritymanagement_usermanage_index_327')\r\n\t\t\t\t\treturn message({\r\n\t\t\t\t\t\tmessage: this.$t('authoritymanagement_usermanage_index_342', [\r\n\t\t\t\t\t\t\trow.userName,\r\n\t\t\t\t\t\t\tstatusText\r\n\t\t\t\t\t\t]),\r\n\t\t\t\t\t\ttype: 'success'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tlockEvent(row) {\r\n\t\t\tconst params = {\r\n\t\t\t\tuserId: row.id\r\n\t\t\t}\r\n\t\t\tthis.$api.modifyLockStatus(params).then((res) => {\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tthis.loadData()\r\n\t\t\t\t\treturn message({\r\n\t\t\t\t\t\tmessage: this.$t('authoritymanagement_usermanage_index_343', [\r\n\t\t\t\t\t\t\trow.userName\r\n\t\t\t\t\t\t]),\r\n\t\t\t\t\t\ttype: 'success'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\teditRow(index, row) {\r\n\t\t\tthis.editType = 2\r\n\t\t\tthis.drawer = true\r\n\t\t\tthis.currentRow = row\r\n\t\t\tthis.getUserDetail()\r\n\t\t},\r\n\t\tdetailRow(index, row) {\r\n\t\t\tthis.roleData = { ...row }\r\n\t\t\tthis.detailDrawer = true\r\n\t\t\tthis.$api.getUserPermissions({ searchId: row.id }).then((res) => {\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tthis.detailPermissions = res.data || []\r\n\t\t\t\t\t// 增加查看权限，相当于菜单，这个是前端增加的，为了这个tree组件兼容，提交的时候需要过滤掉id为'list'的值\r\n\t\t\t\t\tthis.detailPermissions.forEach((element) => {\r\n\t\t\t\t\t\tif (element.children && element.children.length !== 0) {\r\n\t\t\t\t\t\t\telement.children.forEach((childElement) => {\r\n\t\t\t\t\t\t\t\tchildElement.children = childElement.children || []\r\n\t\t\t\t\t\t\t\tchildElement.children.unshift({\r\n\t\t\t\t\t\t\t\t\tchildren: null,\r\n\t\t\t\t\t\t\t\t\tid: 'list' + childElement.id,\r\n\t\t\t\t\t\t\t\t\tisExist: null,\r\n\t\t\t\t\t\t\t\t\tparentId: childElement.id,\r\n\t\t\t\t\t\t\t\t\tpath: childElement,\r\n\t\t\t\t\t\t\t\t\tpermissionName: 'view',\r\n\t\t\t\t\t\t\t\t\ttype: 1\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.loopPermission(this.detailPermissions)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\ttype: 'error',\r\n\t\t\t\t\t\tmessage: this.$t('systemmanagement.systemmanagement_111')\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tloopPermission(datas) {\r\n\t\t\tdatas.forEach((i) => {\r\n\t\t\t\ti.permissionName = i18nRoute(i.permissionName)\r\n\t\t\t\tif (i.children && i.children.length !== 0) {\r\n\t\t\t\t\tthis.loopPermission(i.children)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tgetUserDetail() {\r\n\t\t\tif (this.currentRow.id) {\r\n\t\t\t\tthis.$api.merchantGetUserDetail({ id: this.currentRow.id }).then((_) => {\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tthis.userData = _.data\r\n\t\t\t\t\t\tthis.userRole = _.data.userRole || []\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\teditPass(row) {\r\n\t\t\tthis.drawer = true\r\n\t\t\tthis.editType = 3\r\n\t\t\tthis.userData = { ...row }\r\n\t\t\tthis.passDialogForm.userName = row.userName\r\n\t\t\tthis.passDialogForm.userId = row.id\r\n\t\t},\r\n\t\thandleNewUser() {\r\n\t\t\tthis.drawer = true\r\n\t\t\tthis.editType = 1\r\n\t\t\tthis.userData = {\r\n\t\t\t\tuserName: '',\r\n\t\t\t\tgoogleAuthCode: ''\r\n\t\t\t}\r\n\t\t\tthis.userRole = []\r\n\t\t},\r\n\t\teditCallBack() {\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\thandleSure() {\r\n\t\t\tconst data = {\r\n\t\t\t\tuserName: this.currentData.userName,\r\n\t\t\t\tuserId: this.currentData.id,\r\n\t\t\t\tstatus: this.currentData.switchStatus ? 1 : 0,\r\n\t\t\t\tremark: this.remark || ''\r\n\t\t\t}\r\n\t\t\tthis.$api.merchantModifyUserStatus(data).then((_) => {\r\n\t\t\t\t// 静态更新状态\r\n\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\tthis.loadData()\r\n\t\t\t\t\tthis.dialogVisible = false\r\n\t\t\t\t\tthis.remark = ''\r\n\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\tmessage: this.$t('systemmanagement.systemmanagement_39')\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tcloseDetail() {\r\n\t\t\tthis.detailDrawer = false\r\n\t\t}\r\n\t}\r\n}\r\n",null]}