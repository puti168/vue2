{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\merchant\\dailyratedeal\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\merchant\\dailyratedeal\\index.vue","mtime":1617695097422},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport list from '@/mixins/list'\r\nimport tier from '@/mixins/tier'\r\nimport { mapGetters } from 'vuex'\r\nimport dayjs from 'dayjs'\r\nimport { routerNames } from '@/utils/consts'\r\nimport SelectAgentTreeEdit from '@/components/SelectAgentTreeEdit'\r\nimport router from '@/router'\r\n\r\nexport default {\r\n\tname: routerNames.dailyratedeal,\r\n\tcomponents: { SelectAgentTreeEdit },\r\n\tmixins: [list, tier],\r\n\tdata() {\r\n\t\tconst end = dayjs()\r\n\t\t\t.endOf('day')\r\n\t\t\t.subtract(1, 'd')\r\n\t\t\t.valueOf()\r\n\t\tconst start = dayjs()\r\n\t\t\t.subtract(1, 'd')\r\n\t\t\t.startOf('month')\r\n\t\t\t.valueOf()\r\n\t\treturn {\r\n\t\t\ttimestamp: Date.now(),\r\n\t\t\thadSearch: false,\r\n\t\t\tloading: false,\r\n\t\t\tcanDownload: true,\r\n\t\t\tcanNoticeTotal: true,\r\n\t\t\tcanNoticeTime: true,\r\n\t\t\tform: {\r\n\t\t\t\ttime: [start, end],\r\n\t\t\t\tagentId: ''\r\n\t\t\t},\r\n\t\t\torder: '',\r\n\t\t\torderProp: '',\r\n\t\t\ttableLists: [{}],\r\n\t\t\tlevels: [],\r\n\t\t\tshowDetail: false,\r\n\t\t\tsummary: {},\r\n\t\t\ttableDetail: [],\r\n\t\t\tcurrentRow: {},\r\n\t\t\tcurrencyList: [],\r\n\t\t\tsaveAgentId: ''\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['globalDics', 'agentId', 'userInfo']),\r\n\t\ttrantype() {\r\n\t\t\treturn this.globalDics.trantype\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tloadData() {\r\n\t\t\tthis.loading = true\r\n\r\n\t\t\t// this.loadCurrenyDate()\r\n\r\n\t\t\tif (this.$route.query && JSON.stringify(this.$route.query) !== '{}') {\r\n\t\t\t\tconst query = this.$route.query || {}\r\n\t\t\t\tthis.saveAgentId = query.agentId\r\n\t\t\t\tthis.form = {\r\n\t\t\t\t\tagentId: query.agentId,\r\n\t\t\t\t\ttime: JSON.parse(query.time)\r\n\t\t\t\t}\r\n\t\t\t\trouter.push(this.$route.path)\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tthis.timestamp = Date.now()\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tthis.loadDetail()\r\n\t\t\tthis.loadSummary()\r\n\t\t},\r\n\t\tsortChange(val) {\r\n\t\t\tthis.loading = true\r\n\t\t\tconst { order } = val\r\n\t\t\tthis.form.order = order\r\n\t\t\tthis.loadDetail()\r\n\t\t},\r\n\t\tloadDetail() {\r\n\t\t\tconst form = {\r\n\t\t\t\tpageSize: this.pageSize,\r\n\t\t\t\tpageIndex: this.pageIndex,\r\n\t\t\t\tsearchAgentId: this.form.agentId ? this.form.agentId : this.agentId,\r\n\t\t\t\tstartTime: this.form.time[0],\r\n\t\t\t\tendTime: this.form.time[1],\r\n\t\t\t\torder: this.form.order\r\n\t\t\t}\r\n\r\n\t\t\tthis.$api\r\n\t\t\t\t.apiAccountReportDetail(form)\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tconst { data } = _\r\n\t\t\t\t\t\tthis.tableDetail = data.record\r\n\t\t\t\t\t\tthis.total = data.totalRecord\r\n\t\t\t\t\t\tconsole.log('this.tableDetail :>> ', this.tableDetail)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t})\r\n\t\t\t\t.catch((err) => {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t},\r\n\t\tloadSummary() {\r\n\t\t\tconst pageData = {\r\n\t\t\t\tpageSize: this.pageSize,\r\n\t\t\t\tpageIndex: this.pageIndex,\r\n\t\t\t\tsearchAgentId: this.form.agentId,\r\n\t\t\t\tstartTime: this.form.time[0],\r\n\t\t\t\tendTime: this.form.time[1],\r\n\t\t\t\ttype: 1\r\n\t\t\t}\r\n\r\n\t\t\tthis.$api\r\n\t\t\t\t.apiAccountReport(pageData)\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tconst { data } = _\r\n\t\t\t\t\t\tthis.summary = data.record[0]\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t})\r\n\t\t},\r\n\t\t/**\r\n\t\t * actType 1为增加 2为修改\r\n\t\t */\r\n\t\tmodifyData(level, params, tableIndex, actType) {\r\n\t\t\tconst extraParams = {\r\n\t\t\t\tstartTime: this.form.time[0],\r\n\t\t\t\tendTime: this.form.time[1],\r\n\t\t\t\tsearchAgentId: params.agentId\r\n\t\t\t}\r\n\t\t\tthis.mixinModifyData(\r\n\t\t\t\tlevel,\r\n\t\t\t\tparams,\r\n\t\t\t\ttableIndex,\r\n\t\t\t\tactType,\r\n\t\t\t\t'apiAccountReport',\r\n\t\t\t\textraParams\r\n\t\t\t)\r\n\t\t},\r\n\t\thandleSearch2() {\r\n\t\t\tthis.pageIndex = 1\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\thandleReset() {\r\n\t\t\tif (this.$route.query && JSON.stringify(this.$route.query) !== '{}') {\r\n\t\t\t\trouter.push(this.$route.path, () => {\r\n\t\t\t\t\tthis.resetCommon()\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tthis.resetCommon()\r\n\t\t\t}\r\n\t\t},\r\n\t\tresetCommon() {\r\n\t\t\tconst end = dayjs()\r\n\t\t\t\t.endOf('day')\r\n\t\t\t\t.subtract(1, 'd')\r\n\t\t\t\t.valueOf()\r\n\t\t\tconst start = dayjs()\r\n\t\t\t\t.subtract(1, 'd')\r\n\t\t\t\t.startOf('month')\r\n\t\t\t\t.valueOf()\r\n\t\t\tthis.hadSearch = false\r\n\t\t\tthis.form = {\r\n\t\t\t\ttime: [start, end],\r\n\t\t\t\tagentId: this.saveAgentId\r\n\t\t\t}\r\n\t\t\t// this.timestamp = Date.now()\r\n\t\t\tthis.levels = []\r\n\t\t\tthis.initList()\r\n\t\t},\r\n\t\tcheckRecord(row) {\r\n\t\t\tthis.$store.dispatch('tagsView/delView', {\r\n\t\t\t\tname: routerNames.dotaccount\r\n\t\t\t})\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tconst targetUrl = '/merchant/dotaccount'\r\n\r\n\t\t\t\trouter.push(`${targetUrl}?agentId=${row.agentId}&accountType=1`)\r\n\t\t\t})\r\n\t\t},\r\n\t\tgetAmoutColor(value) {\r\n\t\t\tif (value > 0) {\r\n\t\t\t\treturn 'green'\r\n\t\t\t} else if (value < 0) {\r\n\t\t\t\treturn 'red'\r\n\t\t\t}\r\n\t\t\treturn ''\r\n\t\t},\r\n\t\tgetSummaries(param) {\r\n\t\t\tconst { columns, data } = param\r\n\t\t\tconst sums = []\r\n\t\t\tcolumns.forEach((column, index) => {\r\n\t\t\t\tif (index === 0) {\r\n\t\t\t\t\tsums[index] = this.$t('merchant_dailyratedeal_index_845')\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tconst values = data.map((item) => Number(item[column.property]))\r\n\t\t\t\tif (\r\n\t\t\t\t\t!values.every((value) => isNaN(value)) &&\r\n\t\t\t\t\t(column.property === 'betAmount' ||\r\n\t\t\t\t\t\tcolumn.property === 'netAmount' ||\r\n\t\t\t\t\t\tcolumn.property === 'payAmount' ||\r\n\t\t\t\t\t\tcolumn.property === 'rebateAmount' ||\r\n\t\t\t\t\t\tcolumn.property === 'payoutAmount' ||\r\n\t\t\t\t\t\tcolumn.property === 'validBetAmount')\r\n\t\t\t\t) {\r\n\t\t\t\t\tsums[index] = this.formatCurrency(\r\n\t\t\t\t\t\tNumber(this.summary[column.property]).toFixed(2)\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\t!values.every((value) => isNaN(value)) &&\r\n\t\t\t\t\tcolumn.property === 'killNumber'\r\n\t\t\t\t) {\r\n\t\t\t\t\tsums[index] =\r\n\t\t\t\t\t\t(Number(this.summary[column.property]) * 100).toFixed(3).slice(0, -1) +\r\n\t\t\t\t\t\t'%'\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\t!values.every((value) => isNaN(value)) &&\r\n\t\t\t\t\t(column.property === 'betCount' || column.property === 'betPlayer')\r\n\t\t\t\t) {\r\n\t\t\t\t\tsums[index] = this.summary[column.property]\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn sums\r\n\t\t},\r\n\t\thandleCurrentChange() {\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\tgoPrev() {\r\n\t\t\trouter.push(`/merchant/ratedeal`)\r\n\t\t},\r\n\t\tloadCurrenyDate() {\r\n\t\t\tthis.$api\r\n\t\t\t\t.getCurrencyComboBoxList({\r\n\t\t\t\t\tpageIndex: 1,\r\n\t\t\t\t\tpageSize: 100\r\n\t\t\t\t})\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tconst data = _.data\r\n\t\t\t\t\tthis.currencyList = data.record\r\n\t\t\t\t})\r\n\t\t},\r\n\t\t// 获取货币类型\r\n\t\tgetCurrency(id) {\r\n\t\t\tconst index = this.currencyList.findIndex((val) => Number(val.id) === id)\r\n\t\t\tif (index > -1) {\r\n\t\t\t\treturn this.currencyList[index].code\r\n\t\t\t}\r\n\t\t},\r\n\t\texportCsv() {\r\n\t\t\tif (Number(this.total) > 20000) {\r\n\t\t\t\tif (this.canNoticeTotal) {\r\n\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\tmessage: this.$t('new_2'),\r\n\t\t\t\t\t\ttype: 'error'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.canNoticeTotal = false\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.canNoticeTotal = true\r\n\t\t\t\t\t}, 3000)\r\n\t\t\t\t}\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (!this.canDownload) {\r\n\t\t\t\tif (this.canNoticeTime) {\r\n\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\tmessage: this.$t('new_1'),\r\n\t\t\t\t\t\ttype: 'error'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.canNoticeTime = false\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.canNoticeTime = true\r\n\t\t\t\t\t}, 3000)\r\n\t\t\t\t}\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tthis.canDownload = false\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.canDownload = true\r\n\t\t\t}, 60000)\r\n\t\t\tconst params = {\r\n\t\t\t\tsearchAgentId: this.form.agentId ? this.form.agentId : this.agentId,\r\n\t\t\t\tstartTime: this.form.time[0],\r\n\t\t\t\tendTime: this.form.time[1],\r\n\t\t\t\ttype: 1,\r\n\t\t\t\torder: this.form.order\r\n\t\t\t}\r\n\t\t\tconst startday = dayjs(params.startTime).get('date')\r\n\t\t\tconst startmonth = dayjs(params.startTime).get('month') + 1\r\n\t\t\tconst endmonth = dayjs(params.endTime).get('month') + 1\r\n\t\t\tconst endday = dayjs(params.endTime).get('date')\r\n\t\t\tconst title =\r\n\t\t\t\tthis.$t('merchant_dailyratedeal_index_819') +\r\n\t\t\t\t'(' +\r\n\t\t\t\tstartmonth +\r\n\t\t\t\tthis.$t('merchant_dailyrateaccount_index_802') +\r\n\t\t\t\tstartday +\r\n\t\t\t\tthis.$t('merchant_dailyrateaccount_index_803') +\r\n\t\t\t\t'-' +\r\n\t\t\t\tendmonth +\r\n\t\t\t\tthis.$t('merchant_dailyrateaccount_index_802') +\r\n\t\t\t\tendday +\r\n\t\t\t\tthis.$t('merchant_dailyrateaccount_index_803') +\r\n\t\t\t\t')'\r\n\t\t\tlocalStorage.setItem('title', title)\r\n\t\t\tthis.$api\r\n\t\t\t\t.apiAccountDetailExport(params)\r\n\t\t\t\t.then((res) => {})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n",null]}