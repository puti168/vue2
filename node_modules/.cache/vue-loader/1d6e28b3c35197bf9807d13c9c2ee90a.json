{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\merchant\\merchantInfo\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\merchant\\merchantInfo\\index.vue","mtime":1617695097426},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport NewBusiness from './components/NewBusiness'\r\nimport EditAccount from './components/EditAccount'\r\nimport KeysManage from './components/KeysManage'\r\nimport EditTrial from './components/EditTrial'\r\nimport Setting from './components/Setting'\r\nimport EditOpen from './components/EditOpen'\r\nimport TableComp from './components/TableComp'\r\nimport SelectAgentTree from '@/components/SelectAgentTree'\r\nimport Modal from '@/components/Modal'\r\nimport list from '@/mixins/list'\r\nimport tier from '@/mixins/tier'\r\nimport { routerNames } from '@/utils/consts'\r\nimport { mapGetters } from 'vuex'\r\n\r\nexport default {\r\n\tname: routerNames.merchantmerchantmanage,\r\n\tcomponents: {\r\n\t\tKeysManage,\r\n\t\tEditAccount,\r\n\t\tNewBusiness,\r\n\t\tEditTrial,\r\n\t\tSetting,\r\n\t\tEditOpen,\r\n\t\tModal,\r\n\t\tSelectAgentTree,\r\n\t\tTableComp\r\n\t},\r\n\tmixins: [list, tier],\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tmodalType: 1, // 1为启用 2位停用 3为重置密码\r\n\t\t\tloading: false,\r\n\t\t\teditAccountVisible: false,\r\n\t\t\tkeysVisible: false,\r\n\t\t\ttrialVisible: false,\r\n\t\t\tshow: true,\r\n\t\t\tsettingVisible: false,\r\n\t\t\topenVisible: false,\r\n\t\t\t// model (integer): 合作模式:1、收益分成+购点，2、收益分成，3、购点 ,\r\n\t\t\tmodel: 2,\r\n\t\t\thasSearch: false,\r\n\t\t\tmerchantData: {},\r\n\t\t\tdrawer: false,\r\n\t\t\tbusinessType: 1, // 新增商户类型\r\n\t\t\tbusinessDrawer: false,\r\n\t\t\tdialogVisible: false,\r\n\t\t\tlockVisible: false,\r\n\t\t\tmd5: {},\r\n\t\t\tform: {\r\n\t\t\t\tagentId: ''\r\n\t\t\t},\r\n\t\t\tdownForm: {\r\n\t\t\t\ttime: [],\r\n\t\t\t\tagentType: -1,\r\n\t\t\t\tstatus: -1,\r\n\t\t\t\tactiveStatus: -1,\r\n\t\t\t\twalletType: '',\r\n\t\t\t\tmerchantType: ''\r\n\t\t\t},\r\n\t\t\tcurrentData: {},\r\n\t\t\topenData: {},\r\n\t\t\tcurrentIndex: -1,\r\n\t\t\tcurrentLevel: 1,\r\n\t\t\t// 商户编码\r\n\t\t\tagentCode: '',\r\n\t\t\t// 谷歌秘钥\r\n\t\t\tgoogleAuthCode: '',\r\n\t\t\tplatformAgent: 1,\r\n\t\t\tagentType: '',\r\n\t\t\tdialogShow: false,\r\n\t\t\tagentsLevel: '',\r\n\t\t\tapiRate: 0,\r\n\t\t\tcountPercentage: 0,\r\n\t\t\tagentId: '',\r\n\t\t\tcurrencyId: '',\r\n\t\t\tcooperationModel: 0,\r\n\t\t\ttopAgent: {},\r\n\t\t\tcurrencyList: [],\r\n\t\t\tcreateLevel: ''\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['userInfo']),\r\n\t\tmodalTitle() {\r\n\t\t\tlet text\r\n\t\t\tswitch (this.modalType) {\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\ttext = this.$t('merchant_merchantinfo_index_1131')\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\ttext = this.$t('merchant_merchantinfo_index_1132')\r\n\t\t\t\t\tbreak\r\n\t\t\t\tdefault:\r\n\t\t\t\t\ttext = this.$t('merchant_merchantinfo_index_1133')\r\n\t\t\t}\r\n\t\t\treturn text\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\tdownForm: {\r\n\t\t\thandler(val) {\r\n\t\t\t\tthis.loadData()\r\n\t\t\t},\r\n\t\t\tdeep: true\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tloadData() {\r\n\t\t\tthis.loading = true\r\n\t\t\tthis.levels = []\r\n\t\t\tconst form = {\r\n\t\t\t\tpageSize: this.pageSize,\r\n\t\t\t\tpageIndex: this.pageIndex,\r\n\t\t\t\tagentId: this.form.agentId,\r\n\t\t\t\ttype: 1\r\n\t\t\t}\r\n\r\n\t\t\tthis.loadCurrenyDate()\r\n\r\n\t\t\tthis.$api\r\n\t\t\t\t.searchAgentList(form)\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tconst data = _.data\r\n\t\t\t\t\t\tthis.total = data.totalRecord\r\n\t\t\t\t\t\tconst list = data.record\r\n\t\t\t\t\t\tthis.topAgent = list[0]\r\n\t\t\t\t\t\tthis.tableLists = [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\topened: false,\r\n\t\t\t\t\t\t\t\ticonLoading: false,\r\n\t\t\t\t\t\t\t\tlevel: 1,\r\n\t\t\t\t\t\t\t\tdata: list\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t})\r\n\t\t},\r\n\t\t/**\r\n\t\t * actType 1为增加 2为修改\r\n\t\t */\r\n\t\tmodifyData(level, params, tableIndex, actType) {\r\n\t\t\tconst extraParams = {\r\n\t\t\t\tstartAt: this.downForm.time && this.downForm.time[0],\r\n\t\t\t\tendAt: this.downForm.time && this.downForm.time[1],\r\n\t\t\t\tagentType: this.downForm.agentType,\r\n\t\t\t\tstatus: this.downForm.status,\r\n\t\t\t\tactiveStatus: this.downForm.activeStatus,\r\n\t\t\t\tagentId: params.agentId\r\n\t\t\t}\r\n\t\t\tif (this.hasPermission(12117)) {\r\n\t\t\t\textraParams.walletType = this.downForm.walletType\r\n\t\t\t}\r\n\t\t\tif (this.hasPermission(12116)) {\r\n\t\t\t\textraParams.merchantType = this.downForm.merchantType\r\n\t\t\t}\r\n\t\t\tthis.mixinModifyData(\r\n\t\t\t\tlevel,\r\n\t\t\t\tparams,\r\n\t\t\t\ttableIndex,\r\n\t\t\t\tactType,\r\n\t\t\t\t'searchAgentList',\r\n\t\t\t\textraParams\r\n\t\t\t)\r\n\t\t},\r\n\t\thandleSearch() {\r\n\t\t\tconst extraParams = {}\r\n\t\t\tthis.mixinHandleSearch('searchAgentList', extraParams)\r\n\t\t},\r\n\t\thandleReset() {\r\n\t\t\tthis.form = {\r\n\t\t\t\tagentId: ''\r\n\t\t\t}\r\n\t\t\tthis.hasSearch = false\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\thandleNewBusiness(\r\n\t\t\ttype,\r\n\t\t\tlevel,\r\n\t\t\tcreateLevel,\r\n\t\t\tapiRate,\r\n\t\t\tagentId,\r\n\t\t\tcurrency,\r\n\t\t\tcountPercentage,\r\n\t\t\tcooperationModel,\r\n\t\t\tagentType,\r\n\t\t\tavailableAccountLimit,\r\n\t\t\tplatformAgent\r\n\t\t) {\r\n\t\t\tif (\r\n\t\t\t\tthis.userInfo.agentCode !== 'AAAAA' &&\r\n\t\t\t\tNumber(this.topAgent.availableAccountLimit) === 0 &&\r\n\t\t\t\tcreateLevel === 'top'\r\n\t\t\t) {\r\n\t\t\t\tthis.$message({\r\n\t\t\t\t\ttype: 'error',\r\n\t\t\t\t\tmessage: this.$t('backstage_200214')\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (JSON.stringify(this.topAgent) === '{}') {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tthis.dialogShow = true\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tthis.businessDrawer = true\r\n\t\t\t\tthis.businessType = type\r\n\t\t\t\tthis.agentsLevel = level\r\n\t\t\t\tthis.createLevel = createLevel\r\n\t\t\t\tthis.apiRate = apiRate\r\n\t\t\t\tthis.agentId = agentId\r\n\t\t\t\tthis.agentType = agentType\r\n\t\t\t\tthis.platformAgent =\r\n\t\t\t\t\tcreateLevel === 'top' ? this.userInfo.platformAgent : platformAgent\r\n\t\t\t\tthis.currencyId = currency\r\n\t\t\t\t\t? currency + ''\r\n\t\t\t\t\t: this.topAgent.currency + '' || '1'\r\n\t\t\t\tthis.countPercentage = countPercentage\r\n\t\t\t\tthis.cooperationModel = cooperationModel || this.topAgent.cooperationModel\r\n\r\n\t\t\t\t// 获取商户编码\r\n\t\t\t\tthis.$api.getAgentCode().then((res) => {\r\n\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\tthis.agentCode = res.data\r\n\t\t\t\t\t\tthis.$api\r\n\t\t\t\t\t\t\t.createWalletMd5key({ agentCode: res.data })\r\n\t\t\t\t\t\t\t.then((_) => {\r\n\t\t\t\t\t\t\t\tthis.md5 = _.data\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.catch(() => {})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// 获取谷歌验证码\r\n\t\t\t\tthis.$api.getGoogleAuth().then((res) => {\r\n\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\tthis.googleAuthCode = res.data\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t},\r\n\t\tresetPassword(row) {\r\n\t\t\tthis.currentData = { ...row }\r\n\t\t\tthis.dialogVisible = true\r\n\t\t\tthis.modalType = 3\r\n\t\t},\r\n\t\teditAccountInfo(index, row, type, level) {\r\n\t\t\tthis.currentData = { ...row, type }\r\n\t\t\tthis.currentIndex = index\r\n\t\t\tthis.currentLevel = level\r\n\t\t\tthis.editAccountVisible = true\r\n\t\t},\r\n\t\teditSuccess(form) {\r\n\t\t\t// 因为这里是未来生效的，所以还是要显示当前的\r\n\t\t\tif (form.countPercentage) delete form.countPercentage\r\n\t\t\tif (form.rateSharingEffectiveDate) delete form.rateSharingEffectiveDate\r\n\t\t\tif (form.apiRate) delete form.apiRate\r\n\t\t\tif (form.buyCreditsEffectiveDate) delete form.buyCreditsEffectiveDate\r\n\t\t\tthis.tableLists[this.currentLevel - 1].data[this.currentIndex] = {\r\n\t\t\t\t...this.currentData,\r\n\t\t\t\t...form\r\n\t\t\t}\r\n\t\t\tthis.tableLists = JSON.parse(JSON.stringify(this.tableLists))\r\n\t\t},\r\n\t\teditTrialInfo(index, row, level) {\r\n\t\t\tthis.currentData = { ...row }\r\n\t\t\tthis.currentIndex = index\r\n\t\t\tthis.currentLevel = level\r\n\t\t\tthis.trialVisible = true\r\n\t\t},\r\n\t\tsetting(index, row, level) {\r\n\t\t\tthis.currentData = { ...row }\r\n\t\t\tthis.currentIndex = index\r\n\t\t\tthis.currentLevel = level\r\n\t\t\tthis.settingVisible = true\r\n\t\t},\r\n\t\teditOpen(index, row, level) {\r\n\t\t\tthis.openData = { ...row }\r\n\t\t\tthis.openVisible = true\r\n\t\t},\r\n\t\tcloseEdit() {\r\n\t\t\tthis.handleSearch()\r\n\t\t},\r\n\t\t// 静态更新试玩配置\r\n\t\teditTrialInfoSuccess(value) {\r\n\t\t\tthis.tableLists[this.currentLevel - 1].data[this.currentIndex] = {\r\n\t\t\t\t...this.currentData,\r\n\t\t\t\t...value\r\n\t\t\t}\r\n\t\t\tthis.tableLists[this.currentLevel - 1].data = [\r\n\t\t\t\t...this.tableLists[this.currentLevel - 1].data\r\n\t\t\t]\r\n\t\t\tthis.tableLists = [...this.tableLists]\r\n\t\t},\r\n\t\tsettingSuccess(value) {\r\n\t\t\tif (value) {\r\n\t\t\t\tthis.tableLists[this.currentLevel - 1].data[this.currentIndex] = {\r\n\t\t\t\t...this.currentData,\r\n\t\t\t\t...value,\r\n\t\t\t\tactiveStatus: 1\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.tableLists[this.currentLevel - 1].data = [\r\n\t\t\t\t...this.tableLists[this.currentLevel - 1].data\r\n\t\t\t]\r\n\t\t\tthis.tableLists = [...this.tableLists]\r\n\t\t},\r\n\t\tshowKeysManage(row) {\r\n\t\t\tthis.currentData = { ...row }\r\n\t\t\tthis.keysVisible = true\r\n\t\t},\r\n\t\teditAgentStatus(index, row, level) {\r\n\t\t\tthis.currentData = { ...row }\r\n\t\t\tthis.currentIndex = index\r\n\t\t\tthis.currentLevel = level\r\n\t\t\tthis.dialogVisible = true\r\n\t\t\tthis.modalType = row.status === 1 ? 2 : 1\r\n\t\t},\r\n\t\tUnlock(index, row, level) {\r\n\t\t\tthis.currentData = { ...row }\r\n\t\t\tthis.currentIndex = index\r\n\t\t\tthis.currentLevel = level\r\n\t\t\tthis.lockVisible = true\r\n\t\t\tthis.modalType = row.status === 1 ? 2 : 1\r\n\t\t},\r\n\t\thandleSure() {\r\n\t\t\t// 重置管理员密码\r\n\t\t\tif (this.modalType === 3) {\r\n\t\t\t\tthis.$api\r\n\t\t\t\t\t.resetAdminPwd({\r\n\t\t\t\t\t\tagentId: this.currentData.agentId,\r\n\t\t\t\t\t\tagentName: this.currentData.agentName,\r\n\t\t\t\t\t\tagentCode: this.currentData.agentCode\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then((res) => {\r\n\t\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\t\tthis.dialogVisible = false\r\n\t\t\t\t\t\t\treturn this.$message({\r\n\t\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\t\tmessage: this.$t('merchant_merchantinfo_index_1134')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tconst params = {\r\n\t\t\t\t\tagentId: this.currentData.agentId,\r\n\t\t\t\t\tagentName: this.currentData.agentName,\r\n\t\t\t\t\tstatus: this.currentData.status === 1 ? 0 : 1\r\n\t\t\t\t}\r\n\t\t\t\tthis.$api.merchantUpdateStatus(params).then((res) => {\r\n\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\tthis.tableLists[this.currentLevel - 1].data[this.currentIndex].status =\r\n\t\t\t\t\t\t\tparams.status\r\n\t\t\t\t\t\tthis.tableLists = [...this.tableLists]\r\n\t\t\t\t\t\tthis.dialogVisible = false\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\thandleSureLock() {\r\n\t\t\tconst params = {\r\n\t\t\t\tuserId: this.currentData.userId\r\n\t\t\t}\r\n\t\t\tthis.$api.unLockUser(params).then((res) => {\r\n\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\tthis.tableLists[this.currentLevel - 1].data[this.currentIndex].lockFlag = 0\r\n\t\t\t\t\tthis.tableLists = [...this.tableLists]\r\n\t\t\t\t\tthis.lockVisible = false\r\n\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t\tmessage: this.$t('merchant_merchantinfo_components_keysmanage_1004'),\r\n\t\t\t\t\t\ttype: 'success'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tcloseNew(value) {\r\n\t\t\tthis.$store.dispatch('tree/setTree', [])\r\n\t\t\tthis.$store.dispatch('tree/setTreeData', [])\r\n\t\t\tthis.form.agentId = ''\r\n\t\t\tthis.$refs.tree.initData()\r\n\t\t\tthis.show = false\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.show = true\r\n\t\t\t}, 500)\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\tupdateDialog() {\r\n\t\t\tthis.agentsLevel = ''\r\n\t\t\tthis.createLevel = ''\r\n\t\t\tthis.apiRate = 0\r\n\t\t\tthis.countPercentage = 0\r\n\t\t\tthis.agentId = ''\r\n\t\t\tthis.currencyId = ''\r\n\t\t\tthis.dialogShow = false\r\n\t\t\tthis.cooperationModel = 0\r\n\t\t},\r\n\t\tloadCurrenyDate() {\r\n\t\t\tthis.$api\r\n\t\t\t\t.getCurrencyComboBoxList({\r\n\t\t\t\t\tpageIndex: 1,\r\n\t\t\t\t\tpageSize: 100\r\n\t\t\t\t})\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tconst data = _.data\r\n\t\t\t\t\tthis.currencyList = data.record\r\n\t\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n",null]}