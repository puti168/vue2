{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\merchant\\dotaccount\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\views\\merchant\\dotaccount\\index.vue","mtime":1617695097422},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport list from '@/mixins/list'\r\nimport { mapGetters } from 'vuex'\r\nimport { routerNames } from '@/utils/consts'\r\nimport SelectAgentTree from '@/components/SelectAgentTree'\r\nimport router from '@/router'\r\nimport dayjs from 'dayjs'\r\n\r\nexport default {\r\n\tname: routerNames.dotaccount,\r\n\tcomponents: { SelectAgentTree },\r\n\tmixins: [list],\r\n\tdata() {\r\n\t\tconst start = dayjs()\r\n\t\t\t.startOf('day')\r\n\t\t\t.valueOf()\r\n\t\tconst end = dayjs()\r\n\t\t\t.endOf('day')\r\n\t\t\t.valueOf()\r\n\t\treturn {\r\n\t\t\thadSearch: false,\r\n\t\t\tloading: false,\r\n\t\t\tform: {\r\n\t\t\t\ttime: [start, end],\r\n\t\t\t\ttranType: -1,\r\n\t\t\t\tagentId: ''\r\n\t\t\t},\r\n\t\t\tamountData: {},\r\n\t\t\trechargeVisible: false,\r\n\t\t\trechargeData: {},\r\n\t\t\tprevIndex: 1,\r\n\t\t\tsummary: ''\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters(['globalDics']),\r\n\t\t...mapGetters(['userInfo'])\r\n\t},\r\n\tactivated() {\r\n\t\twindow.clearInterval(window.aaatimer)\r\n\t\twindow.aaatimer = null\r\n\t\tif (!window.bbbtimer) {\r\n\t\t\twindow.bbbtimer = window.setInterval(() => {\r\n\t\t\t\tthis.summary && this.addTotalAmount()\r\n\t\t\t}, 800)\r\n\t\t}\r\n\t},\r\n\tdestroyed() {\r\n\t\twindow.clearInterval(window.bbbtimer)\r\n\t\twindow.bbbtimer = null\r\n\t},\r\n\tbeforeRouteLeave(to, from, next) {\r\n\t\twindow.clearInterval(window.bbbtimer)\r\n\t\twindow.bbbtimer = null\r\n\t\tnext()\r\n\t},\r\n\tmethods: {\r\n\t\t// 失去焦点的时候重置\r\n\t\tonTimeBlur() {\r\n\t\t\tthis.minDate = null\r\n\t\t},\r\n\t\tgetOppositeName(row) {\r\n\t\t\tconst tranType = row.tranType\r\n\t\t\tif (tranType === 3 || tranType === 4) {\r\n\t\t\t\treturn row.oppositeNo ? row.oppositeNo : '-'\r\n\t\t\t} else {\r\n\t\t\t\treturn row.oppositeName ? row.oppositeName : '-'\r\n\t\t\t}\r\n\t\t},\r\n\t\tloadData() {\r\n\t\t\t// 2020-4-28修改为开始和结束时间不能跨月\r\n\t\t\tif (this.form.time) {\r\n\t\t\t\tconst month0 = dayjs(this.form.time[0]).month()\r\n\t\t\t\tconst month1 = dayjs(this.form.time[1]).month()\r\n\t\t\t\tif (month0 !== month1) {\r\n\t\t\t\t\treturn this.$message({\r\n\t\t\t\t\t\tmessage: this.$t('merchant_dotaccount_index_875'),\r\n\t\t\t\t\t\ttype: 'warning'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.loading = true\r\n\t\t\tif (this.$route.query && JSON.stringify(this.$route.query) !== '{}') {\r\n\t\t\t\tconst query = this.$route.query || {}\r\n\t\t\t\tthis.form.agentId = query.agentId\r\n\t\t\t\trouter.push(this.$route.path)\r\n\t\t\t}\r\n\t\t\tconst pageData = {\r\n\t\t\t\tpageSize: this.pageSize,\r\n\t\t\t\tpageIndex: this.pageIndex,\r\n\t\t\t\tstartBetTime: this.form.time[0],\r\n\t\t\t\tendBetTime: this.form.time[1],\r\n\t\t\t\tsearchAgentId: this.form.agentId\r\n\t\t\t}\r\n\t\t\tconst requestData = this.hadSearch\r\n\t\t\t\t? {\r\n\t\t\t\t\t\ttranType: this.form.tranType\r\n\t\t\t\t  }\r\n\t\t\t\t: {}\r\n\t\t\tconst form = {\r\n\t\t\t\t...pageData,\r\n\t\t\t\t...requestData\r\n\t\t\t}\r\n\t\t\tthis.$api\r\n\t\t\t\t.queryAgentAccountRecord(form)\r\n\t\t\t\t.then((_) => {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\tif (_.code === 200) {\r\n\t\t\t\t\t\tconst data = _.data\r\n\t\t\t\t\t\tthis.list = data.record\r\n\t\t\t\t\t\tthis.total = data.totalRecord\r\n\t\t\t\t\t\tthis.summary = data.summary\r\n\r\n\t\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t\tthis.addTotalAmount()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.pageIndex = this.prevIndex\r\n\t\t\t\t\tthis.list = []\r\n\t\t\t\t\tthis.total = 0\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t})\r\n\t\t},\r\n\t\taddTotalAmount() {\r\n\t\t\tconst totalSpan = document.querySelector('.total-span')\r\n\t\t\tconst pageNode = document.querySelector('.el-pagination')\r\n\t\t\tconst prevNode = document.querySelector('.el-pagination__total')\r\n\t\t\tconst newNode = document.createElement('span')\r\n\t\t\tif (!totalSpan) {\r\n\t\t\t\tnewNode.innerText = this.$t('members_accounttransaction_index_506', [\r\n\t\t\t\t\tthis.summary\r\n\t\t\t\t])\r\n\t\t\t\tnewNode.style.margin = '0 15px'\r\n\t\t\t\tnewNode.style.fontWeight = '400'\r\n\t\t\t\tnewNode.className = 'total-span'\r\n\t\t\t\tpageNode && pageNode.insertBefore(newNode, prevNode)\r\n\t\t\t} else {\r\n\t\t\t\tconst str = this.$t('members_accounttransaction_index_506', [this.summary])\r\n\t\t\t\ttotalSpan.innerText = str\r\n\t\t\t}\r\n\t\t},\r\n\t\thandleCurrentChange(val) {\r\n\t\t\tthis.prevIndex = this.pageIndex\r\n\t\t\tthis.pageIndex = val\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\thandleReset() {\r\n\t\t\tif (this.$route.query && JSON.stringify(this.$route.query) !== '{}') {\r\n\t\t\t\trouter.push(this.$route.path, () => {\r\n\t\t\t\t\tthis.resetCommon()\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tthis.resetCommon()\r\n\t\t\t}\r\n\t\t},\r\n\t\tresetCommon() {\r\n\t\t\tconst start = dayjs()\r\n\t\t\t\t.startOf('day')\r\n\t\t\t\t.valueOf()\r\n\t\t\tconst end = dayjs()\r\n\t\t\t\t.endOf('day')\r\n\t\t\t\t.valueOf()\r\n\t\t\tthis.hadSearch = false\r\n\t\t\tthis.form = {\r\n\t\t\t\ttime: [start, end],\r\n\t\t\t\tagentName: '',\r\n\t\t\t\ttranType: -1,\r\n\t\t\t\tagentId: ''\r\n\t\t\t}\r\n\t\t\tthis.initList()\r\n\t\t},\r\n\t\thandleSearch() {\r\n\t\t\tthis.hadSearch = true\r\n\t\t\tthis.pageIndex = 1\r\n\t\t\tthis.loadData()\r\n\t\t},\r\n\t\tgetTranType(type) {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\treturn this.$t('merchant_dotaccount_index_856')\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\treturn this.$t('merchant_dotaccount_index_857')\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\treturn this.$t('merchant_dotaccount_index_854')\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\treturn this.$t('merchant_dotaccount_index_855')\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn '-'\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetSummaries(param) {\r\n\t\t\t// const { columns, data } = param\r\n\t\t\t// const sums = []\r\n\t\t\t// columns.forEach((column, index) => {\r\n\t\t\t// \tif (index === 5) {\r\n\t\t\t// \t\tsums[index] = '总计'\r\n\t\t\t// \t\treturn\r\n\t\t\t// \t}\r\n\t\t\t// \tconst values = data.map((item) => Number(item[column.property]))\r\n\t\t\t// \tif (\r\n\t\t\t// \t\t!values.every((value) => isNaN(value)) &&\r\n\t\t\t// \t\t(column.property === 'preBalance' ||\r\n\t\t\t// \t\t\tcolumn.property === 'amount' ||\r\n\t\t\t// \t\t\tcolumn.property === 'afterBalance')\r\n\t\t\t// \t) {\r\n\t\t\t// \t\tsums[index] = this.summary[column.property]\r\n\t\t\t// \t}\r\n\t\t\t// })\r\n\t\t\t// return sums\r\n\t\t}\r\n\t}\r\n}\r\n",null]}