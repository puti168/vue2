{"remainingRequest":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\pages\\index\\views\\manager\\role\\index.vue?vue&type=style&index=0&id=4155af06&lang=less&scoped=true&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\src\\pages\\index\\views\\manager\\role\\index.vue","mtime":1617594855325},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\admin\\Desktop\\merchant-manager-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KL2RlZXAvIHRoIHsNCiAgdGV4dC1hbGlnbjogY2VudGVyICFpbXBvcnRhbnQ7DQogIG92ZXJmbG93OiBoaWRkZW4gIWltcG9ydGFudDsNCiAgZm9udC1mYW1pbHk6ICdBcmlhbCBOZWdyZXRhJywgJ0FyaWFsIE5vcm1hbCcsICdBcmlhbCcsIHNhbnMtc2VyaWY7DQogIGZvbnQtd2VpZ2h0OiA3MDAgIWltcG9ydGFudDsNCiAgZm9udC1zdHlsZTogbm9ybWFsOw0KfQ0KL2RlZXAvIC5zY3JvbGxib3ggew0KICBoZWlnaHQ6IDQwMHB4Ow0KICBvdmVyZmxvdy15OiBhdXRvOw0KfQ0KL2RlZXAvIC5hbnQtdHJlZSBsaSBzcGFuLmFudC10cmVlLXN3aXRjaGVyIHsNCiAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50Ow0KfQ0KL2RlZXAvIC5hbnQtdHJlZSBsaSB1bCB7DQogIC8vIGRpc3BsYXk6IGZsZXggIWltcG9ydGFudDsNCn0NCi9kZWVwLyAuYW50LXRyZWUtY2hpbGQtdHJlZSAuYW50LXRyZWUtY2hpbGQtdHJlZS1vcGVuIHsNCiAgZGlzcGxheTogZmxleCAhaW1wb3J0YW50Ow0KfQ0KL2RlZXAvIC5hbnQtdHJlZS1jaGlsZC10cmVlID4gbGk6Zmlyc3QtY2hpbGQgew0KICBwYWRkaW5nLXRvcDogNHB4Ow0KfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/index/views/manager/role","sourcesContent":["<template>\r\n  <div class=\"rolespermission\">\r\n    <a-card>\r\n      <searchForm ref=\"searchForm\" :searchFunc=\"search\"></searchForm>\r\n      <a-space size=\"8\" class=\"bd-right\" style=\"margin: -20px 0 20px 0\">\r\n        <a-button type=\"primary\" v-action:xzjs style=\"margin-right: 10px\" @click=\"add\"> 新增角色 </a-button>\r\n        <a-button type=\"primary\" v-action:plsc @click=\"roleDelete\"> 批量删除空角色 </a-button>\r\n      </a-space>\r\n      <a-modal\r\n        v-model=\"modalVisible\"\r\n        width=\"60%\"\r\n        :title=\"modalTitle\"\r\n        @ok=\"createSubmit\"\r\n        destroyOnClose\r\n        :cancelText=\"cancelText\"\r\n        :okText=\"okText\"\r\n      >\r\n        <a-form :form=\"form\" :label-col=\"{ span: 4 }\" :wrapper-col=\"{ span: 20 }\" @submit=\"createSubmit\">\r\n          <a-form-item label=\"角色名称\">\r\n            <a-input\r\n              v-if=\"modalTitle === '新增角色'\"\r\n              :maxLength=\"20\"\r\n              placeholder=\"请输入角色名称\"\r\n              v-decorator=\"[\r\n                'username',\r\n                {\r\n                  rules: [{ required: true, message: '角色名称由1~20位字符组成' }, { validator: handleUsernameOruser }],\r\n                  validateTrigger: 'blur',\r\n                },\r\n              ]\"\r\n            />\r\n            <a-input\r\n              v-else\r\n              :maxLength=\"20\"\r\n              placeholder=\"请输入角色名称\"\r\n              v-decorator=\"[\r\n                'username',\r\n                {\r\n                  rules: [{ required: true, message: '角色名称由1~20位字符组成' }, { validator: handleUsername }],\r\n                  validateTrigger: 'blur',\r\n                },\r\n              ]\"\r\n            />\r\n          </a-form-item>\r\n          <a-form-item label=\"角色描述\" :wrapper-col=\"{ span: 20 }\">\r\n            <a-textarea v-model=\"textvalue\" placeholder=\"请输入角色描述，长度不要超过255字\" :maxLength=\"255\" />\r\n          </a-form-item>\r\n          <a-form-item label=\"权限分配\">\r\n            <a-tree\r\n              class=\"scrollbox\"\r\n              showIcon\r\n              checkable\r\n              v-model=\"checkedKeys\"\r\n              :auto-expand-parent=\"autoExpandParent\"\r\n              :tree-data=\"treeData\"\r\n              :replaceFields=\"{ children: 'childMenu', title: 'menuName', key: 'menuId' }\"\r\n              @check=\"onCheck\"\r\n              defaultExpandAll\r\n            />\r\n          </a-form-item>\r\n        </a-form>\r\n      </a-modal>\r\n      <a-table\r\n        style=\"margin-top: 17px; margin-bottom: 10px\"\r\n        :columns=\"columns\"\r\n        :data-source=\"tableData\"\r\n        :pagination=\"pagination\"\r\n        :loading=\"tableLoading\"\r\n        size=\"middle\"\r\n        bordered\r\n        rowKey=\"roleId\"\r\n        @change=\"onTableChange\"\r\n      >\r\n        <template slot=\"index\" slot-scope=\"text, record, index\">\r\n          {{ index + 1 }}\r\n        </template>\r\n        <template slot=\"show\" slot-scope=\"text, record, index\">\r\n          <div>\r\n            <a-button type=\"link\" v-action:xg size=\"small\" @click=\"edit(text, record, index)\"> 修改 </a-button>\r\n            <a-button\r\n              type=\"link\"\r\n              v-action:sc\r\n              v-if=\"record.userCount < 1\"\r\n              size=\"small\"\r\n              @click=\"roleDelete(text, record, index)\"\r\n            >\r\n              删除\r\n            </a-button>\r\n            <a-button type=\"link\" v-action:sc disabled v-else size=\"small\"> 删除 </a-button>\r\n          </div>\r\n        </template>\r\n      </a-table>\r\n    </a-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { PaginationMixin } from '@/core/mixins'\r\nimport searchForm from './components/searchForm'\r\nimport {\r\n  getRoleQuery,\r\n  getAllMenu,\r\n  setBatchDelete,\r\n  setRoleDelete,\r\n  setRoleAdd,\r\n  setRoleUpdate,\r\n  getRoleNameQuery,\r\n} from '@/api/user'\r\nconst columns = [\r\n  {\r\n    title: '序号',\r\n    dataIndex: 'index',\r\n    key: 'num',\r\n    width: '10%',\r\n    align: 'center',\r\n    scopedSlots: { customRender: 'index' },\r\n  },\r\n  {\r\n    title: '角色名称',\r\n    dataIndex: 'roleName',\r\n    key: 'acc',\r\n    width: '10%',\r\n    align: 'center',\r\n  },\r\n  {\r\n    title: '创建时间',\r\n    dataIndex: 'createdAt',\r\n    key: 'crea',\r\n    width: '15%',\r\n    align: 'center',\r\n  },\r\n  {\r\n    title: '创建人',\r\n    dataIndex: 'createdBy',\r\n    key: 'user',\r\n    width: '10%',\r\n    align: 'center',\r\n  },\r\n  {\r\n    title: '人数',\r\n    dataIndex: 'userCount',\r\n    key: 'ip',\r\n    width: '10%',\r\n    align: 'center',\r\n  },\r\n  {\r\n    title: '备注信息',\r\n    dataIndex: 'remark',\r\n    key: 'rem',\r\n    width: '35%',\r\n    align: 'center',\r\n  },\r\n  {\r\n    title: '操作',\r\n    dataIndex: 'show',\r\n    key: 'oper',\r\n    align: 'center',\r\n    width: '10%',\r\n    scopedSlots: { customRender: 'show' },\r\n  },\r\n]\r\nexport default {\r\n  mixins: [PaginationMixin],\r\n  components: {\r\n    searchForm,\r\n  },\r\n  data() {\r\n    return {\r\n      modalTitle: '',\r\n      cancelText: '',\r\n      okText: '',\r\n      form: this.$form.createForm(this),\r\n      textvalue: '', //角色描述\r\n      tableLoading: false,\r\n      modalVisible: false,\r\n      expandedKeys: [],\r\n      autoExpandParent: true,\r\n      checkedKeys: [],\r\n      menuIdsArr: [],\r\n      treeData: [],\r\n      username: 'admin123',\r\n      columns,\r\n      tableData: [],\r\n      addData: {},\r\n      str: '',\r\n    }\r\n  },\r\n  mounted() {\r\n    this.fetch(1, this.pageSize)\r\n    this.initMenu()\r\n  },\r\n  methods: {\r\n    search() {\r\n      this.fetch(1, this.pageSize)\r\n    },\r\n    fetch(page, pageSize) {\r\n      this.tableLoading = true\r\n      this.page = page\r\n      this.pageSize = pageSize\r\n      let queryData = this.$refs.searchForm.formData\r\n      queryData.pageNum = page\r\n      queryData.pageSize = pageSize\r\n      queryData.roleName = queryData.roleName == '' ? null : queryData.roleName\r\n      queryData.createdBy = queryData.createdBy == '' ? null : queryData.createdBy\r\n      queryData.startTime = queryData.startTime != '' ? queryData.startTime : null\r\n      queryData.endTime = queryData.endTime != '' ? queryData.endTime : null\r\n      delete queryData.regisTime\r\n      getRoleQuery(queryData)\r\n        .then((res) => {\r\n          this.tableLoading = false\r\n          if (res.code === 200) {\r\n            this.tableData = res.data\r\n            this.total = res.totalCount\r\n          } else {\r\n            this.$message.error(res.msg)\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err)\r\n        })\r\n    },\r\n    initMenu() {\r\n      getAllMenu()\r\n        .then((res) => {\r\n          if (res.code === 200) {\r\n            this.treeData = res.data.list\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err)\r\n        })\r\n    },\r\n    add() {\r\n      this.modalTitle = '新增角色'\r\n      this.cancelText = '取消创建'\r\n      this.okText = '确定创建'\r\n      this.textvalue = ''\r\n      this.addData = {}\r\n      this.checkedKeys = []\r\n      this.modalVisible = true\r\n    },\r\n    handleUsernameOruser(rule, value, callback) {\r\n      let reg = /\\s/\r\n      if (value && reg.test(value)) {\r\n        callback('角色不能包含空格')\r\n      }\r\n      if (value && value.replace(' ', '').length < 1) {\r\n        callback('角色名称由1~20位字符组成')\r\n      }\r\n      getRoleNameQuery({ roleName: value })\r\n        .then((res) => {\r\n          if (res.data != null) {\r\n            callback('角色已存在')\r\n          } else {\r\n            callback()\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err)\r\n        })\r\n    },\r\n    handleUsername(rule, value, callback) {\r\n      let reg = /\\s/\r\n      if (value && reg.test(value)) {\r\n        callback('角色不能包含空格')\r\n      }\r\n      if (value && value.replace(' ', '').length < 1) {\r\n        callback('角色名称由1~20位字符组成')\r\n      }\r\n      callback()\r\n    },\r\n    onCheck(checkedKeys, info) {\r\n      let checkedKeysResult = [...checkedKeys, ...info.halfCheckedKeys]\r\n      this.menuIdsArr = checkedKeysResult\r\n    },\r\n    getMenuIdsArr(list) {\r\n      for (let i = 0; i < list.length; i++) {\r\n        const ele = list[i]\r\n        if (ele.isPermission) {\r\n          this.menuIdsArr.push(ele.menuId)\r\n        }\r\n        if (ele.childMenu && ele.childMenu.length > 0) {\r\n          this.getMenuIdsArr(ele.childMenu)\r\n        }\r\n      }\r\n      return this.menuIdsArr\r\n    },\r\n    getTrueId(list) {\r\n      for (let i = 0; i < list.length; i++) {\r\n        const ele = list[i]\r\n        if (ele.childMenu && ele.childMenu.length > 0) {\r\n          this.getTrueId(ele.childMenu)\r\n        } else if (ele.isPermission) {\r\n          this.checkedKeys.push(ele.menuId)\r\n        }\r\n      }\r\n      return this.checkedKeys\r\n    },\r\n    edit(text, record, index) {\r\n      this.modalTitle = '修改角色'\r\n      this.cancelText = '取消修改'\r\n      this.okText = '确定修改'\r\n      this.modalVisible = true\r\n      this.textvalue = record.remark\r\n      this.addData.roleId = record.roleId\r\n      this.menuIdsArr = []\r\n      this.checkedKeys = []\r\n      setTimeout(() => {\r\n        this.form.setFieldsValue({\r\n          username: record.roleName,\r\n        })\r\n      }, 100)\r\n      let that = this\r\n      getAllMenu({ roleId: record.roleId })\r\n        .then((res) => {\r\n          if (res.code === 200) {\r\n            that.getTrueId(res.data.list)\r\n            that.getMenuIdsArr(res.data.list)\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err)\r\n        })\r\n    },\r\n    createSubmit() {\r\n      this.form.validateFields((err, values) => {\r\n        if (!err) {\r\n          if (this.checkedKeys.length < 1) {\r\n            this.$message.error('至少选择一条权限')\r\n          } else {\r\n            this.addData.roleName = values.username\r\n            this.addData.remark = this.textvalue\r\n            this.addData.menuIds = this.menuIdsArr.toString()\r\n            let that = this\r\n            if (that.addData.roleId) {\r\n              setRoleUpdate(that.addData)\r\n                .then((res) => {\r\n                  if (res.code === 200) {\r\n                    that.modalVisible = false\r\n                    that.fetch(1, that.pageSize)\r\n                    that.$message.success(res.msg)\r\n                  } else {\r\n                    that.$message.error(res.msg)\r\n                  }\r\n                })\r\n                .catch((err) => {\r\n                  console.log(err)\r\n                })\r\n            } else {\r\n              setRoleAdd(that.addData)\r\n                .then((res) => {\r\n                  if (res.code === 200) {\r\n                    that.modalVisible = false\r\n                    that.fetch(1, that.pageSize)\r\n                    that.$message.success(res.msg)\r\n                  } else {\r\n                    that.$message.error(res.msg)\r\n                  }\r\n                })\r\n                .catch((err) => {\r\n                  console.log(err)\r\n                })\r\n            }\r\n          }\r\n        }\r\n      })\r\n    },\r\n    roleDelete(text, record, index) {\r\n      let res = {}\r\n      let that = this\r\n      if (record) {\r\n        res.roleId = record.roleId\r\n        res.roleName = record.roleName\r\n        this.$confirm({\r\n          title: '删除角色',\r\n          content: '删除后，创建用户时将不能够选择该项角色权限，还要继续吗？',\r\n          bodyStyle: { color: 'red' },\r\n          onOk() {\r\n            setRoleDelete(res)\r\n              .then((res) => {\r\n                if (res.code === 200) {\r\n                  that.$message.success(res.msg)\r\n                  that.fetch(1, that.pageSize)\r\n                } else {\r\n                  that.$message.error(res.msg)\r\n                }\r\n              })\r\n              .catch((err) => {\r\n                console.log(err)\r\n              })\r\n          },\r\n        })\r\n      } else {\r\n        this.$confirm({\r\n          title: '删除角色',\r\n          content: '删除后，绑定人数为0的角色都将被删除，还要继续吗？',\r\n          onOk() {\r\n            setBatchDelete()\r\n              .then((res) => {\r\n                if (res.code === 200) {\r\n                  that.$message.success(res.msg)\r\n                  that.fetch(1, that.pageSize)\r\n                } else {\r\n                  that.$message.error(res.msg)\r\n                }\r\n              })\r\n              .catch((err) => {\r\n                console.log(err)\r\n              })\r\n          },\r\n        })\r\n      }\r\n    },\r\n    hideModal() {},\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n/deep/ th {\r\n  text-align: center !important;\r\n  overflow: hidden !important;\r\n  font-family: 'Arial Negreta', 'Arial Normal', 'Arial', sans-serif;\r\n  font-weight: 700 !important;\r\n  font-style: normal;\r\n}\r\n/deep/ .scrollbox {\r\n  height: 400px;\r\n  overflow-y: auto;\r\n}\r\n/deep/ .ant-tree li span.ant-tree-switcher {\r\n  display: none !important;\r\n}\r\n/deep/ .ant-tree li ul {\r\n  // display: flex !important;\r\n}\r\n/deep/ .ant-tree-child-tree .ant-tree-child-tree-open {\r\n  display: flex !important;\r\n}\r\n/deep/ .ant-tree-child-tree > li:first-child {\r\n  padding-top: 4px;\r\n}\r\n</style>"]}]}